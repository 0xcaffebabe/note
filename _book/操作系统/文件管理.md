# 文件管理

长期存储信息的三个基本要求

- 能够存储大量信息
- 使用信息的进程终止时，信息仍旧存在
- 信息能够并发访问

## 文件

### 文件命名

_FAT-16_ _NTFS_

### 文件结构

- 字节序列
- 记录序列
- 树

![](https://img-blog.csdn.net/20180426093252605?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODk3NTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

### 文件类型

- 普通文件
- 目录

![](https://img-blog.csdn.net/20180426095725505?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODk3NTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

### 文件访问

- 顺序访问
- 随机访问

### 文件属性

![enter image description here](https://images2015.cnblogs.com/blog/381412/201601/381412-20160123234117062-757204328.jpg)

### 文件操作

- onCreate
- delete
- open
- close
- read
- write
- append
- seek
- get attrs
- set attrs
- rename

### 使用文件系统调用

一个简单的C语言程序：

```c
int main(){

        FILE *fp;
        char c = -1;
        fp = fopen("./file.c","r");
        while ((c = fgetc(fp)) != -1){
                putchar(c);
        }
        fclose(fp);

        return 0;
}
```

## 目录

- 一级目录系统

  ![](https://img-blog.csdn.net/20180427082756149?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODk3NTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

- 层次目录系统

  ![](https://img-blog.csdn.net/20180427082813359?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODk3NTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

- 路径名

  - 绝对路径
  - 相对路径

- 目录操作

  - create
  - delete
  - opendir
  - closedir
  - readdir
  - rename
  - link
  - unlink

## 文件系统的实现

### 文件系统布局

**主引导记录（MBR）**

![enter image description here](https://pic3.zhimg.com/80/v2-76dc2f67640adbbc3a34cdd72c02180a_hd.jpg)

### 文件的实现

- 连续分配

  ![](https://img-blog.csdn.net/20180427095713650?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODk3NTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

- 链表分配

    ![](https://img-blog.csdn.net/20180427100350123?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4ODk3NTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

- 使用内存中的表进行链表分配

**文件分配表**

- i节点

### 目录的实现

### 共享文件

**链接** **符号链接**

### 日志结构文件系统（LFS）

### 日志文件系统

日志必须是幂等的 _思考： 与数据库中的原子事务_

### 虚拟文件系统

_思考： 适配器设计模式_

## 文件系统管理和优化

- 磁盘空间管理

  - 选择块大小

    速度与空间不可兼得

  - 记录空闲块

    链表与位图

  - 磁盘配额

- 文件系统备份

**逻辑转储与物理转储**

- 文件系统的一致性

检查使用的块与空闲块是否一致

- 文件系统性能

  - 高速缓存

    内存速度 > 磁盘速度

    **块高速缓存** _散列与快速查找_

  - 块提前读

  - 减少磁盘臂运动

- 磁盘碎片整理

## 文件系统实例

- MS-DOS文件系统
- UNIX V7 文件系统
- CD-ROM文件系统

  - ISO 9660文件系统
  - Rock Ridge扩展
  - Joliet扩展
