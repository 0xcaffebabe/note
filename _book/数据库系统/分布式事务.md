# 分布式系统

> 部署在不同结点上的系统通过网络交互来完成协同工作的系统

# 分布式事务

> 在分布式系统中一次操作由多个系统协同完成，这种一次事务操作涉及多个系统通过网络协同完成的过程称为分布式事务。

# CAP理论

![批注 2019-10-31 194221](/assets/批注%202019-10-31%20194221.png)

- 一致性(Consistency)：服务A、B、C三个结点都存储了用户数据， 三个结点的数据需要保持同一时刻数据一致性。
- 可用性(Availability)：服务A、B、C三个结点，其中一个结点宕机不影响整个集群对外提供服务，如果只有服务A结 点，当服务A宕机整个系统将无法提供服务，增加服务B、C是为了保证系统的可用性。
- 分区容忍性(Partition Tolerance)：分区容忍性就是允许系统通过网络协同工作，分区容忍性要解决由于网络分区 导致数据的不完整及无法访问等问题。

# 解决方案

## 两阶段提交(2PC)

```text
Coordinator                                         Participant
                              QUERY TO COMMIT
                -------------------------------->
                              VOTE YES/NO           prepare*/abort*
                <-------------------------------
commit*/abort*                COMMIT/ROLLBACK
                -------------------------------->
                              ACKNOWLEDGMENT        commit*/abort*
                <--------------------------------  
end
```

- 优点：实现强一致性
- 缺点：整个事务的执行需要由协调者在多个节点之间去协调

## 事务补偿(TCC)

![](https://yqfile.alicdn.com/336cfefed688a023e48872cc975bce4a2525bc1b.png)

- 优点：最终保证数据的一致性，在业务层实现事务控制，灵活性好。
- 缺点：开发成本高，每个事务操作每个参与者都需要实现try/confirm/cancel三个接口。

## 使用消息队列实现最终一致性

![批注 2019-10-31 201018](/assets/批注%202019-10-31%20201018.png)


