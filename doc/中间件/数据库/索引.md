---
tags: ['数据库', '数据结构', '架构设计', '性能']
books: [
  {name: '数据库系统概念', chapters: ['第11章']},
  {name: '高性能MySQL'}
]
---

# 数据库索引

## 一、索引的第一性原理：RUM 猜想

### 1. RUM 猜想的本质

**RUM Conjecture** 指出：

> 对任何索引或数据结构而言，不可能同时在以下三个维度上做到最优：
>
> * **Read（读取开销）**
> * **Update / Write（写入与更新开销）**
> * **Memory / Space（存储与内存开销）**

当系统试图极致优化其中两个维度时，必然以第三个维度的劣化作为代价。

这不是实现限制，而是**信息组织与物理约束下的必然结果**。

### 2. RUM 是索引设计的"物理定律"

RUM 并不指导"如何实现"，而是限定了**所有实现的可能空间**：

* 索引结构的差异，本质是对 R / U / M 权重的不同取舍
* 所谓"新型索引"，只是落点在三角形的不同位置

---

## 二、索引系统的三层抽象模型

为了避免实现细节淹没原理，索引需要被放入一个稳定的认知框架中。

### 1. 三层模型定义

| 层级  | 关注点     | 典型问题                 |
| --- | ------- | -------------------- |
| 原理层 | 不可兼得与权衡 | 为什么不能又快又省？           |
| 架构层 | 数据如何组织  | 为什么是树 / 日志 / 位图？     |
| 实现层 | 引擎与细节   | MySQL / InnoDB 如何落地？ |

后文所有内容，均可映射到这三层之一。

---

## 三、索引架构层：数据结构的系统性分类

### 1. 以 RUM 为中心的索引架构地图

| 索引架构                 | Read | Write | Space | 设计目标    |
| -------------------- | ---- | ----- | ----- | ------- |
| 树型索引（B+Tree）         | 强    | 中     | 中     | 稳定低延迟读取 |
| 日志结构（LSM）            | 中    | 强     | 弱     | 高写入吞吐   |
| 近似索引（Bitmap / Bloom） | 中    | 弱     | 强     | 空间与过滤   |
| 自适应索引                | 可变   | 可变    | 可变    | 动态负载适应  |

这张表是全文的**结构骨架**。

---

## 四、读取优化导向：树型索引体系

### 1. 树型索引的设计哲学

树型索引的核心目标是：

* 最小化查询路径长度
* 最大化磁盘与缓存的局部性利用

其本质是：**用空间换确定性的读取性能**。

### 2. B 树与 B+ 树的结构差异

* **B 树**：

  * 叶子与非叶子节点均存数据
  * 更少的中间跳转

* **B+ 树**：

  * 数据仅存在于叶子节点
  * 叶子节点通过链表相连
  * 更适合范围查询与顺序扫描

在数据库系统中，B+ 树胜出的原因并非算法优雅，而是：

> **它更符合磁盘页、预读和缓存的物理特性**。

### 3. B+ 树的工程优势

* 高扇出 → 树高稳定
* 顺序 IO 友好
* 范围查询天然高效

这使其成为 OLTP 系统的默认选择。

---

## 五、写入优化导向：LSM 架构体系

### 1. LSM 的设计动机

当写入吞吐成为瓶颈时，树结构频繁的随机写与节点分裂成为主要成本。

LSM 的核心思想是：

> **将随机写转化为顺序写，再通过后台合并恢复有序性**。

### 2. LSM 的核心组件

* **MemTable**：内存中的有序写缓冲
* **WAL**：崩溃恢复保障
* **SSTable**：磁盘上的不可变有序文件
* **Compaction**：后台合并与层级治理

### 3. LSM 的权衡代价

* 读取路径变长（多层查找）
* 空间放大（多版本与 tombstone）

这正是 RUM 猜想在现实系统中的体现。

---

## 六、空间优化导向：近似与压缩索引

### 1. 位图索引

位图索引适用于：

* 低基数
* 分析型查询

其本质是：

> **用位运算换取极致空间与并行计算效率**。

### 2. Bloom Filter

Bloom Filter 不用于定位数据，而用于：

* 否定性过滤
* 减少无效 IO

这是一种典型的**概率性结构换性能**的设计。

---

## 七、实现层示例：MySQL / InnoDB 的索引体系

> 本节属于实现层示例，而非索引原理本身。

### 1. 聚簇索引与辅助索引

* InnoDB 表本身即一棵 B+ 树
* 主键决定数据物理组织
* 辅助索引存储主键而非地址

这决定了：

* 主键设计是存储设计
* 回表是结构性结果，而非实现缺陷

### 2. 索引匹配与优化器行为

* 最左前缀原则
* 覆盖索引
* 索引下推

这些规则的共同前提是：

> **索引的有序性未被破坏**。

---

## 八、索引设计的方法论

索引不是"加不加"，而是系统性设计问题。

### 1. 关键决策维度

1. 读写比例（R/W）
2. 查询模式（点查 / 范围 / 扫描）
3. 数据基数与分布
4. 数据规模与增长速率
5. 排序、分组、聚合需求

### 2. 方法论落点

* 读多 → B+ Tree
* 写多 → LSM
* 分析型 → Bitmap / 列存

---

## 九、索引的生命周期与治理

索引不是一次性产物，而是需要治理的系统资产。

### 生命周期阶段

1. 设计
2. 构建
3. 使用
4. 监控
5. 演进与清理

### 治理手段

* 统计信息维护
* 冗余索引清理
* 碎片整理
* 查询模式回溯

---

## 十、总结：从技术到系统认知

索引的本质不是"加速查询"，而是：

> **在物理约束下，对数据访问路径的长期权衡设计**。

## 关联内容（自动生成）

- [/中间件/数据库/mysql/查询优化.md](/中间件/数据库/mysql/查询优化.md) 索引直接影响数据库查询性能，了解查询优化有助于更好地设计和使用索引
- [/中间件/数据库/mysql/存储引擎.md](/中间件/数据库/mysql/存储引擎.md) 不同存储引擎对索引的实现和支持有所不同，了解存储引擎有助于深入理解索引机制
- [/中间件/数据库/redis/数据结构.md](/中间件/数据库/redis/数据结构.md) Redis的数据结构与传统数据库索引在某些方面有相似之处，对比学习有助于加深理解
- [/算法与数据结构/树.md](/算法与数据结构/树.md) B+树是数据库索引的重要数据结构，了解树的基本概念和性质有助于理解索引原理
- [/算法与数据结构/散列表.md](/算法与数据结构/散列表.md) 散列表是另一种重要的数据结构，与索引设计有密切关系，了解其原理有助于全面掌握数据访问方法
- [/软件工程/架构/系统设计/缓存.md](/软件工程/架构/系统设计/缓存.md) 缓存与索引都是为了提升数据访问性能的技术，了解缓存设计有助于理解索引的应用场景
- [/数据技术/数据存储.md](/数据技术/数据存储.md) 数据存储与索引紧密相关，了解存储机制有助于理解索引的物理实现
- [/中间件/数据库/数据库优化.md](/中间件/数据库/数据库优化.md) 数据库优化包含索引优化，两者相互关联，共同影响数据库性能