# 云原生

虚拟化 -> 标准化 -> 自动化 -> 云计算

## 上云好处

- 敏捷交付
- 统一运维
- 云安全
- 弹性、按量付费
- 稳定性
- 全球性
- 释放运维压力

## 云环境分类

### 所属

- **混合云**
- 私有云
- 公有云

### 抽象

#### Iaas

- 虚拟化
- 负载均衡
- 自动扩展

通过声明式编程 从而能自动化基础架构

网络互通：

- [大二层](https://support.huawei.com/enterprise/zh/doc/EDOC1000178185/837af51d)
- [三层路由](https://blog.csdn.net/zhongyuan_1990/article/details/45575221)

云存储：

从上往下封装程度越高

- 块设备
- 文件系统
- 对象存储

#### Paas

##### 认证

- RAM 动态权限管理
- SAML 2.0 身份联合登录
- OAuth 2.0

##### 云数据库

- 传统关系型
- NoSQL
  - DynamoDB
  - BigQuery
  - OceanBase

##### 中间件

##### 容器云

- docker
- runc
- k8s
- mesos marathon
- docekr swarm
- cloud foundary

#### Saas

## 混合云

### 优势

- 可控 & 开箱即用
- 周期性应用/试点应用
- 业务高峰分流
- 成本控制
- 平滑转型

### 连接

#### 入口分流

- CDN
- SLB软件负载均衡器

#### 安全

DDoS -> WAF -> SLB -> 系统安全

#### 容灾多活

- 数据同步

### 技术难点

#### 安全

- 跨数据中心的账号管理
- 符合法律法规
- 网络隔离

#### 运维

- 统一发布
- 统一监控
- 资源调配

## 虚拟化容器

chroot、namespaces、cgroups -> LXC -> Docker -> K8S

三方面的兼容性：

1. ISA兼容：目标机器指令集兼容性
2. ABI兼容：目标系统或者依赖库的二进制兼容性
3. 环境兼容：配置文件 环境变量等

几种虚拟化技术：

- 指令集虚拟化：通过软件来模拟不同ISA架构的处理器工作过程，将虚拟机发出的指令转换为符合本机ISA的指令
- 硬件抽象层虚拟化：使用软件来模拟硬件，或者直接将硬件直通到虚拟机使用
- 操作系统层虚拟化：采用隔离手段，使得不同进程拥有独立的系统资源和资源配额 也就是容器化
- 运行库虚拟化：使用软件翻译的方法来模拟系统，它以一个独立进程来代替操作系统内核来提供目标软件运行所需的全部能力 如WINE
- 语言层虚拟化：由虚拟机将高级语言生成的中间代码转换为目标机器可以直接执行的指令

### 容器隔离

- 隔离文件：chroot
  - 当某个进程经过chroot操作之后，它的根目录就会被锁定在命令参数所指定的位置，以后它或者它的子进程将不能再访问和操作该目录之外的其他文件
- 隔离访问：namespaces
  - 由内核直接提供的全局资源封装如文件 进程 用户 网络等信息，是内核针对进程设计的访问隔离机制
- 隔离资源：cgroups
  - 控制进程对资源的使用

### 容器封装

- 封装系统：LinuxX Containers
- 封装应用：Docker
- 封装集群：Kubernetes

### 基于容器构建系统

- 隔离：名称空间
- 协作：基于同一个pod

这里在K8S中 相互协作的容器运行在同一个pod中 这个pod就是被调度的基本单位

K8S的协作 如果运行单个pod 那么系统是十分脆弱的 使用ReplicaSet等手段来保持住系统的状态

这种组件被称为控制回路：

![20201126163527](/assets/20201126163527.png)

### 应用为中心的封装

- Kustomize：使用一个配置文件描述配置文件
- Helm与Chart：模仿Linux包管理器的思路去管理Kubernetes应用
- Operator与CRD：把应用封装为另一种更高层次的资源，再把Kubernetes的控制器模式从面向于内置资源，扩展到了面向所有自定义资源
- 开放应用模型

## 云原生应用

### 原则

#### CICD

- 一个应用一份代码多次发布
- 代码不可变 使用配置驱动应用
- 开发、测试环境一致性

#### 弹性

- 无状态进程
- 同步并发
- 快速启动优雅关闭

#### 解耦

- 依赖明示
- 配置和密码分离
- 使用外部服务
- 动态端口绑定

#### 中台

- 日志流
  - 直接到输出流 使用日志平台
- 作业管理
  - 分布式任务调度
  - 暴露接口 给外部触发
- 监控遥测
- API经济
  - 每个系统都要有对外提供API的能力
