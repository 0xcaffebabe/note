# 文件管理

长期存储信息的三个基本要求

- 能够存储大量信息
- 使用信息的进程终止时，信息仍旧存在
- 信息能够并发访问

## 文件

### 文件命名

_FAT-16_ _NTFS_

### 文件结构

- 字节序列
- 记录序列
- 树

![三种文件结构](/assets/20211228164952.png)

### 文件类型

- 普通文件
- 目录

![20211228165029](/assets/20211228165029.png)

### 文件访问

- 顺序访问
- 随机访问

### 文件属性

![2020731154745](/assets/2020731154745.jpg)

文件属性        | 意义
----------- | ---------------
保护          | 谁能访问该文件，以何种方式访问
密码          | 访问该文件需要的密码
创立者         | 创立该文件的用户的ID
拥有者         | 文件当前的拥有者
只读标志        | 0读写访问;1只读.
隐藏标志        | 0正常文件; 1隐藏文件
系统标志        | 0正常文件; 1系统文件
归档标志        | 0已经备份; 1需要备份
ASCIIV二进制标志 | 0文本文件; 1二进制文件
随机访问标志      | 0顺序访问; 1随机访问
临时文件标志      | 0正常文件; 1临时文件
锁标志         | 0释放状态;非零锁住状态
记录长度        | 一个记录包含的字节数
关键字位置       | 记录里关键字所处的位移量
关键字长度       | 关键字所占字节数
文件创立时间      | 文件创立的日期和时间
最后访向时间      | 文件最后被访问的日期和时间
最后修改时间      | 文件最后修改的日期和时间
当前文件大小      | 文件所占的字节数
文件最大尺寸      | 文件可达到的最大字节数

### 文件操作

- onCreate
- delete
- open
- close
- read
- write
- append
- seek
- get attrs
- set attrs
- rename

### 使用文件系统调用

一个简单的C语言程序：

```c
int main(){

        FILE *fp;
        char c = -1;
        fp = fopen("./file.c","r");
        while ((c = fgetc(fp)) != -1){
                putchar(c);
        }
        fclose(fp);

        return 0;
}
```

## 目录

- 一级目录系统

![批注 2020-07-31 155012](/assets/批注%202020-07-31%20155012.png)

- 层次目录系统

![批注 2020-07-31 155041](/assets/批注%202020-07-31%20155041.png)

- 路径名

  - 绝对路径
  - 相对路径

- 目录操作

  - create
  - delete
  - opendir
  - closedir
  - readdir
  - rename
  - link
  - unlink

## 文件系统的实现

### 文件系统布局

**主引导记录（MBR）**

![enter image description here](https://pic3.zhimg.com/80/v2-76dc2f67640adbbc3a34cdd72c02180a_hd.jpg)

### 文件的实现

- 连续分配

![批注 2020-07-31 154858](/assets/批注%202020-07-31%20154858.png)

- 链表分配

![批注 2020-07-31 154922](/assets/批注%202020-07-31%20154922.png)

- 使用内存中的表进行链表分配

**文件分配表**

- i节点

### 目录的实现

### 共享文件

**链接** **符号链接**

### 日志结构文件系统（LFS）

### 日志文件系统

日志必须是幂等的 _思考： 与数据库中的原子事务_

### 虚拟文件系统

_思考： 适配器设计模式_

## 文件系统管理和优化

- 磁盘空间管理

  - 选择块大小

    速度与空间不可兼得

  - 记录空闲块

    链表与位图

  - 磁盘配额

- 文件系统备份

**逻辑转储与物理转储**

- 文件系统的一致性

检查使用的块与空闲块是否一致

- 文件系统性能

  - 高速缓存

    内存速度 > 磁盘速度

    **块高速缓存** _散列与快速查找_

  - 块提前读

  - 减少磁盘臂运动

- 磁盘碎片整理

## 文件系统实例

- MS-DOS文件系统
- UNIX V7 文件系统
- CD-ROM文件系统

  - ISO 9660文件系统
  - Rock Ridge扩展
  - Joliet扩展
