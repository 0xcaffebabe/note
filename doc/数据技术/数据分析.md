# 数据分析

商业智能（Business Intelligence，BI）、数据仓库（Data Warehouse，DW）和数据挖掘（Data Mining，DM）三者之间的关系：

> 数据仓库是一个集成、主题化、稳定的数据存储区域，为BI和DM提供数据支持。BI通过可视化分析和数据报表等方式，将数据转化为有价值的信息，帮助企业管理层和决策者快速准确地获得洞察，支持企业决策。而DM是从数据中自动提取模式、趋势和关系的过程，用于发现数据的隐含规律和预测未来走向

数据采集 -> 数据挖掘 -> 数据可视化

- 对于大数据：熵很小，使用数据挖掘算法
- 对于小数据：熵很大，了解背后规律

## 数据指标体系

> 数据指标：将某个事件量化并形成数值来衡量目标

数据指标可以被用来选出判断标准，并给出最终结论。数据指标体系是从特定角度分析业务得到数据指标

实现数据指标体系，根据优选级选择重要的数据指标，保证效率，在迭代中反馈与修正，另外，指标服务于业务，当业务发生变化，指标体系也会收到变动的影响

### 指标体系类型

- 战略型：统观全局高度汇总的数据指标
- 策略型：策略指标实现企业的既定战略分解，同时找出潜在机会来更好的实现这个目的
- 运营型：运营型指标监测和管理一线工作人员的日常活动
- 分析型：用于业务深入探究

### 体系搭建

最重要的是了解业务，整个流程，盈利模式，以及实现这个业务流程的各个组织机构，串连各个组织机构，发现数据指标

### 指标分类

- 基础指标：基础指标是从粒度最细的业务明细数据中做一层聚合，只进行最基础的统计加工，能够反映总体业务运营状况。同时也是数量最为庞大的指标群体
- 衍生指标：衍生指标是在基础指标基础上增加一些限制条件，用于描述特定的业务场景，可以有一些专属用途
- 计算指标：计算指标是在基础指标和衍生指标基础上计算得到，例如率值、密度等等，这些用于计算的元素都来自于原生和衍生指标，都需要有明确的业务含义
- 综合指标：在前三种指标进行更一步的抽象画，如多个指标的线性化，或者使用数学工具进行建模

### 指标拆解

1. 维度拆分：如区域、标签、时间、业务情况...
2. 场景拆分：总指标 = 各场景下指标相加
3. 关系拆分：一个指标可以由其他指标推导得到

### 检验

- 可执行可描述：设计出的指标能解决问题也能被技术实现
- 完整：没有遗漏核心点，不重不漏
- 优先级：按照优先级确定先实现哪些指标

### 常见问题

1. 使用的指标并不能指导业务行动
2. 指标没有判断标准，不知道好坏
3. 对于抽象的指标，进行了不合适的拆分，瞎拆分子指标
4. 没有按照业务流程构造指标，只是堆砌数据，不能指导业务
5. 没有根据业务选维度，无脑加维度

## 流量分析

流量分析是分析如何获取如何用户，哪里获取用户的一个数据分析活动，其最终目是为了获取商业价值，提升用户获取的 ROI，占领市场

做流量分析之前，首先需要明确的是公司的业务面向的用户群体，2C还是2B，大B还是小B，产品形态是什么，网站app还是咨询服务，所在哪个行业，游戏还是电商，是如何盈利的，是免费增值还是会员制还是流量变现

### 流量渠道

- 传统方式：地推、电销、会展、上门拜访、线下拦截...
- 付费渠道：搜索竞价、信息流、软文、传统广告、流量联盟...
- 社交渠道：社群营销、病毒营销
- 内容渠道：自媒体、短视频、直播
- 其他渠道：SEO、...

### 流量成本

= 时间成本 + 资源成本 + 人力成本 + 资金成本

### 分析角度

1. 观察流量规律，便于活动安排、服务调整
2. 发现流量异常，分析异常原因并及时调整
3. 观察流量结构，分析其合理性，并作出调整
4. 追踪流量情况，衡量活动或者调整效果

### 分析的问题

1. 用户的来源
2. 用户的诉求
3. 不同来源的用户，表现有什么差异
4. 如何设计流量入口以提升 ROI

### 关注指标

1. 各渠道新增用户量、人均获客成本
2. 用户产品的使用情况
3. 支出收入相关指标

### 分析方法

- 渠道分析：不同的渠道的带来了多少流量
- 转化分析：投入的资源得到了多少流量
- 价值分析：投入的资源带来了多少的实际收入
- 异动分析：投入的资源不变，流量突然变多了或者变少了

## 产品分析

主要分为功能分析（行为流程、业务流程）与交互视觉分析，分析产品以优化业务，提升用户使用体验。在进行产品分析时，首先需要明确目的，根据目的确定主要问题，其中最主要的是明白功能为谁设计，他们何时用，怎么用

行为流程是用户侧的行为，业务流程是产品侧提供的功能，所以可以从行为流程与业务流程分析出需要关注的问题，如产品侧如何实现功能，异常情况如何处理等

当进行对以上流程的分析之后，就能更透彻地理解业务全流程，并在此基础上，梳理出关键流程、主流程

### 关注的问题

- 业务逻辑是最优的吗
- 哪些地方还可以优化
- 新功能对用户产生了什么影响

### 分析内容

- 对于视觉交互的分析，目的是最大限度的满足用户的感官体验与使用体验
- 对于主流程的分析优化，最重要的是降低用户在主流程的交互时间
- 对于用户行为的分析，优化的目的是减少产品功能冗余，提高用户的使用效率
- 对于产品价值分析，目的是满足用户在产品内的各种诉求
- 对于商业价值分析，目的是为了利润最大化

### 常见误区

- 大而全无分析：简单功能罗列，没有可落地的参考建议
- 数据异常丰富：虽然引用了很多数据，但没有建议
- 过于关注视觉与交互
- 无结论：单纯描述表面现象，没有分析优点缺点，哪里值得学习改进

## 均值

平均值容易受到极端值的影响，只有在数据呈均匀分布或者正态分布的情况下才会有意义

辛普森悖论告诉我们，有的时候，在分组比较中占优势的一方，在总评中反而可能是失势的一方，平均值需要看它的分组构成，而不是简单地用平均值去代表所有的整体

## 大数定律与小数陷阱

- 大数定律：当随机事件发生的次数足够多（趋向无穷）时，发生的频率才会趋近于预期的概率
- 小数陷阱：每次的事件其实和上一次的事件是独立且随机的，某些事件在刚开始概率更高，并不意味着后面发生的概率会降低

## [期望值](/数学/概率论与数理统计.md#期望值)

反映在大数定律下多次执行某件事情之后，得到的一个最可能的收益结果

## 随机对照试验

通过多组[随机试验](/数学/概率论与数理统计.md#样本空间和随机事件)来验证一个理论和假设是否真实，AB测试就是一种随机对照试验

## 直方图与幂分布

- 直方图是展示数据的分布，而柱状图是比较数据的大小

从直方图体现出来呈指数下降或者上升的分布形式，叫做“幂律分布”

帕累托法则：二八定律

### 拉普拉斯分布

跟[正态分布](/数学/概率论与数理统计.md#常用连续型分布)相反，这种分布从左到右，斜率先缓慢增大再快速增大，到达最高点后变为负值继续先快速减小，最后再缓慢地减小

![拉普拉斯分布](/assets/2022112020352.webp)

这种分布在资源导向的场景比较多见，比如股市、房价，越塔尖的个体越具有资源吸附能力

## 散点图与相关性

- 散点图反映的是两个变量之间的关系
- 为了能够明确展示数据之间的趋势，Y 轴必须要从零开始
- 为了表示趋势的清晰，一般都会添加一条趋势线来表明背后的规律

一些散点图的分布规律：

- 正相关、负相关
- 指数相关
- 正U分布和反U分布：当达到一定程度，资源投入越多、获得收益反而更少
- 无相关
- 更为复杂的情况

误区：

- 误判趋势：数据整体还不够完整，错误判断了这个数据的未来增长趋势
- 德克萨斯枪手谬误：数据是否代表了整体
- 幸存者偏差：在分析散点图的时候看到了规律，还要了解最终这个规律形成的原因和背后的场景

## 标准差

代表一组数值和平均值相比分散开来的程度。也就是说，标准差大代表大部分的数值和平均值差异比较大，标准差小代表这组数字比较接近平均值

标准误差代表一种推论的估计，它反映的是多次抽样当中样本均值之间的离散程度

## 数据抽样

小数据抽样：

1. 简单随机抽样：从总体 N 个单位中随机地抽取 m 个单位作为样本，使得每一个样本被抽中的概率相同
2. 系统抽样：依据一定的抽样距离，从整体中抽取样本，即限定每轮抽样的数据范围都不同
3. 分层抽样：将抽样单位按某种特征或某种规则划分为不同的层，然后从不同的层中独立、随机地抽取样本，从而保证样本的结构接近于总体的结构
4. 整群抽样：将总体中若干个单位合并为组（这样的组被称为群），抽样时直接抽取群，然后对所选群中的所有单位实施调查

分层抽样是先分层再从各层抽样本，整群抽样是先分群再抽一个群调查

大数据抽样：

1. 蓄水池算法
2. 过采样
3. 欠采样

```java
public class ReservoirSampling {
    private int[] ALL; // 整体的水池中的数据
    private final int N = 100000; // 整体数据规模
    private final int K = 1000; // 水池规模
    private Random random = new Random();
    public void setUp() throws Exception {
        ALL = new int[N];
        for (int i = 0; i < N; i++) {
            ALL[i] = i;
        }
    }
    private int[] Sampling(int K) {
        int[] Pool = new int[K];
        for (int i = 0; i < K; i++) { // 前面K条数据直接进入水池
            Pool[i] = ALL[i];
        }
        for (int i = K; i < N; i++) { // K + 1个元素开始进行概率采样
            int r = random.nextInt(i + 1);  //这就是K/N的概率
            if (r < K) {
                Pool[r] = ALL[i]; //如果被选中了，那么这条数据就被从蓄水池中挤出来，新数据进去
            }
        }
        return Pool;
    }
}
```

![过采样、欠采样](/assets/20221121203334.webp)

## 指数

指数 = 变量值/标准值 x 100

指数公式本身很简单，关键在于指数公式的背后，要如何去制定一个能够保持指数有效性的规则

从股市上证沪深指数，到互联网用户忠诚指数，都需要定义解释一系列规则来创建这样的一个指数

要制定某个指数，比方说设定 KPI 的时候，我们要注意不要光看公式的建立，而是要把一系列定义调整的制度算法规定出来

## 回归

- [线性回归](/数学/线性代数.md#线性回归)
- 逻辑回归：广泛用于做分类问题，也就是把“成功 / 失败”“哪一种颜色”这类问题变成线性回归的样子
- 多项式回归：可能出现多个指数的数据，这种回归最佳拟合的线也不是直线，很可能是一个曲线
- 均值回归：实际发生的数据比理论上的预测更加接近平均值，整体趋势上会慢慢向一个平均值发展

两个变量之间有回归逻辑，不代表着两个变量之间有因果逻辑

![逻辑回归](/assets/20221122194042.webp)

## 马尔可夫链

- 马尔可夫链蒙特卡罗算法（MCMC）：通过多次独立重复的随机实验来模拟确定性的概率分布

## 用数据说话

### 问题确定

和利益无关的问题都不值得做数据分析，值得的一个是带来更多的收入，一个是帮着节约成本

提出问题 -> 提出理想 -> 结构化分析

### 数据采集

- 一手数据：主要来自企业内部的大数据平台、数据仓库以及相关系统，还有部分数据来自用户访谈和调研问卷以及内部沉淀的历史文档
- 二手数据：是来自行业内的数据或者企业内二次加工过，有失真的可能

1. 趋势分析法：找到某一个类型的数据之后，捕捉这个数据一个时间段以内的变化。通过这些数据变化，我们去知道曾经有哪些变化、对结果数据会有哪些影响，这样可以找到其中关键的问题和原因
2. 快照扩展法：截取某个时点的情况，然后通过下钻的方式来扩展这个指标的分布情况。我们会看在这个时点里面我们各部分对于整体的占比和影响程度
3. 衍生指标法：进一步进行数据的加工，制造出一些衍生指标来拨开迷雾，衍生指标就像几何当中的辅助线一样，会帮助我们看到更有意义的数据

### 数据揭示

- 讲好故事

### 实践

改变和创新的扩散过程是要有一个周期的，参考埃弗雷特·罗杰斯（E.M.Rogers）提出创新扩散模型

观点的认知到具体落实到行动，理性行为理论：一件事，从认知到行动意图，不但是有主观的个体认知，同时客观的世界也是一种规范作用

## 可视化

可视化图使用的情况：

- 分布
- 时间相关
- 局部/整体
- 偏差
- 相关性
- 排名
- 量级
- 地图
- 流动

