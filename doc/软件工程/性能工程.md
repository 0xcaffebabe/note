# 性能工程

## 性能指标

- 响应时间 某个请求从发出到接收到响应消耗的时间
- 吞吐量 系统在单位时间内可以处理的请求数量，通常使用QPS来衡量
- 并发用户数 系统能同时处理的并发用户请求数量
- 扩展性
- 资源使用效率
- ...

## 定律与数理基础

- 二八定律
- 阿姆达尔定律：优先加速占用时间最多的模块，性能优化的计划可以做出准确的效果预估和整个系统的性能预测
- 科特尔法则：长期的平均客户人数（N）等于客户抵达速度（X）乘以客户在这个系统中平均处理时间
- [概率论与数理统计](/通识/概率论与数理统计.md)

### 点估计指标

- 平均值：容易受极端值影响
- 中位数：如果数据呈现一些特殊的分布，比如二向分布，中位数的表达会受很大的负面影响
- 四分位数：把所有数值由小到大排列，并分成四等份，处于三个分割点位置的数值就是四分位数
- 百分位数：以 Pk 表示第 k 个百分位数，不容易受极端值影响
- 方差/标准差：变量的离散程度，也就是该变量离其期望值的距离

### 分布模型

- 泊松分布：适合于描述单位时间内随机事件发生的次数的概率分布
- 二项分布：n 个独立的是 / 非试验中成功的次数的离散概率分布
- 正态分布：大多数我们碰到的未知数据都呈正态分布状

### 排队论

![2022728163048](/assets/2022728163048.webp)

## 性能数据分析

目的：正不正常、趋势预测、问题排查

- 线性回归分析：通过拟合自变量与因变量之间最佳线性关系，来预测目标变量
- 分类
- 聚类
- 决策树

分析需要注意的：

1. 数据分析可以证实数据的相关性，但是还需要其他知识才能更准确地判断谁是因、谁是果
2. 数据的大小与趋势解读与业务强相关
3. 垃圾数据进垃圾数据出
4. 理解各个性能指标的关系

## 性能数据展示

难点：数据量大、数据复杂、背后问题复杂、牵扯模块多

在展示时，以不同视图体现不同重点，给足上下文信息

1. 表格：理解各个性能指标的关系
2. 线图：显示一段时间内这个变量的变化或趋势
3. PDF图、CDF图：一个变量的概率数据，较为特殊的线图
4. 面积图
5. 柱状图：用于比较不同类别的数量
6. 散点图：用于展示数据的分布情况
7. 饼图：需要显示比例数据或者百分比时
8. 树形图：对于显示类别和子类别之间的层次结构和比较值非常有用
9. 热力图：使用颜色反映数据的重要情况

![PDF、CDF](/assets/2022728172431.webp)

## 性能优化

- 集群
  - 将多台服务器组成集群，使用负载均衡将请求转发到集群中
- 缓存
  - 缓存对于性能的提升体现在响应时间上
- 异步
  - 将消息发送到消息队列之后立即返回，之后这个操作会被异步处理
