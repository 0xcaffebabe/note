# 架构

架构满足了应用程序的非功能性需求：可维护性、可测试下、可扩展性、可部署性等。

架构的分类：

- 基础架构 以云平台 操作系统等基础设施为主
- 中间件与大数据架构
- 业务系统架构
    - 通用软件系统 办公软件 浏览器等一类
    - 离线业务系统 大数据分析 数据挖掘系统
    - 在线业务系统 在线为特定业务服务的系统

这些不同分类的架构界限不是很清晰 随着时间演进 各个类型之间的系统边界会互相渗透

架构视图：

![屏幕截图 2021-01-18 170117](/assets/屏幕截图%202021-01-18%20170117.png)

- 逻辑
- 物理
- 应用
- 技术
- 功能
- 部署

架构体系框架：

- ABSD
- DSSA
- AT

## 架构的演进

站在后端开发人员的角度上软件架构风格从大型机（Mainframe），到原始分布式（Distributed），到大型单体（Monolithic），到面向服务（Service-Oriented），到微服务（Microservices），到服务网格（Service Mesh），到无服务（Serverless）

谈起微服务，会想到技术异构，便于部署，高性能等等，但这些似乎都只是锦上添花，架构的核心在于解决软件的存活问题，如果一个软件压根就不能提供服务，这些锦上添花的功能也毫无作用

## 架构认知的派别

### 组成派

架构由 模块/服务/领域 组成

本质在描述组件与组件之间的交互（画各种架构图）

### 决策派

软件架构由一个个决策组成的有机整体（把架构比作城市规划）

每个做的决策都有它背后的原因

## 架构的目标

用最小的人力成本来满足构建和维护该系统的需求

- 乱麻系统

过度的自信导致软件维护成本持续上升

### 两个维度

- 行为价值
  - 让系统正常运行
- 架构价值
  - 让系统更容易修改

## 架构的意义

### 项目干系人交流的手段

语境不同、立场不同、渠道问题等导致的语义失真 所以使用架构作为手段沟通

### 演进有助于原型的确定与设计

- 拆迁者模式（直接替换转移）
- 绞杀者模式（逐步替换转移，直至旧系统全部消失）
- 修缮者模式（同上，老旧系统共存 逐步替换）

### 早期设计决策的体现

如果做架构决策：

- SWOT分析
- RASCI决策

### 明确系统实现的约束条件

![202191322132](/assets/202191322132.jpg)

RAID矩阵：

|-|Risk | Assumption | Issue | Dependency
-|-|-|-|-
决策1|||||
决策2|||||
决策3|||||

### 是组织架构的反映 会影响组织架构

- 康威定律

### 是可复用、可传递的模型

- 方法论
- 模型

架构可复用的内容一般都是比较少的，每个项目的架构肯定不能照搬 需要裁剪

为了复用，需要对架构资产进行更新与保留，拥有一个知识传承的平台

## 四种架构模式

### 分层

也就说传统的水平分层架构，在项目初期很合适

```java
package controller{
    Controller;
}
package service {
    Service;
    ServiceImpl;
}
package dao {
    Dao;
}
```

### 按功能封装

即垂直切分

```java
package Order {
    OrderController;
    OrderService;
    OrderDao;
}
```

### 端口与适配器

```java
package controller{...}

package domain {
    Service;
    ServiceImpl;
    Domain;
}

package dao{...}
```

### 按组件封装

优点服务架构的味道

```java
package controller {...}
package order {
    Service;
    Dao;
}
```

## COLA

### 扩展设计

在系统设计时，针对业务或者场景预留一些扩展点

## 架构的未来

- 云化：XaaS
- 演进式

## 具体技术下的架构

- 单体架构：Spring Boot

使用传统的分层，打成一个jar包 运行它

![20201027154734](/assets/20201027154734.png)

- 微服务：Spring Cloud

高可用 高性能等需求使我们不得不对系统进行拆分，在前面的单体架构下，分成多个工程 业务代码与服务基础设施代码耦合在一起 构成了传统的微服务，也是目前最流行的架构

![20201027154755](/assets/20201027154755.png)

- 微服务：K8S

在传统的微服务下，基础设施代码与业务代码耦合在一起，这个阶段下使用了K8S的容器基础设施来完成大部分服务治理功能，应用程序可以更专注我们的业务

![20201027154819](/assets/20201027154819.png)

- 服务网格：Istio

K8S将服务治理沉淀到基础设施只是第一步，接下来服务网格将这事做的更加彻底，更加可管理 可观测

![20201027154819](/assets/20201027154819_k1n1l7oa8.png)

- 另外一条支线：无服务

上传代码，某些事件会触发你的代码运行它，彻底不用管理基础设施，一切交给云
