---
tags: ['前端监控', '可观测性', '性能监控', '前端性能', '指标体系']
---

# 前端监控体系设计

## 一、前端监控的本质

### 1. 核心命题

前端监控的本质并不是“收集日志”，而是：

> 构建面向用户体验与系统稳定性的可观测性体系

其目标可以抽象为三层价值：

* **体验可观测**：页面性能是否健康
* **问题可追踪**：异常是否可定位
* **行为可分析**：用户行为是否可理解

---

### 2. 前端监控的三个基本维度

任何前端监控系统，本质上都围绕三类数据展开：

| 类型          | 本质     | 目的     |
| ----------- | ------ | ------ |
| Metrics（指标） | 可量化的数值 | 衡量体验质量 |
| Logs（日志）    | 事件记录   | 还原问题现场 |
| Traces（链路）  | 过程追踪   | 定位因果关系 |

---

### 3. 监控体系的核心能力

一个完整的前端监控体系，需要同时具备：

* 采集能力
* 上报能力
* 分析能力
* 归因能力
* 告警能力

这些能力共同构成“前端可观测性闭环”。

---

# 二、前端监控的体系架构

## 1. 整体分层模型

从系统设计角度，前端监控可抽象为四层结构：

```
┌──────────────────────────┐
│        展示分析层         │
│  Dashboard / 告警 / 报表  │
└──────────▲───────────────┘
           │
┌──────────┴───────────────┐
│        数据处理层         │
│  聚合 / 清洗 / 归因 / 存储│
└──────────▲───────────────┘
           │
┌──────────┴───────────────┐
│        上报网关层         │
│  接收 / 限流 / 缓存       │
└──────────▲───────────────┘
           │
┌──────────┴───────────────┐
│        SDK采集层          │
│  浏览器端数据收集         │
└──────────────────────────┘
```

---

## 2. 核心数据流

监控数据的生命周期可以概括为：

```
事件发生 → SDK采集 → 本地处理 → 上报 → 聚合分析 → 展示告警
```

这是前端监控系统的“第一性原理流程”。

---

# 三、数据模型设计

## 1. 基础数据模型

所有前端监控日志，都可以抽象为一个统一的基础结构：

```
基础信息 + 环境信息 + 业务信息 + 扩展信息
```

### （1）全局基础字段

| 字段        | 作用      |
| --------- | ------- |
| traceId   | 全链路唯一标识 |
| type      | 日志类型    |
| createAt  | 日志产生时间  |
| updatedAt | 日志更新时间  |
| level     | 日志级别    |

---

### （2）环境信息

| 分类    | 字段                    |
| ----- | --------------------- |
| 浏览器信息 | userAgent、browserType |
| 页面信息  | url、pageId、title      |
| 用户信息  | userId、fingerprintId  |
| 设备信息  | clientType            |
| 业务信息  | appId、appName         |

这些字段解决的是：

> “这条日志发生在什么环境中”

---

## 2. 事件级数据模型

在基础模型之上，不同类型事件拥有各自的专属字段：

### （1）异常日志

| 字段      | 含义     |
| ------- | ------ |
| message | 错误信息   |
| stack   | 调用栈    |
| dataId  | 问题唯一ID |
| type    | 异常类型   |

---

### （2）网络请求日志

| 字段          | 含义     |
| ----------- | ------ |
| url         | 接口地址   |
| method      | 请求方法   |
| status      | HTTP状态 |
| elapsedTime | 耗时     |
| body        | 请求参数   |

---

### （3）性能指标日志

| 字段     | 含义   |
| ------ | ---- |
| name   | 指标名称 |
| value  | 当前值  |
| delta  | 差值   |
| rating | 等级   |

---

### （4）用户行为日志

| 字段       | 含义   |
| -------- | ---- |
| name     | 行为名称 |
| type     | 行为类型 |
| category | 行为分类 |
| time     | 发生时间 |

---

# 四、指标体系设计

## 1. 性能指标（WebVitals）

前端性能监控的核心是围绕用户体验的量化指标。

### 核心体验指标

| 指标   | 关注点   |
| ---- | ----- |
| LCP  | 加载速度  |
| FID  | 交互响应  |
| CLS  | 视觉稳定  |
| INP  | 综合交互  |
| FCP  | 首次渲染  |
| TTI  | 可交互时间 |
| TBT  | 主线程阻塞 |
| TTFB | 网络响应  |

---

### 指标分级标准

| 指标   | 优秀     | 需要改进       | 较差      |
| ---- | ------ | ---------- | ------- |
| LCP  | <2.5s  | 2.5s~4s    | >4s     |
| FID  | <100ms | 100~300ms  | >300ms  |
| CLS  | <0.1   | 0.1~0.25   | >0.25   |
| FCP  | <1.8s  | 1.8~3s     | >3s     |
| INP  | <200ms | 200~500ms  | >500ms  |
| TTFB | <800ms | 800~1800ms | >1800ms |

---

### 时间线关系

```
TTFB → FP → FCP → LCP
```

这条时间线反映了：

> 页面从“开始加载”到“核心内容可见”的完整过程

---

# 五、采集层设计

采集层是监控体系的入口，其本质是：

> 将浏览器运行时的各种信号转化为结构化事件

---

## 1. 异常采集

### （1）接口异常监听

通过拦截网络请求，实现对：

* HTTP 错误码
* 请求超时
* 请求中断

的统一监控。

---

### （2）脚本与资源异常

通过全局异常捕获：

* `window.onerror`
* `unhandledrejection`
* 框架级 errorHandler

实现：

* JS 运行异常
* 资源加载异常

的统一感知。

---

## 2. 用户行为采集

通过全局事件监听，采集用户行为轨迹：

* 鼠标点击
* 键盘输入
* 触摸事件
* 路由跳转

形成：

> 行为 breadcrumbs（行为面包屑）

用于问题归因。

---

# 六、上报层设计

## 1. 上报方式

常见三种方案：

| 方式         | 特点     |
| ---------- | ------ |
| fetch/xhr  | 通用可靠   |
| Beacon API | 页面卸载安全 |
| 图片打点       | 最轻量    |

不同场景选择不同策略：

* 常规日志：fetch/xhr
* 页面关闭：beacon
* 兼容降级：图片打点

---

## 2. 工程策略

在上报层通常需要：

* 合并上报
* 节流限流
* 本地缓存
* 离线重试

这些策略决定了系统的稳定性。

---

# 七、治理与分析

监控的终极目标不是“数据收集”，而是“问题治理”。

## 1. 核心分析场景

* 性能趋势分析
* 异常聚合归因
* 用户行为路径
* 版本对比

---

## 2. 告警策略

* 阈值告警
* 同比告警
* 环比告警
* 错误突增告警

---

# 八、工程实践原则

一个成熟的前端监控系统应遵循：

1. 错误全量，性能抽样
2. 尽量不影响业务
3. 可降级、可兜底
4. 数据可回溯
5. 指标可解释

---

# 九、总结

## 前端监控的本质公式

```
前端监控 = 体验可观测 + 问题可追踪 + 行为可分析
```

## 核心闭环

```
采集 → 上报 → 分析 → 告警 → 治理 → 优化
```

---

通过以上体系化设计，前端监控从：

> “日志收集工具”

升级为：

> “面向用户体验的可观测平台”

## 关联内容（自动生成）

- [/软件工程/架构/系统设计/可观测性.md](/软件工程/架构/系统设计/可观测性.md) 前端监控是系统可观测性的重要组成部分，与日志、指标、追踪等核心技术密切相关
- [/中间件/浏览器/前端性能优化.md](/中间件/浏览器/前端性能优化.md) 前端监控与性能优化相辅相成，监控数据为性能优化提供依据，性能指标是监控体系的核心内容
- [/软件工程/架构/Web前端/Web前端.md](/软件工程/架构/Web前端/Web前端.md) 前端监控是前端可观测性体系的重要实现，与前端整体架构和开发实践密切相关
- [/软件工程/架构/系统设计/监控系统设计.md](/软件工程/架构/系统设计/监控系统设计.md) 前端监控是监控系统的一个专门领域，遵循通用的监控系统设计原则和架构模式
- [/数据技术/数据分析.md](/数据技术/数据分析.md) 前端监控产生的数据需要通过数据分析方法进行处理和洞察，指标体系与数据分析的维度建模相关
- [/软件工程/架构/Web前端/前端工程化.md](/软件工程/架构/Web前端/前端工程化.md) 前端监控是前端工程化治理体系的重要组成部分，涉及质量、性能、可观测性等方面
- [/软件工程/性能工程/性能优化.md](/软件工程/性能工程/性能优化.md) 前端监控中的性能指标（Web Vitals等）是性能工程在前端领域的具体实践
- [/数据技术/数据治理.md](/数据技术/数据治理.md) 前端监控数据的管理和使用需要遵循数据治理的原则，特别是指标体系的标准化
- [/软件工程/架构/系统设计/日志.md](/软件工程/架构/系统设计/日志.md) 前端监控中的异常日志、行为日志等与系统日志的设计和管理原则相通
- [/软件工程/微服务/微服务.md](/软件工程/微服务/微服务.md) 前端监控与后端微服务的监控体系需要打通，形成端到端的可观测性
