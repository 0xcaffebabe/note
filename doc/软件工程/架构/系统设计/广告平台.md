
# 广告平台

```mermaid
sequenceDiagram
    participant User as 用户
    participant App as 应用/媒体端
    participant Engine as 广告投放引擎
    participant Data as 数据与分析
    participant AI as 智能化模块
    participant Support as 审核与风控
    participant Adv as 广告主端

    User ->> App: 打开应用，请求广告位
    App ->> Engine: 发送广告请求
    Engine ->> Support: 检查广告位与素材合规性
    Support -->> Engine: 返回审核结果

    Engine ->> Data: 查询用户画像/历史行为
    Data -->> Engine: 返回用户标签与分析结果
    Engine ->> AI: 请求智能定向/出价优化
    AI -->> Engine: 返回推荐广告候选

    Engine ->> Adv: 拉取可投放的广告素材
    Adv -->> Engine: 返回广告创意与出价

    Engine ->> Engine: 进行实时竞价和排序 (RTB)
    Engine -->> App: 返回最优广告

    App -->> User: 展示广告
    User ->> App: 点击广告
    App ->> Data: 上报点击/转化事件
    Data ->> Adv: 归因与报表统计
    Data ->> Support: 风控检测，防作弊
```

## 模型

### 广告需求模型

广告需求模型 = 广告主意图的结构化表达 + 平台投放优化的需求强度预测

```mermaid
sequenceDiagram
    participant Adv as 广告主
    participant Platform as 广告平台
    participant Model as 广告需求模型
    participant Engine as 投放引擎
    participant User as 用户/媒体端

    Adv ->> Platform: 提交广告需求<br/>合同/计划/创意
    Platform ->> Model: 解析需求<br/>目标、预算、定向、时间、创意
    Model -->> Platform: 输出结构化需求对象

    Platform ->> Engine: 下发广告计划
    Engine ->> Engine: 结合需求模型进行竞价与排序<br/>eCPM=出价×CTR×质量因子
    Engine -->> User: 返回最优广告

    User ->> User: 浏览/点击/转化
    User ->> Platform: 上报曝光/点击/转化日志
    Platform ->> Model: 更新CTR/CVR预估
    Model -->> Platform: 反馈优化参数
    Platform ->> Adv: 生成投放报表与效果评估

```

### 广告投放模型

广告需求模型：侧重于广告主的需求

广告投放模型：侧重于广告平台如何投放

包含：

1. 流量预测与定向
2. 点击率/转化率预估（CTR/CVR Prediction）
3. 出价与竞价策略
4. 投放控制
5. 效果反馈与优化

#### 计费模型

定义：广告主和平台之间如何结算费用

- CPC（Cost Per Click）：按点击收费
- CPM（Cost Per Mille）：每千次曝光收费
- CPA（Cost Per Action）：按转化（注册、下单等）收费
- CPT（Cost Per Time）：按时间段买断广告位（比如开屏广告一天 100 万）
- oCPX（Optimized Cost Per X）：平台通过智能投放，优化某个目标（点击、转化、留存）

## 广告投放引擎

### 广告投放引擎核心组件

1. **广告请求接收层 (Ad Request Handler)**

   * 接收用户页面或 APP 的广告请求。
   * 验证请求合法性和必需参数。

2. **用户/受众数据服务 (User Profile / Audience Service)**

   * 提供用户特征、兴趣、历史行为等数据。
   * 支撑定向投放。

3. **广告库存管理 (Ad Inventory / Campaign Service)**

   * 管理可投放的广告及广告预算。
   * 包含广告投放规则、投放时间、竞价信息等。

4. **匹配与竞价引擎 (Ad Matching & Bidding Engine)**

   * 根据广告请求 + 用户信息 + 广告库存进行匹配。
   * 支持实时竞价（RTB）或固定优先级投放。

5. **广告排序与优化 (Ranking & Optimization)**

   * 根据点击率预测 (CTR)、转化率预测 (CVR)、收益优化等对候选广告排序。

6. **广告决策输出 (Ad Decision / Response)**

   * 返回最终广告给前端展示。

7. **监控与统计 (Analytics / Reporting Service)**

   * 记录曝光、点击、转化等事件，用于优化和计费。

---

```mermaid
sequenceDiagram
    participant User as 用户端
    participant AdReq as 广告请求接收层
    participant Profile as 用户数据服务
    participant Inventory as 广告库存管理
    participant Match as 匹配与竞价引擎
    participant Rank as 排序与优化
    participant Response as 广告响应层
    participant Analytics as 监控统计服务

    User->>AdReq: 请求广告
    AdReq->>Profile: 获取用户画像
    AdReq->>Inventory: 获取可投放广告
    Inventory->>Match: 提供候选广告
    Profile->>Match: 提供用户信息
    Match->>Rank: 进行排序与优化
    Rank->>Response: 返回最终广告
    Response->>User: 展示广告
    Response->>Analytics: 上报曝光数据
    User->>Analytics: 上报点击/转化事件
```
