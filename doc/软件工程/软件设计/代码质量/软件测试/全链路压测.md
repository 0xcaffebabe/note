# 全链路压测

流量洪峰 -> 容量评估（极限水位，极限表现） -> 发现问题（隐患挖掘，瓶颈调优） -> 容量规划（资源规划，限流设定）

既要匹配真实的场景，并且也要隔离测试与生产的环境、数据

## 目标

- 逐步提升流量目标 朝最终目标前进
- 确保压测系统指标处于合理范围
- 保证压测时系统的稳定性、数据的一致性、以及压测停止后系统能恢复

## 场景

确定场景边界，进行场景细分，可以对单点压测，也可以对多个场景混合，以探索不同场景下的性能表现

- 重点业务
- 热点业务
- 二者关联的业务

## 改造

### 代码改造

- 隔离生产流量与测试流量

0. 在流量端点要考虑登录、鉴权、CSRF等问题
1. 在流量入口处对流量打标，对于流量的传递，可利用原有的链路追踪系统来标识全链路压测，而在代码内，同线程内可使用ThreadLocal来标识链路，跨线程则需要在并发工具相关的创建入口携带相关链路标识，以保证完整的链路追踪
2. 对于数据存储使用正常存储与影子存储隔离数据
3. 对于外部调用使用Mock

