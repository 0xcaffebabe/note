![](http://favorites.ren/assets/images/2017/springcloud/configbus2.jpg)

- 添加依赖（服务端与客户端

    ```xml
     <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-bus-amqp</artifactId>
        </dependency>
    ```

- 配置服务端

```yml

  rabbitmq:
    host: 127.0.0.1
    port: 5672
    username: guest
    password: guest

management:
  endpoints:
    web:
      exposure:
        include: bus-refresh
  endpoint:
    bus-refresh:
      enabled: true
```

- 配置客户端

```properties
## 刷新时，关闭安全验证
management.endpoints.web.exposure.include=bus-refresh
## 开启消息跟踪
spring.cloud.bus.trace.enabled=true
```

当配置发生更新时，post调用http://localhost:8003/actuator/bus-refresh

新配置就会传播到所有客户端

# 局部刷新

在调用webhook的时候，可以指定参数来指定更新要传播到哪些微服务

# 总线事件

访问http://127.0.0.1:8003/actuator/trace可以追踪