{"name":"Redis","id":"ä¸­é—´ä»¶-æ•°æ®åº“-redis-Redis","content":"# Redis\n\n## ä¸€ã€Redis çš„è®¾è®¡å“²å­¦ï¼ˆWhy Redis Existsï¼‰\n\n### 1. Redis çš„ç¬¬ä¸€æ€§åŸç†\n\nRedis çš„æœ¬è´¨ä¸æ˜¯ã€Œç¼“å­˜å·¥å…·ã€ï¼Œè€Œæ˜¯ä¸€ä¸ªï¼š\n\n> **ä»¥æä½å»¶è¿Ÿä¸ºç¬¬ä¸€ç›®æ ‡çš„ã€ä»¥å†…å­˜ä¸ºä¸»ä»‹è´¨çš„ã€å•å…³é”®è·¯å¾„äº‹ä»¶é©±åŠ¨æ•°æ®åº“ç³»ç»Ÿ**ã€‚\n\nç”±æ­¤å†³å®šäº† Redis çš„æ‰€æœ‰æ ¸å¿ƒè®¾è®¡å–èˆï¼š\n\n* å»¶è¿Ÿä¼˜å…ˆäºåå\n* å¯é¢„æµ‹æ€§ä¼˜å…ˆäºåŠŸèƒ½å¤æ‚åº¦\n* ç®€å•æ¨¡å‹ä¼˜å…ˆäºå¼ºä¸€è‡´è¯­ä¹‰\n\n### 2. Redis è§£å†³çš„é—®é¢˜è¾¹ç•Œ\n\nRedis å¤©ç”Ÿé€‚åˆï¼š\n\n* å»¶è¿Ÿæ•æ„Ÿå‹è¯»å†™ï¼ˆsub-ms ~ msï¼‰\n* çƒ­ç‚¹æ•°æ®ã€é«˜è®¿é—®é¢‘ç‡æ•°æ®\n* å¯å®¹å¿å¼±ä¸€è‡´æˆ–æ•°æ®ä¸¢å¤±çš„ä¸šåŠ¡\n\nRedis å¤©ç”Ÿä¸é€‚åˆï¼š\n\n* å†·æ•°æ®ã€è¶…å¤§æ•°æ®é›†ï¼ˆæˆæœ¬æ¨¡å‹ä¸æˆç«‹ï¼‰\n* å¤æ‚æŸ¥è¯¢ä¸å…³ç³»è¿ç®—ï¼ˆæ•°æ®æ¨¡å‹ä¸æ”¯æŒï¼‰\n* å¼ºäº‹åŠ¡ã€è·¨ Key å¼ºä¸€è‡´ï¼ˆè®¾è®¡ç›®æ ‡å†²çªï¼‰\n\n> **è¾¹ç•Œè®¤çŸ¥æ˜¯ Redis ä½¿ç”¨æ­£ç¡®ä¸å¦çš„åˆ†æ°´å²­ã€‚**\n\n---\n\n## äºŒã€Redis çš„æ•´ä½“ç³»ç»Ÿæ¨¡å‹ï¼ˆGlobal Architectureï¼‰\n\n### 1. è¯·æ±‚å¤„ç†çš„å…³é”®è·¯å¾„æ¨¡å‹\n\n```text\nå®¢æˆ·ç«¯è¯·æ±‚\n   â†“\nç½‘ç»œ IOï¼ˆepoll / IO threadsï¼‰\n   â†“\nå‘½ä»¤è§£æä¸æ ¡éªŒ\n   â†“\näº‹ä»¶å¾ªç¯ï¼ˆå•çº¿ç¨‹å…³é”®è·¯å¾„ï¼‰\n   â†“\nå†…å­˜æ•°æ®ç»“æ„æ“ä½œ\n   â†“\nç»“æœå›å†™ + åç½®ä»»åŠ¡ï¼ˆAOF / replicationï¼‰\n```\n\n**æ ¸å¿ƒè®¤çŸ¥ï¼š**\n\n* Redis çš„æ€§èƒ½ç“¶é¢ˆåªå­˜åœ¨äº **å…³é”®è·¯å¾„**\n* ä»»ä½•è¿›å…¥å…³é”®è·¯å¾„çš„ O(n) æ“ä½œï¼Œéƒ½ä¼šç›´æ¥è½¬åŒ–ä¸ºç³»ç»Ÿçº§é˜»å¡\n\n---\n\n### 2. ä»€ä¹ˆæ˜¯ã€Œå•çº¿ç¨‹æ¨¡å‹ã€\n\nRedis æ‰€è°“çš„ã€Œå•çº¿ç¨‹ã€ï¼ŒæŒ‡çš„æ˜¯ï¼š\n\n> **åªæœ‰ä¸€æ¡çº¿ç¨‹è´Ÿè´£â€œå‘½ä»¤æ‰§è¡Œå…³é”®è·¯å¾„â€**ã€‚\n\nå¹¶ä¸æ„å‘³ç€ï¼š\n\n* æ²¡æœ‰åå°çº¿ç¨‹\n* æ²¡æœ‰ IO å¹¶è¡Œ\n\n### 3. Redis çš„çº¿ç¨‹åˆ†å·¥æ¨¡å‹\n\n* **ä¸»çº¿ç¨‹ï¼ˆå…³é”®è·¯å¾„ï¼‰**\n\n  * å‘½ä»¤è§£æ\n  * æ•°æ®ç»“æ„æ“ä½œ\n  * ç»“æœè¿”å›\n\n* **BIO åå°çº¿ç¨‹**ï¼ˆéå…³é”®è·¯å¾„ï¼‰\n\n  * AOF fsync\n  * lazy free\n  * æ–‡ä»¶å…³é—­\n\n* **IO å¤šçº¿ç¨‹ï¼ˆ6.0+ï¼‰**\n\n  * ç½‘ç»œè¯»å†™å¹¶è¡ŒåŒ–\n  * ä½†å‘½ä»¤æ‰§è¡Œä»å›åˆ°ä¸»çº¿ç¨‹\n\n> **è®¾è®¡åŸåˆ™ï¼šåªè¦ä¸å½±å“ç¡®å®šæ€§ï¼Œå°±å¹¶è¡Œï¼›åªè¦å½±å“ç¡®å®šæ€§ï¼Œå°±ä¸²è¡Œã€‚**\n\n---\n\n## ä¸‰ã€äº‹ä»¶é©±åŠ¨ä¸é˜»å¡çš„æœ¬è´¨\n\n### 1. Reactor æ¨¡å‹åœ¨ Redis ä¸­çš„ä½“ç°\n\nRedis ä½¿ç”¨ IO å¤šè·¯å¤ç”¨ï¼ˆepoll / kqueueï¼‰å®ç°ï¼š\n\n* é«˜å¹¶å‘è¿æ¥ç®¡ç†\n* éé˜»å¡äº‹ä»¶é€šçŸ¥\n\näº‹ä»¶ç±»å‹æŠ½è±¡ä¸ºä¸¤ç±»ï¼š\n\n* IO äº‹ä»¶ï¼šè¿æ¥ã€è¯»ã€å†™\n* æ—¶é—´äº‹ä»¶ï¼šå®šæ—¶ä»»åŠ¡ã€è¿‡æœŸå›æ”¶\n\n### 2. Redis ä¸­â€œé˜»å¡â€çš„ç»Ÿä¸€æŠ½è±¡\n\né˜»å¡ä¸æ˜¯çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œæ˜¯ï¼š\n\n> **å…³é”®è·¯å¾„è¢«é•¿æ—¶é—´å ç”¨ï¼Œå¯¼è‡´åç»­å‘½ä»¤æ— æ³•è¢«è°ƒåº¦**ã€‚\n\né˜»å¡åªå¯èƒ½å‘ç”Ÿåœ¨ä¸‰ç±»åœ°æ–¹ï¼š\n\n1. O(n) æ•°æ®ç»“æ„æ“ä½œ\n2. ç³»ç»Ÿè°ƒç”¨ï¼ˆfork / fsyncï¼‰\n3. èµ„æºç«äº‰ï¼ˆCPU / å†…å­˜ / IOï¼‰\n\n---\n\n## å››ã€æ•°æ®æ¨¡å‹ä¸å†…å­˜å“²å­¦\n\n### 1. Redis çš„å¯¹è±¡æ¨¡å‹\n\nRedis ä¸­æ‰€æœ‰æ•°æ®æœ€ç»ˆæŠ½è±¡ä¸ºï¼š\n\n* redisObject\n\n  * typeï¼ˆæ•°æ®ç»“æ„ï¼‰\n  * encodingï¼ˆå†…éƒ¨ç¼–ç ï¼‰\n  * lru / lfu\n\n**æ ¸å¿ƒæ€æƒ³ï¼š**\n\n> ç”¨å¤šç§å†…éƒ¨ç¼–ç ï¼Œåœ¨ç©ºé—´æ•ˆç‡ä¸æ“ä½œå¤æ‚åº¦ä¹‹é—´åŠ¨æ€å¹³è¡¡ã€‚\n\n### 2. å†…å­˜æ¶ˆè€—çš„ç³»ç»Ÿæ€§æ‹†è§£\n\nRedis å†…å­˜ â‰  ä¸šåŠ¡æ•°æ®å†…å­˜\n\nä¸»è¦æ„æˆï¼š\n\n1. å¯¹è±¡å†…å­˜ï¼ˆkey + valueï¼‰\n2. å®¢æˆ·ç«¯ç¼“å†²\n3. å¤åˆ¶ç¼“å†² / AOF ç¼“å†²\n4. å†…å­˜ç¢ç‰‡ï¼ˆallocator è¡Œä¸ºï¼‰\n5. å­è¿›ç¨‹ Copy-On-Write æˆæœ¬\n\n### 3. å†…å­˜ç¢ç‰‡çš„æœ¬è´¨\n\nç¢ç‰‡ä¸æ˜¯ bugï¼Œè€Œæ˜¯ï¼š\n\n> **é€šç”¨å†…å­˜åˆ†é…å™¨åœ¨é«˜é¢‘å˜é•¿å¯¹è±¡åœºæ™¯ä¸‹çš„å¿…ç„¶ç»“æœ**ã€‚\n\nRedis çš„æ²»ç†ç­–ç•¥ï¼š\n\n* jemalloc\n* active defrag\n* é«˜å¯ç”¨é‡å¯\n\n---\n\n## äº”ã€è¿‡æœŸã€å›æ”¶ä¸æ·˜æ±°ï¼šå»¶è¿Ÿå‹å¥½å‹æ²»ç†\n\n### 1. è¿‡æœŸé”®æ¸…ç†çš„è®¾è®¡ç›®æ ‡\n\nç›®æ ‡ä¸æ˜¯â€œç«‹å³é‡Šæ”¾å†…å­˜â€ï¼Œè€Œæ˜¯ï¼š\n\n> **åœ¨ä¸å½±å“å…³é”®è·¯å¾„å»¶è¿Ÿçš„å‰æä¸‹ï¼Œé€æ­¥å›æ”¶å†…å­˜**ã€‚\n\nå› æ­¤é‡‡ç”¨ï¼š\n\n* æƒ°æ€§åˆ é™¤ï¼ˆè®¿é—®è§¦å‘ï¼‰\n* å®šæœŸé‡‡æ ·ï¼ˆæ¦‚ç‡å›æ”¶ï¼‰\n\n### 2. æ·˜æ±°ç­–ç•¥çš„è®¾è®¡å“²å­¦\n\næ·˜æ±°ç­–ç•¥æœ¬è´¨æ˜¯åœ¨å›ç­”ï¼š\n\n> **å½“å†…å­˜ä¸è¶³æ—¶ï¼Œå“ªäº›æ•°æ®â€œæ›´ä¸å€¼å¾—æ´»ç€â€ï¼Ÿ**\n\nLRU / LFU å¹¶éç²¾ç¡®ç®—æ³•ï¼Œè€Œæ˜¯ï¼š\n\n* éšæœºé‡‡æ · + è¿‘ä¼¼ç»Ÿè®¡\n* ç”¨å¯é¢„æµ‹å»¶è¿Ÿæ¢å–å¯æ¥å—ç²¾åº¦\n\n---\n\n## å…­ã€æŒä¹…åŒ–ä¸å¯é æ€§ï¼šä¸æ€§èƒ½çš„äº¤æ˜“\n\n### 1. RDB ä¸ AOF çš„è§’è‰²åˆ’åˆ†\n\n* RDBï¼š\n\n  * å¿«ç…§\n  * å†·å¯åŠ¨å‹å¥½\n  * fork æˆæœ¬\n\n* AOFï¼š\n\n  * æ“ä½œæ—¥å¿—\n  * æ•°æ®å®‰å…¨\n  * fsync é£é™©\n\n### 2. fork çš„ç³»ç»Ÿä»£ä»·\n\nfork å¹¶ä¸å¤åˆ¶å†…å­˜ï¼Œä½†ï¼š\n\n* é¡µè¡¨å¤åˆ¶\n* å†™æ—¶å¤åˆ¶æ”¾å¤§\n\n**ç»“è®ºï¼š**\n\n> fork çš„æˆæœ¬ä¸â€œå†™å…¥é¢‘ç‡ Ã— å†…å­˜è§„æ¨¡â€å¼ºç›¸å…³ã€‚\n\n---\n\n## ä¸ƒã€åˆ†å¸ƒå¼ä¸æ‰©å±•çš„ç°å®è¾¹ç•Œ\n\n### 1. Redis é›†ç¾¤çš„æ ¸å¿ƒçŸ›ç›¾\n\nRedis Cluster çš„æœ¬è´¨æ˜¯ï¼š\n\n* Key çº§åˆ«åˆ†ç‰‡\n* æ— è·¨ Key åŸå­æ€§\n\nå› æ­¤ï¼š\n\n* é«˜æ‰©å±•æ€§\n* ä½äº‹åŠ¡èƒ½åŠ›\n\n### 2. æ•°æ®è¿ç§»çš„çœŸå®æˆæœ¬\n\nè¿ç§»ä¸æ˜¯æ‹·è´æ•°æ®ï¼Œè€Œæ˜¯ï¼š\n\n> **åœ¨è¿è¡Œä¸­å¼•å…¥é¢å¤–å…³é”®è·¯å¾„è´Ÿè½½**ã€‚\n\n---\n\n## å…«ã€è¿ç»´ä¸æ²»ç†ï¼šä»â€œç”¨å¥½â€åˆ°â€œå¯æ§â€\n\n### 1. å¯è§‚æµ‹æ€§çš„æ ¸å¿ƒæŒ‡æ ‡\n\n* å»¶è¿Ÿï¼ˆlatencyï¼‰\n* é˜»å¡äº‹ä»¶\n* å†…å­˜ä½¿ç”¨æ›²çº¿\n* fork / fsync æ—¶é—´\n\n### 2. é—®é¢˜å®šä½çš„æ–¹æ³•è®º\n\n1. æ˜¯å¦è¿›å…¥å…³é”®è·¯å¾„ï¼Ÿ\n2. æ˜¯å¦ O(n) æ“ä½œï¼Ÿ\n3. æ˜¯å¦ç³»ç»Ÿèµ„æºäº‰ç”¨ï¼Ÿ\n\n---\n\n## ä¹ã€Redis vs Memcachedï¼šè®¾è®¡å–å‘å¯¹æ¯”\n\n| ç»´åº¦     | Redis | Memcached |\n| ------ | ----- | --------- |\n| æ•°æ®æ¨¡å‹   | ä¸°å¯Œ    | KV        |\n| æŒä¹…åŒ–    | æ”¯æŒ    | ä¸æ”¯æŒ       |\n| é›†ç¾¤     | åŸç”Ÿ    | å®¢æˆ·ç«¯       |\n| CPU æ¨¡å‹ | å•å…³é”®è·¯å¾„ | å¤šçº¿ç¨‹       |\n\n> å·®å¼‚æ¥è‡ª**è®¾è®¡ç›®æ ‡ä¸åŒï¼Œè€Œéä¼˜åŠ£ä¹‹åˆ†**ã€‚\n\n---\n\n## åã€æ€»ç»“ï¼šRedis çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿\n\n* æŠŠ Redis å½“æˆ **å»¶è¿Ÿæ•æ„Ÿå‹ç³»ç»Ÿç»„ä»¶**\n* æ§åˆ¶è¿›å…¥å…³é”®è·¯å¾„çš„å¤æ‚åº¦\n* æ¥å—ä¸€è‡´æ€§ä¸åŠŸèƒ½çš„å¦¥å\n\n> **Redis çš„å¨åŠ›æ¥è‡ªå…‹åˆ¶ï¼Œè€Œéå †ç ŒåŠŸèƒ½ã€‚**\n\n## å…³è”å†…å®¹ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰\n\n- [/ä¸­é—´ä»¶/æ•°æ®åº“/redis/æŒä¹…åŒ–.md](/ä¸­é—´ä»¶/æ•°æ®åº“/redis/æŒä¹…åŒ–.md) ä»‹ç»äº†Redisçš„RDBå’ŒAOFæŒä¹…åŒ–æœºåˆ¶ï¼Œä¸Redisæ ¸å¿ƒæ¦‚å¿µå’Œæ¶æ„è®¾è®¡å¯†åˆ‡ç›¸å…³\n- [/ä¸­é—´ä»¶/æ•°æ®åº“/redis/é›†ç¾¤.md](/ä¸­é—´ä»¶/æ•°æ®åº“/redis/é›†ç¾¤.md) ä»‹ç»äº†Redis Clusterçš„åˆ†å¸ƒå¼æ¶æ„ï¼Œæ˜¯å¯¹Rediså•æœºæ¶æ„çš„æ‰©å±•å’Œè¡¥å……\n- [/ä¸­é—´ä»¶/æ•°æ®åº“/redis/æ•°æ®ç»“æ„.md](/ä¸­é—´ä»¶/æ•°æ®åº“/redis/æ•°æ®ç»“æ„.md) è¯¦ç»†é˜è¿°äº†Rediså„ç§æ•°æ®ç±»å‹çš„å†…éƒ¨å®ç°ï¼Œæ˜¯ç†è§£Redisæ€§èƒ½ç‰¹ç‚¹çš„åŸºç¡€\n- [/ä¸­é—´ä»¶/æ•°æ®åº“/redis/å“¨å…µ.md](/ä¸­é—´ä»¶/æ•°æ®åº“/redis/å“¨å…µ.md) ä»‹ç»äº†Redisçš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œä¸Redisçš„ä¸»ä»å¤åˆ¶å’Œæ•…éšœæ¢å¤æœºåˆ¶ç›¸å…³\n- [/ä¸­é—´ä»¶/æ•°æ®åº“/redis/å®¢æˆ·ç«¯.md](/ä¸­é—´ä»¶/æ•°æ®åº“/redis/å®¢æˆ·ç«¯.md) ä»‹ç»äº†Rediså®¢æˆ·ç«¯è¿æ¥ç®¡ç†å’Œåè®®ï¼Œä¸RedisæœåŠ¡ç«¯æ¶æ„è®¾è®¡ç›¸è¾…ç›¸æˆ\n- [/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/ç¼“å­˜.md](/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/ç¼“å­˜.md) ä»‹ç»äº†ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡åŸåˆ™ï¼ŒRedisä½œä¸ºé«˜æ€§èƒ½ç¼“å­˜ç³»ç»Ÿæ˜¯è¯¥åŸåˆ™çš„å…·ä½“å®ç°\n- [/ä¸­é—´ä»¶/æ•°æ®åº“/æ•°æ®åº“ä¼˜åŒ–.md](/ä¸­é—´ä»¶/æ•°æ®åº“/æ•°æ®åº“ä¼˜åŒ–.md) ä»‹ç»äº†æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ŒRedisä½œä¸ºå†…å­˜æ•°æ®åº“åœ¨ä¼˜åŒ–æ–¹é¢æœ‰ç‹¬ç‰¹è€ƒè™‘\n- [/æ•°æ®æŠ€æœ¯/æ•°æ®å­˜å‚¨.md](/æ•°æ®æŠ€æœ¯/æ•°æ®å­˜å‚¨.md) ä»‹ç»äº†ä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼ŒRedisä½œä¸ºNoSQLå†…å­˜æ•°æ®åº“æ˜¯å…¶ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†\n- [/ä¸­é—´ä»¶/æ•°æ®åº“/redis/å¤åˆ¶.md](/ä¸­é—´ä»¶/æ•°æ®åº“/redis/å¤åˆ¶.md) ä»‹ç»äº†Redisçš„ä¸»ä»å¤åˆ¶æœºåˆ¶ï¼Œæ˜¯å®ç°é«˜å¯ç”¨å’Œæ‰©å±•æ€§çš„é‡è¦æ‰‹æ®µ\n- [/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/åˆ†å¸ƒå¼/åˆ†å¸ƒå¼ç³»ç»Ÿ.md](/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/åˆ†å¸ƒå¼/åˆ†å¸ƒå¼ç³»ç»Ÿ.md) ä»‹ç»äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µï¼ŒRedis Clusteræ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ä¸ªå…·ä½“å®ä¾‹\n","metadata":"tags: ['æ•°æ®åº“', 'ç¼“å­˜', 'nosql', 'å†…å­˜æ•°æ®åº“', 'é«˜æ€§èƒ½']","hasMoreCommit":true,"totalCommits":15,"commitList":[{"date":"2026-02-12T14:07:03+08:00","author":"MY","message":"doc: æ•´ç†æ ‡ç­¾","hash":"290b3e8ad18f48832ac282290238d020fc030a88"},{"date":"2026-01-13T17:29:36+08:00","author":"MY","message":"docs(redis): é‡æ„Redisæ–‡æ¡£ç»“æ„æå‡å†…å®¹ç»„ç»‡å’Œå¯è¯»æ€§","hash":"2826524934f581c14f3d9f43ba38ec041c62ea8d"},{"date":"2024-12-16T19:56:39+08:00","author":"MY","message":"ğŸ“¦Redis","hash":"61d91e611dc55e7d92017abf8196d274cc12ca80"},{"date":"2024-11-20T14:24:23+08:00","author":"MY","message":"ğŸ“¦Redis","hash":"b64df2e87e14f86576fb82cc7b57e6b452aba69c"},{"date":"2023-12-13T19:40:21+08:00","author":"MY","message":"âœRedis","hash":"642b342a819421f389fef3a4e72f0ad641fe9c84"},{"date":"2023-12-11T19:59:23+08:00","author":"MY","message":"âœRedis","hash":"2f7e29a08817db6f3ce12f5fc78d44c23e8b1412"},{"date":"2023-12-07T20:05:48+08:00","author":"MY","message":"âœRedis","hash":"c242f11d707286af0133546d8d7c203ac219c28d"},{"date":"2023-12-06T19:59:46+08:00","author":"MY","message":"âœRedis","hash":"e0d5cfa5358133bd93587d26f55ff78955214b42"},{"date":"2023-11-21T20:11:59+08:00","author":"MY","message":"âœRedis","hash":"cb2689a2888eb05d909e7ba4caed644b192ce8a2"},{"date":"2023-11-20T20:05:41+08:00","author":"MY","message":"âœRedis","hash":"e10f240636511dc53c5ea31e7bc7f8f540a75414"}],"createTime":"2020-11-05T16:53:44+08:00"}