{"name":"æ¶ˆè´¹è€…","id":"ä¸­é—´ä»¶-æ¶ˆæ¯é˜Ÿåˆ—-Kafka-æ¶ˆè´¹è€…","content":"# Kafka æ¶ˆè´¹è€…ç³»ç»Ÿ\n\n## ä¸€ã€é—®é¢˜å®šä¹‰ï¼šæ¶ˆè´¹è€…ç³»ç»Ÿåœ¨è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ**æ¶ˆè´¹è€…ç³»ç»Ÿçš„æœ¬è´¨ç›®æ ‡**ä¸æ˜¯â€œæŠŠæ¶ˆæ¯è¯»å‡ºæ¥â€ï¼Œè€Œæ˜¯åŒæ—¶æ»¡è¶³ä»¥ä¸‹ç›¸äº’å†²çªçš„çº¦æŸï¼š\n\n1. **å¯æ‰©å±•æ€§**ï¼šæ¶ˆè´¹è€…å®ä¾‹æ•°é‡å¯ä»¥åŠ¨æ€å˜åŒ–\n2. **å®¹é”™æ€§**ï¼šå•ä¸ªå®ä¾‹å¤±è´¥ä¸ä¼šå¯¼è‡´ç³»ç»Ÿåœæ‘†\n3. **è¿›åº¦å¯æ¢å¤æ€§**ï¼šå¤±è´¥åå¯ä»¥ä»ç¡®å®šä½ç½®ç»§ç»­å¤„ç†\n4. **å¤„ç†æ•ˆç‡**ï¼šåœ¨ååã€å»¶è¿Ÿã€èµ„æºä¹‹é—´å–å¾—å¹³è¡¡\n\nKafka æ¶ˆè´¹è€…ç³»ç»Ÿï¼Œæ˜¯åœ¨ä¸Šè¿°ç›®æ ‡ä¸‹çš„ä¸€ç§å·¥ç¨‹è§£ã€‚\n\n---\n\n## äºŒã€æ ¸å¿ƒæŠ½è±¡ï¼šæ¶ˆè´¹è€…ç³»ç»Ÿçš„å››å¤§èƒ½åŠ›æ¨¡å‹\n\nKafka å°†æ¶ˆè´¹è€…ç³»ç»Ÿæ‹†è§£ä¸ºå››ä¸ªç›¸äº’åä½œçš„èƒ½åŠ›å­ç³»ç»Ÿï¼š\n\n### 1. æˆå‘˜ç®¡ç†èƒ½åŠ›ï¼ˆGroup Membershipï¼‰\n\nè§£å†³é—®é¢˜ï¼š**è°åœ¨æ¶ˆè´¹ï¼Ÿè°è¿˜æ´»ç€ï¼Ÿ**\n\n* æ¶ˆè´¹è€…ä»¥â€œæ¶ˆè´¹è€…ç»„â€ä¸ºé€»è¾‘å•ä½\n* é€šè¿‡ **å¿ƒè·³æœºåˆ¶** ç»´æŒæˆå‘˜æ´»æ€§\n* å¼•å…¥ **Coordinator** ä½œä¸ºç»„çŠ¶æ€çš„å•ä¸€è£å†³è€…\n\n> æœ¬è´¨ï¼šè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æˆå‘˜ä¸€è‡´æ€§åè®®ï¼Œè€Œéå¼ºä¸€è‡´åˆ†å¸ƒå¼åè°ƒã€‚\n\n---\n\n### 2. ä»»åŠ¡åˆ†é…èƒ½åŠ›ï¼ˆPartition Assignmentï¼‰\n\nè§£å†³é—®é¢˜ï¼š**è°æ¶ˆè´¹å“ªäº›æ•°æ®ï¼Ÿ**\n\n* Kafka ä»¥ *åˆ†åŒº* ä½œä¸ºæœ€å°å¹¶è¡Œä¸é¡ºåºå•å…ƒ\n* åˆ†åŒºåªèƒ½è¢«åŒä¸€æ¶ˆè´¹è€…ç»„å†…çš„ä¸€ä¸ªæ¶ˆè´¹è€…ç‹¬å \n* åˆ†é…ç­–ç•¥åœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼Œè€Œé Broker\n\nåˆ†é…ç­–ç•¥åæ˜ çš„æ˜¯ä¸åŒç³»ç»Ÿä»·å€¼å–å‘ï¼š\n\n| ç­–ç•¥         | æ ¸å¿ƒå–å‘    |\n| ---------- | ------- |\n| Range      | å±€éƒ¨æ€§ã€ç®€å•æ€§ |\n| RoundRobin | å‡è¡¡æ€§     |\n| Sticky     | ç¨³å®šæ€§ä¼˜å…ˆ   |\n| Custom     | ä¸šåŠ¡å®šåˆ¶    |\n\n> Sticky çš„ä»·å€¼ä¸åœ¨äºâ€œåˆ†é…å¾—æ›´å¥½â€ï¼Œè€Œåœ¨äº**å‡å°‘ç³»ç»Ÿæ‰°åŠ¨**ã€‚\n\n---\n\n### 3. è¿›åº¦ç®¡ç†èƒ½åŠ›ï¼ˆOffset Managementï¼‰\n\nè§£å†³é—®é¢˜ï¼š**æ¶ˆè´¹åˆ°å“ªé‡Œäº†ï¼Ÿå¤±è´¥åä»å“ªæ¢å¤ï¼Ÿ**\n\nKafka æ˜ç¡®åŒºåˆ†äº†ä¸‰ç§â€œä½ç§»è¯­ä¹‰â€ï¼š\n\n| å±‚æ¬¡                | å«ä¹‰          |\n| ----------------- | ----------- |\n| Log Offset        | æ•°æ®åœ¨åˆ†åŒºæ—¥å¿—ä¸­çš„ä½ç½® |\n| Consumer Position | å½“å‰å®ä¾‹å·²è¯»å–çš„ä½ç½®  |\n| Committed Offset  | ç³»ç»Ÿçº§æ¢å¤é”šç‚¹     |\n\n> Offset æäº¤ä¸æ˜¯â€œç¡®è®¤æ¶ˆè´¹æˆåŠŸâ€ï¼Œè€Œæ˜¯**å£°æ˜ä¸€ä¸ªå¯æ¢å¤è¾¹ç•Œ**ã€‚\n\n`__consumer_offsets` ä¸»é¢˜çš„å­˜åœ¨ï¼Œæ„å‘³ç€ï¼š\n\n* ä½ç§»ç®¡ç†æ˜¯ **Kafka å†…ç”Ÿèƒ½åŠ›**\n* Coordinator é€šè¿‡ç¼“å­˜è€Œéç›´è¯»æ—¥å¿—æä¾›æŸ¥è¯¢\n\n---\n\n### 4. æµæ§ä¸èƒŒå‹èƒ½åŠ›ï¼ˆFlow Controlï¼‰\n\nè§£å†³é—®é¢˜ï¼š**å¦‚ä½•åœ¨ååã€å»¶è¿Ÿã€ç¨³å®šæ€§ä¹‹é—´æƒè¡¡ï¼Ÿ**\n\nKafka é‡‡ç”¨ **Pull æ¨¡å‹**ï¼š\n\n* æ¶ˆè´¹è€…å†³å®šæ‹‰å–èŠ‚å¥\n* Broker ä¸æ„ŸçŸ¥æ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›\n\næ ¸å¿ƒæ§åˆ¶ç»´åº¦ï¼š\n\n| ç»´åº¦   | ä»£è¡¨å‚æ•°                                        |\n| ---- | ------------------------------------------- |\n| æ‰¹é‡å¤§å° | fetch.min.bytes / max.partition.fetch.bytes |\n| ç­‰å¾…ç­–ç•¥ | fetch.max.wait.ms                           |\n| å¤„ç†èŠ‚å¥ | max.poll.records / max.poll.interval.ms     |\n\n> è¿™äº›å‚æ•°ä¸æ˜¯â€œæ€§èƒ½è°ƒä¼˜é¡¹â€ï¼Œè€Œæ˜¯**ç³»ç»Ÿå¼ åŠ›è°ƒèŠ‚æ—‹é’®**ã€‚\n\n---\n\n## ä¸‰ã€å†å‡è¡¡ï¼ˆRebalanceï¼‰ï¼šé«˜ä»£ä»·çš„ç³»ç»Ÿçº§äº‹ä»¶\n\n### 1. å†å‡è¡¡çš„æœ¬è´¨\n\nå†å‡è¡¡ä¸æ˜¯å¼‚å¸¸ï¼Œè€Œæ˜¯ **åŠ¨æ€æˆå‘˜ç³»ç»Ÿçš„å¿…ç„¶ä»£ä»·**ã€‚\n\nè§¦å‘æ¡ä»¶åŒ…æ‹¬ï¼š\n\n* æˆå‘˜åŠ å…¥æˆ–ç¦»å¼€\n* å¿ƒè·³è¶…æ—¶\n* åˆ†åŒºæˆ–è®¢é˜…ä¸»é¢˜å˜åŒ–\n\n### 2. å†å‡è¡¡çš„ç³»ç»Ÿä»£ä»·\n\n* å…¨ç»„æ¶ˆè´¹æš‚åœ\n* åˆ†åŒºæ‰€æœ‰æƒå›æ”¶\n* çŠ¶æ€é‡å»º\n\n> æ¶ˆè´¹è€…è¶Šå¤šï¼Œå†å‡è¡¡è¶Šæ…¢ï¼›ä¸šåŠ¡å¤„ç†è¶Šé‡ï¼Œå†å‡è¡¡é£é™©è¶Šé«˜ã€‚\n\n### 3. çŠ¶æ€æœºè§†è§’\n\næ¶ˆè´¹è€…ç»„åœ¨ä»¥ä¸‹çŠ¶æ€é—´æµè½¬ï¼š\n\n* Empty â†’ PreparingRebalance â†’ CompletingRebalance â†’ Stable\n* Dead è¡¨ç¤ºå…ƒæ•°æ®è¢«å½»åº•æ¸…é™¤\n\nè¿™æ˜¯ä¸€ä¸ª**å›´ç»•ä¸€è‡´æ€§ä¸å¯ç”¨æ€§åå¤æƒè¡¡çš„çŠ¶æ€æœº**ã€‚\n\n---\n\n## å››ã€Coordinatorï¼šæ¶ˆè´¹è€…ç³»ç»Ÿçš„æ§åˆ¶ä¸­æ¢\n\nCoordinator çš„èŒè´£é›†ä¸­åœ¨ä¸‰ç‚¹ï¼š\n\n1. ç»´æŠ¤ç»„æˆå‘˜å…ƒæ•°æ®\n2. é©±åŠ¨å†å‡è¡¡æµç¨‹\n3. ç®¡ç†å·²æäº¤ä½ç§»\n\nå…¶å®šä½æ–¹å¼ï¼š\n\n* groupId â†’ offsets topic åˆ†åŒº\n* åˆ†åŒº leader â†’ Coordinator Broker\n\n> è¿™æ˜¯ä¸€ä¸ª **â€œä»¥ä½ç§»ä¸ºä¸­å¿ƒâ€ çš„è·¯ç”±è®¾è®¡**ã€‚\n\n---\n\n## äº”ã€Offset æäº¤ç­–ç•¥çš„ç³»ç»Ÿè¯­ä¹‰\n\n### è‡ªåŠ¨æäº¤\n\n* æäº¤çš„æ˜¯ poll è¿”å›çš„æœ€å¤§ä½ç§»\n* æä¾›çš„æ˜¯â€œ**è‡³å¤šä¸€æ¬¡åç§»å£°æ˜**â€\n\n### æ‰‹åŠ¨æäº¤\n\n* commitSyncï¼šç¡®å®šæ€§å¼ºï¼Œé˜»å¡\n* commitAsyncï¼šååä¼˜å…ˆï¼Œå¤±è´¥ä¸é‡è¯•\n\n> æäº¤ç­–ç•¥é€‰æ‹©ï¼Œæœ¬è´¨æ˜¯ **ä¸€è‡´æ€§ vs åå** çš„æƒè¡¡ã€‚\n\n---\n\n## å…­ã€å¼‚å¸¸ä¸åæ¨¡å¼è®¤çŸ¥\n\n### CommitFailedException çš„æœ¬è´¨\n\n* æ¶ˆè´¹å¤„ç†æ—¶é—´ > max.poll.interval.ms\n* æˆ–æ¶ˆè´¹è€…å·²è¢«åˆ¤å®šç¦»ç»„\n\nè¿™ä¸æ˜¯â€œæäº¤å¤±è´¥â€ï¼Œè€Œæ˜¯ï¼š\n\n> **ä½ å·²ç»ä¸å†è¢«ç³»ç»Ÿæ‰¿è®¤ä¸ºåˆæ³•æˆå‘˜**ã€‚\n\n### å…¸å‹åæ¨¡å¼\n\n* ä¸šåŠ¡å¤„ç†é€»è¾‘è¿‡é‡\n* poll è°ƒç”¨ä¸è§„å¾‹\n* é¢‘ç¹æ¶ˆè´¹è€…é‡å¯\n\n---\n\n## ä¸ƒã€ä½•æ—¶ä¸åº”ä½¿ç”¨æ¶ˆè´¹è€…ç»„\n\næ¶ˆè´¹è€…ç»„å¹¶éä¸‡èƒ½è§£ï¼š\n\n* éœ€è¦å¼ºé¡ºåº + å¼ºäº‹åŠ¡ä¸€è‡´æ€§\n* å¤„ç†è€—æ—¶æé•¿ä¸”ä¸å¯åˆ‡åˆ†\n* ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ä¾èµ–å¤–éƒ¨ç³»ç»Ÿ\n\nè¿™äº›åœºæ™¯å¾€å¾€éœ€è¦ï¼š\n\n* å•æ¶ˆè´¹è€…\n* å¤–éƒ¨ offset ç®¡ç†\n* æˆ–æµå¤„ç†æ¡†æ¶\n\n---\n\n## å…«ã€ç›‘æ§è§†è§’ï¼šä»æŒ‡æ ‡çœ‹ç³»ç»Ÿå¥åº·\n\næ ¸å¿ƒä¸æ˜¯â€œæœ‰æ²¡æœ‰æ¶ˆè´¹â€ï¼Œè€Œæ˜¯ï¼š\n\n| æŒ‡æ ‡           | ç³»ç»Ÿå«ä¹‰        |\n| ------------ | ----------- |\n| lag          | ç³»ç»Ÿæ˜¯å¦è·Ÿå¾—ä¸Šç”Ÿäº§é€Ÿåº¦ |\n| lead         | æ˜¯å¦å­˜åœ¨æ•°æ®ä¸¢å¤±é£é™©  |\n| rebalance æ¬¡æ•° | ç³»ç»Ÿç¨³å®šæ€§       |\n\n---\n\n## ä¹ã€æ€»ç»“ï¼šKafka æ¶ˆè´¹è€…ç³»ç»Ÿçš„è®¾è®¡å“²å­¦\n\nKafka çš„æ¶ˆè´¹è€…è®¾è®¡ï¼Œå¹¶éè¿½æ±‚ï¼š\n\n* å¼ºä¸€è‡´\n* ç²¾ç¡®ä¸€æ¬¡\n\nè€Œæ˜¯ï¼š\n\n> åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œ\n> ç”¨**å¯æ¥å—çš„å¤æ‚åº¦**æ¢å–\n> **è¶³å¤Ÿå¥½çš„ååã€å¯ç”¨æ€§ä¸æ¢å¤èƒ½åŠ›**ã€‚\n\n\n## å…³è”å†…å®¹ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰\n\n- [/ä¸­é—´ä»¶/æ¶ˆæ¯é˜Ÿåˆ—/Kafka/Kafka.md](/ä¸­é—´ä»¶/æ¶ˆæ¯é˜Ÿåˆ—/Kafka/Kafka.md) Kafkaçš„æ•´ä½“æ¶æ„å’Œè®¾è®¡åŸç†ï¼Œä¸æ¶ˆè´¹è€…ç³»ç»Ÿåœ¨åˆ†åŒºã€å‰¯æœ¬ã€å¯é æ€§è¯­ä¹‰ç­‰æ–¹é¢å¯†åˆ‡é…åˆ\n- [/ä¸­é—´ä»¶/æ¶ˆæ¯é˜Ÿåˆ—/Kafka/ç”Ÿäº§è€….md](/ä¸­é—´ä»¶/æ¶ˆæ¯é˜Ÿåˆ—/Kafka/ç”Ÿäº§è€….md) Kafkaæ¶ˆè´¹è€…ä¸ç”Ÿäº§è€…æ˜¯æ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹çš„ä¸¤ç«¯ï¼Œåœ¨åˆ†åŒºã€å‰¯æœ¬ã€å¯é æ€§è¯­ä¹‰ç­‰æ–¹é¢æœ‰ç€å¯†åˆ‡çš„é…åˆå…³ç³»\n- [/ä¸­é—´ä»¶/æ¶ˆæ¯é˜Ÿåˆ—/æ¶ˆæ¯é˜Ÿåˆ—.md](/ä¸­é—´ä»¶/æ¶ˆæ¯é˜Ÿåˆ—/æ¶ˆæ¯é˜Ÿåˆ—.md) æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºæœ¬æ¦‚å¿µã€æ¶æ„æ¨¡å¼å’Œé€‰å‹åŸåˆ™ï¼Œä¸Kafkaæ¶ˆè´¹è€…çš„è®¾è®¡ç†å¿µå¯†åˆ‡ç›¸å…³\n- [/æ•°æ®æŠ€æœ¯/æµå¤„ç†.md](/æ•°æ®æŠ€æœ¯/æµå¤„ç†.md) Kafkaä½œä¸ºæµå¤„ç†æ¶æ„çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ¶ˆè´¹è€…ç³»ç»Ÿæ˜¯å®ç°å®æ—¶æ•°æ®æµå¤„ç†çš„å…³é”®éƒ¨åˆ†\n- [/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/åˆ†å¸ƒå¼/åˆ†å¸ƒå¼ç³»ç»Ÿ.md](/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/åˆ†å¸ƒå¼/åˆ†å¸ƒå¼ç³»ç»Ÿ.md) Kafkaæ¶ˆè´¹è€…ç³»ç»Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ä¸ªå…¸å‹å®ä¾‹ï¼Œä½“ç°äº†åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­çš„è¯¸å¤šåŸåˆ™å’ŒæŒ‘æˆ˜\n- [/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/åˆ†å¸ƒå¼/åˆ†å¸ƒå¼ä¸€è‡´æ€§ç³»ç»Ÿ.md](/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/åˆ†å¸ƒå¼/åˆ†å¸ƒå¼ä¸€è‡´æ€§ç³»ç»Ÿ.md) Kafkaæ¶ˆè´¹è€…ç³»ç»Ÿçš„å‰¯æœ¬ç®¡ç†å’Œä¸€è‡´æ€§ä¿è¯ä¸åˆ†å¸ƒå¼ä¸€è‡´æ€§ç†è®ºå¯†åˆ‡ç›¸å…³\n- [/æ•°æ®æŠ€æœ¯/æ•°æ®æ¶æ„.md](/æ•°æ®æŠ€æœ¯/æ•°æ®æ¶æ„.md) Kafkaæ¶ˆè´¹è€…åœ¨ç°ä»£æ•°æ®æ¶æ„ä¸­ä½œä¸ºæ•°æ®æ¶ˆè´¹ç«¯çš„é‡è¦è§’è‰²ï¼Œè´Ÿè´£ä»æ¶ˆæ¯ç³»ç»Ÿä¸­è·å–æ•°æ®\n- [/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/é«˜å¹¶å‘.md](/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/é«˜å¹¶å‘.md) Kafkaæ¶ˆè´¹è€…ç³»ç»Ÿçš„è®¾è®¡ä½¿å…¶èƒ½å¤Ÿå¤„ç†é«˜å¹¶å‘çš„æ•°æ®æ¶ˆè´¹åœºæ™¯\n- [/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/å¯ç”¨æ€§.md](/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/å¯ç”¨æ€§.md) Kafkaæ¶ˆè´¹è€…ç³»ç»Ÿçš„å®¹é”™å’Œæ¢å¤æœºåˆ¶ç¡®ä¿äº†ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§\n- [/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/ä¼¸ç¼©æ€§.md](/è½¯ä»¶å·¥ç¨‹/æ¶æ„/ç³»ç»Ÿè®¾è®¡/ä¼¸ç¼©æ€§.md) Kafkaæ¶ˆè´¹è€…ç»„çš„åŠ¨æ€ä¼¸ç¼©èƒ½åŠ›æ”¯æŒç³»ç»Ÿçš„å¼¹æ€§æ‰©å±•\n\n","metadata":"tags: ['æ¶ˆæ¯é˜Ÿåˆ—', 'åˆ†å¸ƒå¼ç³»ç»Ÿ']","hasMoreCommit":true,"totalCommits":14,"commitList":[{"date":"2026-02-12T14:07:03+08:00","author":"MY","message":"doc: æ•´ç†æ ‡ç­¾","hash":"290b3e8ad18f48832ac282290238d020fc030a88"},{"date":"2026-01-14T11:48:13+08:00","author":"MY","message":"docs(kafka): å®Œå–„æ¶ˆè´¹è€…ç³»ç»Ÿæ–‡æ¡£ç»“æ„å’Œå†…å®¹","hash":"244c0b9856fee9d2d9ae508e1dfcb0786c7c04d0"},{"date":"2024-12-31T15:36:59+08:00","author":"MY","message":"ğŸ“¦Kafka","hash":"ea9109746bc43e320441a94e7a4866b66d6cb339"},{"date":"2024-12-13T15:26:31+08:00","author":"MY","message":"ğŸ“¦Kafka","hash":"669ee24fcbc7d1f943da5f42d773e29c2990942d"},{"date":"2024-11-20T16:12:20+08:00","author":"MY","message":"ğŸ“¦Kafka","hash":"955524f9775b97e250675e61652f914ad8337055"},{"date":"2023-12-25T19:31:55+08:00","author":"MY","message":"âœKafka","hash":"4e13dddf9d95c59d8a08a051a769024b32e32c34"},{"date":"2023-12-01T17:20:45+08:00","author":"MY","message":"âœKafka","hash":"330072b3e64e9c310102137594ce75ba60bf27f8"},{"date":"2023-11-30T19:20:43+08:00","author":"MY","message":"âœKafka","hash":"d70587ba4f48e6abec74bc770cced58464e1f599"},{"date":"2023-11-29T19:21:03+08:00","author":"MY","message":"âœKafka","hash":"44c479880fa9eb76f4dd26a33df88f7ae230a50f"},{"date":"2023-11-28T19:43:58+08:00","author":"MY","message":"âœKafka","hash":"1659408db251662415e754150f16c570cec4ef7d"}],"createTime":"2021-03-23T16:48:37+08:00"}