# 全文检索引擎在信息检索中的应用

## 摘要

全文检索是在传统数据库无法满足多样的数据结构，以及多样的检索需求下的产物，作为一种实现信息检索的技术，全文检索在计算机科学当中有着举足轻重的作用。

## 引言

信息检索技术的发展始于上世纪四十年代,最初是用来管理数量巨大的科学文献。随着信息时代的到来,数字化文本的数量以及用户获取信息的需求迅速膨胀,使得信息检索技术日益重要。全文检索技术和文本分类技术是信息检索领域的两项重要内容。

本文主要介绍全文检索相关技术的应用，主要包括分词、索引检索、信息检索等相关内容。

## 全文检索

全文检索是指计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。全文搜索搜索引擎数据库中的数据。

### 全文检索技术

在全文检索系统中，文档贮存在一个容器中的同时有-一个索引被维护着。匹配文档通过索引获得并返回给用户使得查询得到处理。全文检索技术主要包括索引建立和查询处理两方面的内容。构建索引的月的就是为了提高查询处理的性能。

索引建立是对文档集进行预处理，使全文检索系统能够快速、准确的响应用户提交的查询。其内容与查询处理中应用到的TF、IDF、查询词或短语等密切相关。索引建立又包含文档分析和倒排索引构建两方面的内容。

文档分析是指将文本文档中的内容识别出来的过程，其最主要的内容就是词。文档分析主要包含分词和去除停用词两方面的处理。

查询处理是指根据用户提交的查询返回文档集中好的匹配的过程，即是信息，获取的过程。

### 全文检索引擎

目前市面上使用最广泛的全文检索引擎是Lucene，Lucene并不是一个完整提供可用功能的全文检索引擎，它提供了一系列类库，可以使开发者更加方便地开发出更适合自身的全文检索引擎。目前可以直接安装就使用的主要全文检索引擎有

- Solr
- ElasticSearch

### 全文检索引擎的作用

全文检索引擎是搜索引擎的一种，主要采用全文检索的方式进行搜索。全文检索是指计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。全文搜索搜索引擎数据库中的数据。

### 为何使用全文检索引擎

全文搜索引擎胜在快速和高效的查询大批量非结构化的文本记录，并且返回这些基于用于搜索匹配的结果文档，他们可以根据具体的数值或者字段去进行快速高效的排序、分类等。一个系统的全文搜索功能应该是丰富并且灵活的，并且还需要支持基本关键字的查询：互联网式+/-语法，布尔运算符的使用，有限的真实或伪自然语言处理，邻近操作，查找类似等。

所谓结构化与非结构化数据之间的差别就是在于有无特定格式。像论文、期刊等类似的文档检索就特别适合使用全文检索。

### 全文检索引擎的安装

本文以ElasticSearch为例，下文简称为ES，简绍ES在信息检索当中的应用。

安装ES的方式有很多，可以直接在其官网下载二进制包进行安装，也可以使用当前比较流行容器技术直接进行部署。

本文使用的容器技术是Docker,Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。

要使用Docker安装ES十分简单，首先我们通过pull命令拉取ES的镜像

```shell
docker pull elasticsearch:5.6.8
```

这样Docker就会自己去下载ES的镜像了，当镜像下载完成之后，执行如下命令

```shell
docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:5.6.8
```

这样，我们就拥有一个运行在本地的ES全文检索引擎了。

### 全文检索引擎的使用

使用ES全文检索引擎的方式主要有两种，一是通过引擎本身提供的Rest HTTP接口，另一个则是通过使用编程语言客户端。

### Rest接口

RESTful Web服务是指将REST架构应用在Web中,以资源为中心,使用URI作为统一资源标识符,使用HTTP协议中的方法作为操作资源的统一方法的Web服务。

在这里简单介绍一下Rest接口的几种常用功能，以便大家能对ES提供的这个接口有一定的理解。

- 创建索引

``` JSON
PUT /blog
{
    "settings": {
        "number_of_shards": 3,
        "number_of_replicas": 2
      }
}
```

- 添加映射

```json
PUT /索引库名/_mapping/类型名称
{
  "properties": {
    "字段名": {
      "type": "类型",
      "index": true,
      "store": true,
      "analyzer": "分词器"
    }
  }
}
```

- 搜索

根据字段值进行搜索

```json
GET /shop/_search
{
  "_source": ["title","price"],
  "query": {
    "term": {
      "price": 2699
    }
  }
}
```

分词之后再进行搜索

```json
{
    "query":{
        "query_string":{
            "default_field":"content",
            "query":"内容"
        }
    }
}
```

### 编程语言客户端

ES同样也提供了JAVA语言客户端以方便开发者可以通过编程进行全文检索

只需要通过maven引入相关依赖

```xml
<dependency>
    <groupId>org.elasticsearch</groupId>
    <artifactId>elasticsearch</artifactId>
    <version>7.3.1</version>
</dependency>

<dependency>
    <groupId>org.elasticsearch.client</groupId>
    <artifactId>transport</artifactId>
    <version>7.3.1</version>
</dependency>
```

就可以进行编程全文检索

```java
// 连接
Settings settings = Settings.builder()
                .put("cluster.name","docker-cluster")
                .build();

TransportClient client = new PreBuiltTransportClient(settings);
client.addTransportAddress(
            new TransportAddress(InetAddress.getByName("my-pc"),9300));
// 查询
QueryBuilder queryBuilder = QueryBuilders.queryStringQuery("青年强调")
                .defaultField("content");
SearchResponse response = client.prepareSearch("index")
                .setTypes("article")
                .setQuery(queryBuilder)
                .get();                
```

### 全文检索分词

前面在进行搜索以及索引入库的时候都需要对查询串或者入库内容进行分词，以便实现全文检索功能。

现在被广泛使用的基于字的切分方法相对来说简单方便 ,但它会产生大量无意义的标引词 ,导致标引产生的索引文件的空间 ,以及检索和进行标引的时间都大大增加。基于词的切分方法主要有基于词典和基于统计的方法。有研究表明基于字切分的查询和结果处理时间可以说相当于基于词切分的3倍。尤其当数据规模比较大的时候,这个时间差距会更加明显。

#### 英文分词

英文分词相比中文分词来说，实现起来相对容易，只需要删除其一些无意义的介词，连接词等，再根据空格进行分割，就能得到一个完整的分词列表。

#### 中分分词

中文分词与英文分词有很大的不同，对英文而言，一个单词就是一个词，而汉语是以字为基本的书写单位，词语之间没有明显的区分标记，需要人为切分。中文分词系统是利用计算机对中文文本进行词语自动识别的系统，对其研究已经取得了很多成果，出现了众多的算法。根据其特点，可以将现有的分词算法分为四大类：基于字符串匹配的分词方法、基于理解的分词方法、基于统计的分词方法和基于语义的分词方法等。

#### ES中的中文分词器

目前，被基于Lucene的全文搜索引擎广泛使用的中文分词为ik分词器,ik分词器可以被作为插件很好地集成到ES中。

##### 中文分词器的使用

在ES中，使用ik分词器很简单，只需向其发送一个HTTP请求

`http://my-pc:9200/_analyze/?analyzer=ik_smart&text=中华人民共和国国歌`

这时，服务器就会返回分词结果

```json
{
  "tokens": [
    {
      "token": "中华人民共和国",
      "start_offset": 0,
      "end_offset": 7,
      "type": "CN_WORD",
      "position": 0
    },
    {
      "token": "国歌",
      "start_offset": 7,
      "end_offset": 9,
      "type": "CN_WORD",
      "position": 1
    }
  ]
}
```

### 全文检索建立索引

在全文检索引擎被应用到信息检索中，当录入一条新数据时，需要对该数据各个域建立索引，以文档为例，文档拥有作者、单位、标题、内容等域，其中作者与单位不需要对齐索引，在搜索时，只需要对其精确搜索，但是标题与内容两个域，需要对其进行分词，然后建立索引，这样在检索的时候才能搜索到数据。

可以通过发送如下数据建立一个文档的索引库

```json
PUT /doc/_mapping/doc
{
  "properties": {
    "author": {
      "type": "string",
    
      "store": true
      
    },
    "org": {
      "type": "string",

      "store": true
      
    },
    "title": {
      "type": "string",

      "store": true,
      "analyzer": "ik_smart"
      
    },
    "content": {
      "type": "string",

      "store": true,
      "analyzer": "ik_smart"
      
    }
  }
}
```

建立索引库之后，就可以向索引库添加几条数据进行测试

```json
POST /doc/doc
{
  "author":"my",
  "org":"ISMY",
  "title":"普京2019年度记者会结束，关于俄中关系，他说了这样一句话",
  "content":"当地时间19日，俄罗斯总统普京在莫斯科国际贸易中心举行年度大型记者会，回答国内外媒体记者提问。普京在记者会上就有关俄中关系、兴奋剂禁赛事件、乌克兰东部冲突等问题进行了回答。"
}
```

其他文档添加请求将不再给出

这时候，向检索引擎发起一个检索请求

```json
GET /doc/_search
{
    "query":{
        "query_string":{
            "default_field":"content",
            "query":"运营商",
            "analyzer": "ik_smart"
        }
    }
}
```

该请求的意思检索content域含有运营商这个关键词的数据，符合相关条件的数据将会被列出。
这就是在信息检索当中关键词查找的一个简单实现。

#### 倒排索引

全文检索引擎之所以存在，就是因为传统数据库满足不了多样化的检索需求，并且全文检索引擎与传统数据库相比之下，还有一个更大的优势，就是检索速度更快。

全文检索引擎使用了一个叫做倒排索引的技术，倒排索引源于实际应用中需要根据属性的值来查找记录。这种索引表中的每一项都包括一个属性值和具有该属性值的各记录的地址。由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(inverted index)。

## 总结

信息检索是用户进行信息查询和获取的主要方式，是查找信息的方法和手段。狭义的信息检索仅指信息查询。即用户根据需要，采用一定的方法，借助检索工具，从信息集合中找出所需要信息的查找过程。广义的信息检索是信息按一定的方式进行加工、整理、组织并存储起来，再根据信息用户特定的需要将相关信息准确的查找出来的过程。而全文检索作为一种实现信息检索的方式，其本身仍有很多值得研究的地方，全文检索跨越数据结构，数据库，算法，计算机网络等多门学科，是一种仍在不断发展完善的技术。

## 参考文献

[1]张帅. 全文检索技术的研究和应用[D].北京邮电大学,2012.

[2]袁婷. RESTful Web服务的形式化建模与分析[D].华东师范大学,2015.
