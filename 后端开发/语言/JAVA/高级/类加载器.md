# 类加载过程

- –JVM依据classpath执行的类库的顺序来查找类

# 类加载器

- 负责查找、加载、校验字节码的应用程序

## JVM四级类加载器

- 启动类加载器(Bootstrap)，系统类rt.jar
- 扩展类加载器(Extension)，jre/lib/ext
- 应用类加载器(App)，classpath
- 用户自定义加载器(Plugin)，程序自定义

## 双亲委托模型

- 首先判断是否已经加载
- 若无，找父加载器加载
- 若再无，由当前加载器加载
- 上级类加载器所加载的类，无法访问下级类加载器所加载的类

## 自定义类加载路径

- 使用URLClassLoader

```java
        URL url = new URL("file:D:/学习/jar/mysql-connector-java-5.1.44-bin.jar");
        URLClassLoader loader = new URLClassLoader(new URL[]{url});
        Class<?> klass = loader.loadClass("com.mysql.jdbc.Driver");
        System.out.println(klass);
```

- 获取当前线程类加载器

```java
ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();
```

- 热部署

## 自定义类加载器

```java
class MyClassLoader extends ClassLoader {
    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        if ("wang.ismy.Main".equals(name)){
            byte[] bytes = new byte[0];
            try {
                bytes = new FileInputStream("C:\\Users\\MY\\TMP\\work\\classloader\\src\\main\\java\\wang\\ismy\\Main.class").readAllBytes();
            } catch (IOException e) {
                e.printStackTrace();
            }
            return defineClass(name,bytes,0,bytes.length);
        }else {
            return super.findClass(name);
        }
    }
}
```


