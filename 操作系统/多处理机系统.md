# 多处理机系统

![屏幕截图 2020-12-24 142533](/assets/屏幕截图%202020-12-24%20142533.png)

三种类型的多处理机系统

- a：共用一个物理存储器 对程序员透明
- b：没有全局共享屋里存储器 编程较困难
- c：通过网络连接起来的分布式系统

## 多处理机

多个CPU共享访问一个公用RAM

### 多处理机硬件

**统一存储器访问（UMA）**

#### 基于总线的UMA多处理机体系结构

![屏幕截图 2020-12-24 145430](/assets/屏幕截图%202020-12-24%20145430.png)

没有高速缓存就需要在数据写入是进行总线冲突检测，这样系统会 受到总线带宽的限制，加上缓存或者私有存储器 总线流量就大大减少 可以支持更多的CPU

#### 使用交叉开关的UMA多处理机

![屏幕截图 2020-12-24 160022](/assets/屏幕截图%202020-12-24%20160022.png)

这种方式两个处理器对同一个存储器的竞争将降低到1/n

但交叉点的数量是处理器的平方倍

#### 使用多级交换网络的UMA多处理机

通过一个开关来避免交叉点的平方倍上升

![屏幕截图 2020-12-25 164348](/assets/屏幕截图%202020-12-25%20164348.png)

![屏幕截图 2020-12-25 164450](/assets/屏幕截图%202020-12-25%20164450.png)

#### NUMA多处理机

- 具有对所有CPU可见的单个地址空间
- 拥有远程与本地存储器

#### 多核芯片

多个核心之间共享内存 内存与各个核心的高速缓存会通过某些协议来实现一致性 多核芯片也被称为**片级多处理机**

被称为Soc（片上系统）的多核芯片不仅包含多个通用核心，而且还会嵌入若干个专用核心，如音视频解码

#### 众核芯片

由数量众多的核心组成的芯片

适用于众核芯片的编程模型已被正面的有消息传递和分布式内存 维护内存一致性的代价很大

如GPU就是众核芯片，适合大量并行的小规模计算 GPU本质上是单指令多数据流处理器

#### 异构多核

统一芯片包含着多个不同架构不同指令集的异构核心

### 多处理机操作系统类型

#### 每个CPU有自己的操作系统

![屏幕截图 2020-12-28 150620](/assets/屏幕截图%202020-12-28%20150620.png)

每个CPU都可以共享内存与IO资源

但是可能造成资源使用不均衡 但最要命的是各个CPU都要各自维护自己的磁盘缓冲区 就会造成不一致的情况

##### 主从多处理机

![屏幕截图 2020-12-28 151614](/assets/屏幕截图%202020-12-28%20151614.png)

所有的系统调用都要经过主CPU 主CPU会成为瓶颈 对小型多处理机是可行的

##### 对称多处理机

![屏幕截图 2020-12-28 152125](/assets/屏幕截图%202020-12-28%20152125.png)

一种方式是任何时刻都只能有一个CPU运行操作系统

另一种方式是将操作系统分割成互不影响的临界区 不同的CPU处理不同的功能 实现并行操作

### 多处理机同步

TSL（test and set lock）

必须先锁住总线 然后再进行读写访问

但这样如果冲突过于频繁 总线有效流量负载就大大下降 为了解决这个问题：

- 锁总线之前使用一个纯读操作测试总线是否空闲
- 发生冲突时，使用二进制指数回退算法
- 更好的方法是，发生冲突后，每个CPU等待的时间都不同 以避免再次冲突

## 多处理机调度

- 分时

  亲和调度

- 空间共享

- 群调度

  - 把一组相关相关线程作为一个单位进行调度
  - 一个群中的相关线程在不同的分时CPU上同时运行
  - 群众所有成员共同开始和结束时间片

# 多计算机

## 多计算机硬件

- 互连技术

  - 存储转发包交换
  - 电路交换

- 网络接口

## 低层通信软件

- 节点至网络接口通信
- 远程直接内存访问

## 用户层通信软件
- 发送和接收
- 阻塞调用和非阻塞调用

## 远程过程调用

## 分布式共享存储器
- 复制
- 伪共享
- 实现顺序一致性

## 多计算机调度

## 负载均衡
- 图论确定算法
- 发送者发起的分布式启发算法
- 接受者发起的分布式启发算法

# 分布式系统

## 网络硬件
- 以太网
- 因特网

## 网络服务和协议

## 基于文档的中间件

## 基于文件系统的中间件

## 基于对象的中间件

## 基于协作的中间件
