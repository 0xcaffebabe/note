# 范式

> 设计关系数据库时，遵从不同的规范要求，设计出合理的关系型数据库，这些不同的规范要求被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余越小。 目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。

# 备份还原

- mysqldump

# 事务

说明   | 操作
---- | -----------------
开启事务 | start transaction
回滚   | rollback
提交   | commit

## 问题

并发访问的问题 | 含义
------- | -------------------------------------------------------------------
脏读      | 一个事务读取到了另一个事务中尚未提交的数据
不可重复读   | 一个事务中两次读取的数据内容不一致，要求的是一个事务中多次读取时数据是一致的，这 是事务 update 时引发的问题
幻读      | 一个事务中两次读取的数据的数量不一致，要求在一个事务多次读取的数据的数量是一致 的，这是 insert 或 delete 时引发的问题

## 隔离级别

级别 | 名字   | 隔离级别             | 脏读 | 不可重复读 | 幻读 | 数据库默认隔离级别
-- | ---- | ---------------- | -- | ----- | -- | -------------------
1  | 读未提交 | read uncommitted | 是  | 是     | 是  | -
2  | 读已提交 | read committed   | 否  | 是     | 是  | Oracle 和 SQL Server
3  | 可重复读 | repeatable read  | 否  | 否     | 是  | MySQL
4  | 串行化  | serializable     | 否  | 否     | 否  | -

 隔离级别越高越安全，但效率越来越低

 # 用户及权限管理

- 创建一个能在主机登录的用户
  
  ```sql
  create user 'user2'@'%' identified by '123';
  ```

- 授予权限

```sql
grant all on *.* to 'user2'@'%';
```
  
# 设计规范

## 命名规范

### 数据库

- [a-z ][0-9] _
- 不超过30字符
- 备份数据库可以加自然数

### 表

- [a-z ][0-9] _
- 相同关系的表可以加相同的前缀

### 字段

- [a-z ][0-9] _
- 多个单词使用下划线分割
- 每个表必须有自增主键（默认系统时间）
- 关联字段名尽可能相同

## 字段类型规范

- 使用较少的空间来存储
- ip最好使用int
- 固定长度的类型使用char
- 最好给默认值

## 索引规范

- 加一个index后缀
- 为每个表创建主键索引
- 符合索引慎重

## 范式规范

- 必须满足第二范式
- 尽量满足第三范式

# MYSQL设计原则

## 核心原则

- 不在数据库做运算
- 控制列数量（20以内）
- 平衡范式与冗余
- 禁止大SQL
- 禁止大事务
- 禁止大批量

## 字段原则

- 用好数据类型节约空间
- 字符转为数字
- 避免使用NULL
- 少用text

## 索引原则

- 不在索引列做运算
- innodb主键使用自增
- 不用外键

## SQL原则

- 尽可能简单
- 简单事务
- 避免使用触发器，函数
- 不使用select *
- OR改写成IN或UNION
- 避免前%
- 慎用count（*）
- limit高效分页
- 少用连接join
- group by 
- 使用同类型比较
- 打散批量更新

