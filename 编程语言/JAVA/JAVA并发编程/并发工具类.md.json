{"name":"å¹¶å‘å·¥å…·ç±»","id":"ç¼–ç¨‹è¯­è¨€-JAVA-JAVAå¹¶å‘ç¼–ç¨‹-å¹¶å‘å·¥å…·ç±»","content":"# JUC\n\n## ä¸€ã€å¹¶å‘çš„ç¬¬ä¸€æ€§é—®é¢˜ç©ºé—´ï¼ˆWhy å¹¶å‘å·¥å…·å­˜åœ¨ï¼‰\n\næ‰€æœ‰ Java å¹¶å‘å·¥å…·ï¼Œæœ¬è´¨ä¸Šéƒ½åœ¨è§£å†³**æœ‰é™è®¡ç®—èµ„æºåœ¨å¤šæ‰§è¡Œä¸»ä½“ä¹‹é—´çš„åˆ†é…ä¸åè°ƒé—®é¢˜**ã€‚\n\nä»ç¬¬ä¸€æ€§åŸç†å‡ºå‘ï¼Œå¹¶å‘ç³»ç»Ÿåªå­˜åœ¨äº”ç±»ä¸å¯çº¦çš„é—®é¢˜ï¼š\n\n### 1. äº’æ–¥ï¼ˆMutual Exclusionï¼‰\n\n* åŒä¸€æ—¶åˆ»ï¼Œ**å…±äº«èµ„æºåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹**\n* æœ¬è´¨å†²çªï¼šå†™-å†™ã€è¯»-å†™å†²çª\n\n### 2. å¯è§æ€§ï¼ˆVisibilityï¼‰\n\n* ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«çŠ¶æ€çš„ä¿®æ”¹ï¼Œ**ä½•æ—¶ã€å¦‚ä½•è¢«å…¶ä»–çº¿ç¨‹è§‚å¯Ÿåˆ°**\n\n### 3. åè°ƒï¼ˆCoordinationï¼‰\n\n* å¤šä¸ªçº¿ç¨‹ä¹‹é—´éœ€è¦**åœ¨æ—¶é—´æˆ–é˜¶æ®µä¸Šè¾¾æˆä¸€è‡´**\n* ä¸æ˜¯ç«äº‰ï¼Œè€Œæ˜¯åä½œ\n\n### 4. èµ„æºé™æµï¼ˆThrottlingï¼‰\n\n* èµ„æºæœ‰é™ï¼ˆè¿æ¥ã€çº¿ç¨‹ã€IOï¼‰ï¼Œéœ€è¦æ§åˆ¶**åŒæ—¶è®¿é—®è€…æ•°é‡**\n\n### 5. ä¸Šä¸‹æ–‡éš”ç¦»ä¸ä¼ æ’­ï¼ˆContext Managementï¼‰\n\n* å¹¶å‘æ‰§è¡Œä¸‹ï¼Œå¦‚ä½•**å®‰å…¨åœ°ä¿å­˜ã€ä¼ é€’çº¿ç¨‹ä¸Šä¸‹æ–‡**\n\n> æ‰€æœ‰ JUC å·¥å…·ï¼Œéƒ½å¯ä»¥è¢«æ˜ å°„å›ä¸Šè¿°é—®é¢˜ä¹‹ä¸€æˆ–ç»„åˆã€‚\n\n---\n\n## äºŒã€Java å¹¶å‘çš„æ€»ä½“æ¶æ„åˆ†å±‚ï¼ˆHow Java è§£å†³å¹¶å‘ï¼‰\n\n```text\nå¹¶å‘é—®é¢˜ç©ºé—´\n   â†“\nå¹¶å‘æŠ½è±¡æ¨¡å‹ï¼ˆé” / åŒæ­¥å™¨ / é™æµå™¨ / ä¸Šä¸‹æ–‡ï¼‰\n   â†“\nå¹¶å‘æ¡†æ¶ï¼ˆAQSï¼‰\n   â†“\nå…·ä½“å·¥å…·ç±»ï¼ˆReentrantLock / Semaphore / CountDownLatch ...ï¼‰\n```\n\nè¿™ä¸€åˆ†å±‚ä½“ç°äº† **ç¨³å®šæ€§é€’å¢åŸåˆ™**ï¼š\n\n* è¶Šé ä¸Šï¼Œè¶Šæ¥è¿‘ä¸å˜åŸç†\n* è¶Šé ä¸‹ï¼Œè¶Šæ¥è¿‘å®ç°ç»†èŠ‚\n\n---\n\n## ä¸‰ã€AQSï¼šJava å¹¶å‘çš„â€œå†…æ ¸æŠ½è±¡â€\n\n### 3.1 AQS çš„è®¾è®¡å“²å­¦\n\nAQSï¼ˆAbstractQueuedSynchronizerï¼‰å¹¶ä¸æ˜¯â€œé”â€ï¼Œè€Œæ˜¯ï¼š\n\n> **ç«äº‰å¤±è´¥çº¿ç¨‹çš„ç»Ÿä¸€ç®¡ç†æ¡†æ¶**\n\nå®ƒæŠ½è±¡äº†å¹¶å‘æ§åˆ¶ä¸­æœ€ç¨³å®šçš„ä¸‰ä»¶äº‹ï¼š\n\n1. **èµ„æºçŠ¶æ€ï¼ˆstateï¼‰**ï¼šèµ„æºæ˜¯å¦å¯ç”¨\n2. **ç­‰å¾…é˜Ÿåˆ—ï¼ˆFIFOï¼‰**ï¼šç«äº‰å¤±è´¥è€…æ’é˜Ÿ\n3. **é˜»å¡ / å”¤é†’æœºåˆ¶**ï¼šæœ€å°åŒ– CPU ç©ºè½¬\n\n### 3.2 AQS çš„æ ¸å¿ƒæ¨¡å‹\n\n```text\nstateï¼ˆintï¼‰        â†’ èµ„æºçŠ¶æ€æœº\nåŒæ­¥é˜Ÿåˆ—ï¼ˆCLHå˜ä½“ï¼‰ â†’ ç®¡ç†ç«äº‰å¤±è´¥çº¿ç¨‹\næ¡ä»¶é˜Ÿåˆ—           â†’ ç®¡ç†åä½œå‹ç­‰å¾…\n```\n\nAQS é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå°†**ç­–ç•¥**äº¤ç»™å­ç±»ï¼š\n\n* tryAcquire / tryRelease\n* tryAcquireShared / tryReleaseShared\n\nè€Œå°†**è°ƒåº¦ã€æ’é˜Ÿã€é˜»å¡**ç»Ÿä¸€æ‰˜ç®¡ã€‚\n\n---\n\n## å››ã€äº’æ–¥é—®é¢˜ï¼šReentrantLock ä¸ synchronized\n\n### 4.1 æŠ½è±¡æ¨¡å‹\n\n* **äº’æ–¥é” = çŠ¶æ€æœº + æ’é˜Ÿè§„åˆ™**\n* å¯é‡å…¥æ€§æœ¬è´¨ï¼š**çº¿ç¨‹èº«ä»½ç»‘å®š + è®¡æ•°çŠ¶æ€**\n\n### 4.2 å…¬å¹³æ€§ï¼šä¸€ç§èµ„æºåˆ†é…å“²å­¦\n\n| ç­–ç•¥   | ä»·å€¼å–å‘ | ä»£ä»·   |\n| ---- | ---- | ---- |\n| å…¬å¹³é”  | é¡ºåºæ­£ä¹‰ | ååä¸‹é™ |\n| éå…¬å¹³é” | ç³»ç»Ÿæ•ˆç‡ | å±€éƒ¨é¥¥é¥¿ |\n\n> å…¬å¹³æ€§ä¸æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè€Œæ˜¯ç³»ç»Ÿä»·å€¼åˆ¤æ–­ã€‚\n\n### 4.3 synchronized vs ReentrantLock\n\n| ç»´åº¦  | synchronized | ReentrantLock |\n| --- | ------------ | ------------- |\n| å®ç°å±‚ | JVM          | JDK           |\n| é”é‡Šæ”¾ | è‡ªåŠ¨           | æ‰‹åŠ¨            |\n| å…¬å¹³æ€§ | éå…¬å¹³          | å¯é…ç½®           |\n| ä¸­æ–­  | ä¸æ”¯æŒ          | æ”¯æŒ            |\n\n**å·¥ç¨‹å“²å­¦**ï¼š\n\n> èƒ½ç”¨ synchronizedï¼Œå°±ä¸è¦ç”¨ Lockã€‚\n\n---\n\n## äº”ã€è¯»å†™åˆ†ç¦»ï¼šReentrantReadWriteLock ä¸ StampedLock\n\n### 5.1 è¯»å†™é”çš„æ ¸å¿ƒçŸ›ç›¾\n\n* **è¯»å¤šå†™å°‘**æ˜¯å¸¸æ€\n* å†™æ“ä½œå¿…é¡»ç‹¬å \n* è¯»æ“ä½œåº”æœ€å¤§åŒ–å¹¶å‘\n\n### 5.2 ReentrantReadWriteLock\n\n* æ‚²è§‚å¹¶å‘æ¨¡å‹\n* æ˜ç¡®åŒºåˆ†è¯» / å†™\n* å­˜åœ¨å†™é¥¥é¥¿ä¸è°ƒåº¦å¤æ‚æ€§\n\n### 5.3 StampedLockï¼šä¹è§‚å¹¶å‘çš„å¼•å…¥\n\n* æ ¸å¿ƒæ€æƒ³ï¼š**å…ˆå‡è®¾æ²¡æœ‰å†™å†²çª**\n* å¤±è´¥å†å›é€€ä¸ºæ‚²è§‚é”\n\n> è¿™æ˜¯ä»â€œé”ç«äº‰â€å‘â€œå†²çªæ£€æµ‹â€çš„èŒƒå¼è¿ç§»ã€‚\n\n---\n\n## å…­ã€åä½œè€Œéç«äº‰ï¼šåŒæ­¥å™¨æ¨¡å‹\n\n### 6.1 CountDownLatch â€”â€” ä¸€æ¬¡æ€§é—¨é—©\n\n* æ¨¡å‹ï¼š**äº‹ä»¶å®Œæˆè®¡æ•°**\n* ç‰¹å¾ï¼š\n\n  * ä¸å¯é‡ç½®\n  * ç­‰å¾…â€œç»“æœâ€è€Œéâ€œèµ„æºâ€\n\n### 6.2 CyclicBarrier â€”â€” é˜¶æ®µæ€§å¯¹é½\n\n* æ¨¡å‹ï¼š**é˜¶æ®µåŒæ­¥ç‚¹**\n* å¯å¤ç”¨\n* é€‚ç”¨äºè¿­ä»£å¼å¹¶è¡Œè®¡ç®—\n\n### 6.3 ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«\n\n| ç»´åº¦    | CountDownLatch | CyclicBarrier |\n| ----- | -------------- | ------------- |\n| å…³æ³¨ç‚¹   | å®Œæˆ             | å¯¹é½            |\n| æ˜¯å¦å¯å¤ç”¨ | å¦              | æ˜¯             |\n| æ€ç»´æ¨¡å‹  | é—¨é—©             | æ …æ             |\n\n---\n\n## ä¸ƒã€èµ„æºé™æµï¼šSemaphore\n\n### 7.1 æŠ½è±¡æ¨¡å‹\n\n* **è®¡æ•°å‹å…±äº«èµ„æºæ§åˆ¶å™¨**\n* æœ¬è´¨ä¸æ˜¯é”ï¼Œè€Œæ˜¯**é…é¢**\n\n### 7.2 å·¥ç¨‹æ„ä¹‰\n\n* é˜²æ­¢èµ„æºè¢«æ‰“çˆ†\n* å°†ç³»ç»Ÿä¸ç¨³å®šæ€§è½¬åŒ–ä¸ºæ’é˜Ÿç­‰å¾…\n\n---\n\n## å…«ã€çº¿ç¨‹é—´æ•°æ®äº¤æ¢ä¸é€šä¿¡\n\n### 8.1 Exchanger\n\n* åŒæ–¹åŒæ­¥ç‚¹\n* ç”¨äºæµæ°´çº¿ã€åˆ†æ²»å¹¶è¡Œ\n\n### 8.2 LockSupport\n\n* park / unpark æ˜¯ JVM å±‚çš„çº¿ç¨‹è°ƒåº¦åŸè¯­\n* AQS çš„åŸºç¡€è®¾æ–½\n\n---\n\n## ä¹ã€ä¸Šä¸‹æ–‡ç®¡ç†ï¼šThreadLocal åŠå…¶æ¼”è¿›\n\n### 9.1 ThreadLocal çš„æœ¬è´¨\n\n* **çº¿ç¨‹ç§æœ‰ä¸Šä¸‹æ–‡å®¹å™¨**\n* è§£å†³çš„æ˜¯ï¼š\n\n  > å¹¶å‘ç¯å¢ƒä¸‹çš„éšå¼å‚æ•°ä¼ é€’é—®é¢˜\n\n### 9.2 æ ¸å¿ƒé£é™©\n\n* çº¿ç¨‹æ± å¤ç”¨ â†’ è„æ•°æ®\n* ç”Ÿå‘½å‘¨æœŸä¸ä¸€è‡´ â†’ å†…å­˜æ³„æ¼\n\n### 9.3 InheritableThreadLocal çš„å±€é™\n\n* åªåœ¨**çº¿ç¨‹åˆ›å»ºæ—¶å¤åˆ¶**\n* æ— æ³•é€‚é…çº¿ç¨‹æ± \n\n### 9.4 TransmittableThreadLocalï¼ˆTTLï¼‰\n\n* æœ¬è´¨ï¼š**ä¸Šä¸‹æ–‡å¿«ç…§ + å›æ”¾æœºåˆ¶**\n* æ˜¯å¯¹ ThreadLocal åœ¨ç°ä»£å¹¶å‘æ¨¡å‹ä¸‹çš„ä¿®æ­£\n\n---\n\n## åã€å·¥å…·é€‰å‹çš„ç¨³å®šæ–¹æ³•è®º\n\n| å¹¶å‘é—®é¢˜  | é¦–é€‰å·¥å…·           | åŸå›     |\n| ----- | -------------- | ----- |\n| ç®€å•äº’æ–¥  | synchronized   | ç®€å•ã€å®‰å…¨ |\n| é«˜å¹¶å‘äº’æ–¥ | ReentrantLock  | å¯æ§ç­–ç•¥  |\n| è¯»å¤šå†™å°‘  | StampedLock    | ä¹è§‚å¹¶å‘  |\n| ä»»åŠ¡åä½œ  | CountDownLatch | ä¸€æ¬¡æ€§åŒæ­¥ |\n| é˜¶æ®µå¹¶è¡Œ  | CyclicBarrier  | å¯å¤ç”¨   |\n| èµ„æºä¿æŠ¤  | Semaphore      | é…é¢æ§åˆ¶  |\n| ä¸Šä¸‹æ–‡ä¼ é€’ | TTL            | çº¿ç¨‹æ± å‹å¥½ |\n\n## å…³è”å†…å®¹ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰\n\n- [/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/åŸºç¡€æ¦‚å¿µ.md](/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/åŸºç¡€æ¦‚å¿µ.md) æ¶µç›–åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ç­‰åŸºæœ¬æ¦‚å¿µï¼Œè¿™äº›æ˜¯æ‰€æœ‰å¹¶å‘å·¥å…·çš„åŸºç¡€ç†è®º\n- [/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/çº¿ç¨‹.md](/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/çº¿ç¨‹.md) è¯¦ç»†ä»‹ç»äº†çº¿ç¨‹æ¨¡å‹ï¼Œè¿™æ˜¯æ‰€æœ‰å¹¶å‘å·¥å…·åè°ƒçš„åŸºç¡€\n- [/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± .md](/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/çº¿ç¨‹æ± .md) è®¨è®ºäº†çº¿ç¨‹æ± ï¼Œå…¶ä¸­å¤§é‡ä½¿ç”¨äº†è¯¸å¦‚CountDownLatchå’ŒSemaphoreç­‰å¹¶å‘å·¥å…·\n- [/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/å¹¶å‘é›†åˆ.md](/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/å¹¶å‘é›†åˆ.md) æ¶µç›–å¹¶å‘é›†åˆï¼Œè¿™äº›é›†åˆé€šå¸¸ä¸å¹¶å‘å·¥å…·ç±»ååŒå·¥ä½œ\n- [/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/JAVAå¹¶å‘ç¼–ç¨‹.md](/ç¼–ç¨‹è¯­è¨€/JAVA/JAVAå¹¶å‘ç¼–ç¨‹/JAVAå¹¶å‘ç¼–ç¨‹.md) æä¾›Javaå¹¶å‘ç¼–ç¨‹çš„æ•´ä½“æ¡†æ¶ï¼Œå±•ç¤ºäº†å¹¶å‘å·¥å…·åœ¨æ•´ä¸ªå¹¶å‘ç¼–ç¨‹ä½“ç³»ä¸­çš„ä½ç½®\n","metadata":"tags: ['ç¼–ç¨‹è¯­è¨€', 'å¹¶å‘ç¼–ç¨‹', 'æ•°æ®åº“']","hasMoreCommit":true,"totalCommits":15,"commitList":[{"date":"2026-02-12T14:07:03+08:00","author":"MY","message":"doc: æ•´ç†æ ‡ç­¾","hash":"290b3e8ad18f48832ac282290238d020fc030a88"},{"date":"2026-01-14T16:12:53+08:00","author":"MY","message":"docs(JAVA): æ›´æ–°JUCå¹¶å‘å·¥å…·ç±»æ–‡æ¡£å¹¶æ·»åŠ ç›¸å…³å›¾ç‰‡èµ„æº","hash":"f676fa1c8153922ad1e2aa621f65c73006af4863"},{"date":"2025-01-16T11:26:35+08:00","author":"MY","message":"ğŸ“¦AQS","hash":"00504fafc1113a39b1f62fbe29065cb755a3e699"},{"date":"2024-08-28T19:28:47+08:00","author":"MY","message":"âœå¹¶å‘å·¥å…·ç±»","hash":"6c22e5bbff176dc1fb35424a932b6b81d83018df"},{"date":"2024-06-05T14:47:56+08:00","author":"MY","message":"âœå¹¶å‘","hash":"7c6ef9e57ea5c46ce3933e394560d07213d85163"},{"date":"2022-10-19T21:32:18+08:00","author":"MY","message":"âœï¸Javaå¹¶å‘ç¼–ç¨‹","hash":"5ec012b5f65756ede6a0402ff1eb8eba6b398a9e"},{"date":"2022-04-18T16:44:54+08:00","author":"cjiping","message":"âœï¸æ›´æ–° å¹¶å‘å·¥å…·ç±»","hash":"27706afe8d550424a937ed9973bc0ea796246272"},{"date":"2021-09-10T15:44:58+08:00","author":"cjiping","message":"ğŸ“¦æ•´ç† Java å¹¶å‘å·¥å…·ç±»","hash":"f46e45c586d3c4fd71a48eeb86f687259ca00432"},{"date":"2021-09-09T16:04:56+08:00","author":"cjiping","message":"ğŸ“¦æ•´ç† Java çº¿ç¨‹","hash":"38a99898a4b35a1db75c1e0e87df2defb5ce7525"},{"date":"2020-09-25T15:12:19+08:00","author":"0xcaffebabe","message":"âœæ›´æ–° Java å¹¶å‘ç¼–ç¨‹ ThreadLocal","hash":"df8757284b174352df4ee22dcf927cc72e2a6527"}],"createTime":"2020-06-23T16:24:52+08:00"}