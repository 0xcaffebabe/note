# 物理和虚拟寻址

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/%E7%89%A9%E7%90%86%E5%AF%BB%E5%9D%80.png)

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/%E8%99%9A%E6%8B%9F%E5%AF%BB%E5%9D%80.jpg)

**内存管理单元（MMU）**

# 地址空间

> 非负整数地址的有序集合

- 虚拟地址空间
- 物理地址空间

# 虚拟内存作为缓存的工具

- 未分配
- 缓存的
- 未缓存的

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E4%B8%8E%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98.jpg)

## DRAM缓存的组织结构

_与存储器的层次结构_

## 页表

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/%E9%A1%B5%E8%A1%A8.jpg)

## 页命中

系统通过页表获取到物理内存当中的页

## 缺页

> 物理内存缓存不命中成为缺页

## 分配页面

## 局部性原理

> 局部性原理是指CPU访问存储器时，无论是存取指令还是存取数据，所访问的存储单元都趋于聚集在一个较小的连续区域中。

# 虚拟内存作为内存管理工具

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.jpg)

- 简化链接
- 简化加载
- 简化共享
- 简化内存分配

# 虚拟内存作为内存保护的工具

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/CSAPP/%E5%86%85%E5%AD%98%E4%BF%9D%E6%8A%A4%E5%B7%A5%E5%85%B7.jpg)

# 地址翻译

![enter image description here](https://images2017.cnblogs.com/blog/1143834/201711/1143834-20171119205319999-116509966.png)

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/%E5%9C%B0%E5%9D%80%E7%BF%BB%E8%AF%91.png)

- 通过虚拟地址找到页表(page table)中对应的条目
- 检查有效位(valid bit)，是否需要触发页错误(page fault)
- 然后根据页表中的物理页编号找到内存中的对应地址
- 最后把虚拟页偏移和前面的实际地址拼起来，就是最终的物理地址

当页面命中时：

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/CSAPP/%E9%A1%B5%E9%9D%A2%E5%91%BD%E4%B8%AD.png)

当缺页时：

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/CSAPP/%E7%BC%BA%E9%A1%B5.png)

## 结合高速缓存和虚拟内存

![enter image description here](https://data2.liuin.cn/story-writer/2018_1_31_1517404781626.jpg)

## 利用TLB加速地址翻译

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/CSAPP/TLB%E5%91%BD%E4%B8%AD.png)

![enter image description here](https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/CSAPP/TLB%E6%9C%AA%E5%91%BD%E4%B8%AD.png)

## 多级页表



# 内存映射

- 共享对象

# 动态内存分配

# 垃圾收集
