{"name":"Linux虚拟化","id":"计算机网络-Linux虚拟化","content":"# Linux网络虚拟化\n\n- Linux下的网络通信模型\n\n![2020121141251](/assets/2020121141251.png)\n\n## 干预网络通信\n\n从Linux Kernel 2.4版开始，内核开放了一套通用的、可供代码干预数据在协议栈中流转的过滤器框架。它围绕网络层（IP协议）的周围，埋下了五个钩子：\n\n- PREROUTING：来自设备的数据包进入协议栈后立即触发此钩子。PREROUTING钩子在进入IP路由之前触发，这意味着只要接收到的数据包，无论是否真的发往本机，都会触发此钩子。一般用于目标网络地址转换（Destination NAT，DNAT）。\n- INPUT：报文经过IP路由后，如果确定是发往本机的，将会触发此钩子，一般用于加工发往本地进程的数据包。\n- FORWARD：报文经过IP路由后，如果确定不是发往本机的，将会触发此钩子，一般用于处理转发到其他机器的数据包。\n- OUTPUT：从本机程序发出的数据包，在经过IP路由前，将会触发此钩子，一般用于加工本地进程的输出数据包。\n- POSTROUTING：从本机网卡出去的数据包，无论是本机的程序所发出的，还是由本机转发给其他机器的，都会触发此钩子，一般用于源网络地址转换（Source NAT，SNAT）\n\n![2020121142155](/assets/2020121142155.png)\n\n## 虚拟化网络设备\n\n### 虚拟网卡：tnu/tap\n\ntap模拟了以太网设备，操作二层数据包（以太帧），tun则模拟了网络层设备，操作三层数据包（IP报文）\n\n![2020121142815](/assets/2020121142815.png)\n\n### 虚拟网卡：veth\n\nveth是一对设备，因而也常被称作veth pair，在veth设备的其中一端输入数据，这些数据就会从设备的另外一端原样不变地流出\n\n![2020121143015](/assets/2020121143015.png)\n\n### 虚拟交换机：Linux Bridge\n\n![虚拟网桥](/assets/2023524141141.webp)\n\n![虚拟交换机](/assets/2023524141331.webp)\n\n![NAT](/assets/2023524141435.webp)\n\nLinux Bridge创建以后，便能够接入任何位于二层的网络设备\n\n### GRE\n\n一种 IP-over-IP 的隧道技术。它将 IP 包封装在 GRE 包里，外面加上 IP 头，在隧道的一端封装数据包，并在通路上进行传输，到另外一端的时候解封装\n\n![](/assets/2023525145243.webp)\n\n### 虚拟网络：VXLAN\n\n- VLAN的不足\n\n![VXLAN协议](/assets/2023525144352.webp)\n\n### 副本网卡：MACVLAN\n\nMACVLAN借用了VLAN子接口的思路，并且在这个基础上更进一步，不仅允许对同一个网卡设置多个IP地址，还允许对同一张网卡上设置多个MAC地址\n","metadata":"","hasMoreCommit":false,"totalCommits":3,"commitList":[{"date":"2023-05-25T16:41:11+08:00","author":"MY","message":"✏计算机网络","hash":"9fa90391b4921ad8f18525bfe368c17388ae7582"},{"date":"2023-05-24T16:54:09+08:00","author":"MY","message":"✏计算机网络","hash":"af01305acc7b161960289554184c9a8ebf2c950b"},{"date":"2020-12-01T14:55:26+08:00","author":"cjiping","message":"➕增加 Linux网络虚拟化","hash":"d3fe15824511368a8614aefb8d8c730a550eaa00"}],"createTime":"2020-12-01T14:55:26+08:00"}