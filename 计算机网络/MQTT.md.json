{"name":"MQTT","id":"计算机网络-MQTT","content":"\n# MQTT\n\n## 角色\n\n- 客户端（Client）： 既可以是发布者（Publisher），也可以是订阅者（Subscriber），或者两者同时是\n- 代理（Broker）：核心中间人，负责接收消息、过滤消息、再转发给合适的订阅者\n\n## 通信模型\n\n```mermaid\nsequenceDiagram\n    participant Pub as 发布者(Publisher)\n    participant Broker as 代理(Broker)\n    participant Sub as 订阅者(Subscriber)\n\n    Sub ->> Broker: 订阅主题 (home/livingroom/temperature)\n    Broker -->> Sub: 确认订阅成功\n\n    Pub ->> Broker: 发布消息 (主题: home/livingroom/temperature, 消息: 23℃, QoS=1)\n    Broker -->> Pub: 确认收到 (QoS 流程)\n\n    Broker ->> Sub: 转发消息 (主题: home/livingroom/temperature, 消息: 23℃)\n    Sub -->> Broker: 确认收到 (QoS 流程)\n\n```\n\n- 二进制编码格式\n- 协议头很紧凑，协议交互也简单\n\n![包格式](/assets/202319173826.webp)\n\n### 主题\n\n层级式路径，用斜杠分隔\n\n如：`home/livingroom/temperature`\n\n- `+` 单层通配，例如 home/+/temperature 匹配 home/livingroom/temperature 和 home/kitchen/temperature\n- `#` 多层通配，例如 home/# 匹配 home/livingroom/temperature、home/kitchen/humidity\n\n### 消息\n\n- 内容（Payload）：真正要传递的数据（可以是文本、JSON、二进制）。\n- 属性：除内容外，还包括：\n  - 主题（Topic）\n  - QoS 等级\n  - Retain 标志（是否保留为“最新值”）\n\n### 发布订阅机制\n\n## 特性\n\n### Qos\n\n- 支持 3 种 QoS（Quality of Service，服务质量）级别\n  - QoS 0，消息只发送一次，消息可能丢失\n  - QoS 1 ，发送方会接收反馈，保证消息的送达，但是可能消息会重复\n  - QoS 2 ，通过发送方和接收方的多次交互，保证消息有且只有一次\n\n### 会话\n\n- 临时会话：客户端断开 → 状态清空。\n- 持久会话：客户端断开 → Broker 仍然记住它的订阅，等它回来继续投递\n\n### 遗嘱消息\n\n客户端异常断开时，Broker 会帮它发一条预先定义的“遗言”\n\n### 保活\n\n#### 保活间隔\n\n由客户端在 CONNECT 报文里指定。在这个时间间隔内，客户端必须和 Broker 至少有一次交互（可以是 PUBLISH、SUBSCRIBE，也可以是专门的 PINGREQ）。如果超过这个时间没有交互，Broker 会认为客户端掉线\n\n#### 心跳报文\n\n- PINGREQ：客户端发给 Broker，表示“我还活着”。\n- PINGRESP：Broker 回复，表示“我也在”。\n\n## 安全机制\n\n### 认证\n\n- 用户名 + 密码：最基本的方式，在 CONNECT 报文里携带，明文传输\n- 客户端证书：基于 TLS 的双向认证，客户端和 Broker 都有证书\n\n### 加密\n\n- SSL/TLS：基于 TLS 的加密，使用 mqtts:// 或 wss://，消息在网络中是密文\n- 数据完整性：TLS 自带的哈希校验\n\n### 授权\n\n- ACL：定义哪些用户/设备可以访问哪些主题\n- RBAC：给用户分配角色（管理员、设备、应用），再定义权限\n","metadata":"","hasMoreCommit":false,"totalCommits":1,"commitList":[{"date":"2025-09-12T16:48:25+08:00","author":"MY","message":"docs: 更新 MQTT 相关文档","hash":"52524872ec50e5524da61418e97a79e4070b9ae4"}],"createTime":"2025-09-12T16:48:25+08:00"}