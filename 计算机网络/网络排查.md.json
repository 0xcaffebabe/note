{"name":"网络排查","id":"计算机网络-网络排查","content":"# 网络排查\n\n## 抓包\n\n### 技术\n\n- tcpdump：依赖一个底层能力：BPF\n- tcptrace：命令行分析抓包文件工具\n- wireshark\n- BPF：BSD Packet Filter，基于寄存器的虚拟机抓包方式\n- libpcap：BPF 的一层 API 封装\n- WinPcap：libpcap 的 Windows 版本\n- eBPF：更加通用的内核接口，不仅能支持网络抓包，还能支持网络以外的内核观测点的信息收集等工作\n\n### 文件类型\n\n- pcap：libpcap 的格式，也是 tcpdump 和 Wireshark 等工具默认支持的文件格式\n- cap：含有一些 libpcap 标准之外的数据格式\n- pcapng：单个抓包文件就可以包含多个网络接口上抓取到的报文\n\n## 网络诊断\n\n- 探测类工具：ping、traceroute、mtr、nc、telnet 等，它们都是从一端发起，对另外一端发送探测报文，然后观测报文的丢失、乱序、时延等情况，nc 和 telnet，则主要是测试传输层连通性的\n- 统计类工具：netstat 主要是通过 /proc 文件系统收集信息的，而 ss 主要通过 netlink 内核接口获取数据\n\n## IP透传\n\n- 应用层：HTTP协议的X-Forwarded-For 头部\n- 传输层：TCP首部Options字段 使用最长为 40 字节的位置来存储真实IP，需要通信双方都进行改造\n- 网络层：可以直接通过修改数据包的源IP字段来进行透传，这种方式前端LB就无法收到回包\n- 协议改造：客户端在 TCP 握手完成之后，在应用层数据发送之前，插入一个包，这个包的 payload 就是真实源 IP\n","metadata":"","hasMoreCommit":false,"totalCommits":3,"commitList":[{"date":"2022-08-17T17:12:44+08:00","author":"cjiping","message":"✏️网络排查","hash":"a5d6ed990275d2b900d52b7b71094931f5fb0d8b"},{"date":"2022-08-16T15:55:47+08:00","author":"cjiping","message":"✏️计网","hash":"80defab3e4e06f348f8e315048f75fd194c4135a"},{"date":"2022-07-28T14:52:13+08:00","author":"cjiping","message":"➕新增 网络排查","hash":"7e7243a77d70f0df7a37ffed7fa88a5303b12303"}],"createTime":"2022-07-28T14:52:13+08:00"}