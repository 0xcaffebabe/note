{"name":"容量保障","id":"软件工程-容量保障","content":"# 容量工程\n\n> 在 **体验、成本、风险** 三者约束下，建立一种可演进、可治理、可自动化的系统容量能力。\n\n## 一、容量的第一性原理\n\n### 1.1 什么是容量\n\n**容量不是资源，不是 QPS，也不是机器数量。**\n\n> **容量 = 在既定用户体验目标与成本约束下，系统能够长期、稳定承载的业务负载上限。**\n\n容量由三类变量共同决定：\n\n* **负载（Load）**：请求量、事务量、并发度、流量形态\n* **能力（Capacity）**：系统在架构、资源、调度、隔离条件下的承载能力\n* **体验（Experience）**：延迟、错误率、可用性、SLO\n\n容量问题的本质，是这三者之间的 **动态平衡问题**。\n\n---\n\n### 1.2 容量工程要解决的核心矛盾\n\n| 维度 | 目标    | 冲突点     |\n| -- | ----- | ------- |\n| 业务 | 更高峰值  | 成本不可控   |\n| 技术 | 更稳定系统 | 资源利用率下降 |\n| 组织 | 更少事故  | 过度保守    |\n\n容量工程的任务不是“无限扩容”，而是 **在约束条件下做最优决策**。\n\n---\n\n## 二、容量治理的整体架构模型\n\n容量治理不是单点能力，而是一个 **长期运行的系统工程闭环**。\n\n### 2.1 容量治理闭环\n\n容量治理可以抽象为四个层次：\n\n1. **容量定义（目标层）**\n2. **容量观测（信号层）**\n3. **容量分析（决策层）**\n4. **容量处置（执行层）**\n\n这四层形成一个持续演进的治理闭环。\n\n---\n\n### 2.2 容量治理能力树\n\n```\n容量治理能力\n├─ 容量定义能力\n│  ├─ 业务目标与 SLO\n│  ├─ 容量水位定义\n│  └─ 成本与风险约束\n├─ 容量观测能力\n│  ├─ 实时监控\n│  ├─ 趋势分析\n│  └─ 容量预测\n├─ 容量分析能力\n│  ├─ 瓶颈定位\n│  ├─ 决策模型\n│  └─ 资源画像\n├─ 容量处置能力\n│  ├─ 扩容与调度\n│  ├─ 限流与降级\n│  └─ 结构性优化\n└─ 容量演进能力\n   ├─ 基线管理\n   ├─ 回归验证\n   └─ 事故复盘\n```\n\n---\n\n## 三、容量定义：目标与水位模型\n\n### 3.1 容量水位的双重视角\n\n#### 业务容量水位\n\n> **业务容量水位 = 当前业务负载 / 业务可承载上限**\n\n* 关注端到端服务链路\n* 衡量的是“还能不能继续接业务”\n\n#### 资源容量水位\n\n> **资源容量水位 = 当前资源消耗 / 可用资源总量**\n\n* 关注 CPU、内存、I/O 等具体资源\n* 衡量的是“系统内部是否存在瓶颈”\n\n**业务水位是目标，资源水位是信号。**\n\n---\n\n### 3.2 SLO 驱动的容量定义\n\n容量必须由体验目标反向约束：\n\n* **SLI**：可观测信号（QPS、RT、错误率）\n* **SLO**：期望状态（如 P99 ≤ 100ms）\n* **容量目标**：在 SLO 约束下的最大负载\n\n---\n\n## 四、容量观测：信号体系与平台化\n\n### 4.1 容量观测的三类信号\n\n| 信号类型 | 作用   | 示例        |\n| ---- | ---- | --------- |\n| 实时信号 | 事故预警 | 当前 QPS、RT |\n| 趋势信号 | 风险识别 | 周期性增长     |\n| 预测信号 | 决策支持 | 峰值预估      |\n\n---\n\n### 4.2 平台化容量观测\n\n容量观测应通过平台能力沉淀：\n\n* 容量大盘（全局水位）\n* 容量巡检（结构性风险）\n* 压测平台（能力上限）\n\n平台的价值在于：**减少个体经验依赖**。\n\n---\n\n## 五、容量分析：从信号到决策\n\n### 5.1 容量分析的本质\n\n容量分析不是“算还能撑多久”，而是回答三个问题：\n\n1. 瓶颈在哪里\n2. 风险什么时候发生\n3. 现在该不该投入成本\n\n---\n\n### 5.2 决策模型分层\n\n| 层级    | 特征   | 示例     |\n| ----- | ---- | ------ |\n| 自动决策  | 规则驱动 | HPA、限流 |\n| 半自动决策 | 人工确认 | 预测扩容   |\n| 人工决策  | 架构调整 | 拆分、重构  |\n\n数学模型（如 ARIMA）的角色是 **决策支持，而非决策本身**。\n\n---\n\n## 六、容量处置：策略而非手段\n\n### 6.1 容量处置的设计原则\n\n* **隔离优先于扩容**\n* **结构性优化优先于资源堆叠**\n* **体验保护优先于全量可用**\n\n---\n\n### 6.2 常见处置策略分类\n\n| 类型 | 目标    | 示例      |\n| -- | ----- | ------- |\n| 扩容 | 提升上限  | 弹性扩容    |\n| 调度 | 提高利用率 | 混部      |\n| 限流 | 保护核心  | 丢弃非关键请求 |\n| 降级 | 保住主功能 | 功能裁剪    |\n\n---\n\n## 七、容量测试：建立系统基线\n\n### 7.1 为什么要基线\n\n没有基线，就无法判断：\n\n* 系统是真的退化了\n* 还是业务变复杂了\n\n基线是容量工程的“参照系”。\n\n---\n\n### 7.2 线上与线下容量测试\n\n* **线上测试**：验证真实环境下的系统极限\n* **线下基线测试**：对比版本演进的容量变化\n\n容量测试应被纳入 CI/CD，而不是一次性活动。\n\n---\n\n## 八、容量规划与预测\n\n### 8.1 预测的定位\n\n预测不是为了“算准未来”，而是：\n\n> **尽早发现方向性风险**\n\n时间序列模型适合趋势判断，不适合孤立决策。\n\n---\n\n### 8.2 容量规划的现实约束\n\n* 资金\n* 地域\n* 灾备\n* 硬件形态\n\n容量规划始终是 **工程理性与商业理性的平衡**。\n\n---\n\n## 九、云时代的容量工程\n\n### 9.1 弹性不是万能药\n\n* 扩容容易，缩容危险\n* 冷启动是弹性的最大成本\n\n前进方向：\n\n* 降低启动成本（如 AOT / GraalVM）\n* 预测与实时结合的准自适应容量\n\n---\n\n## 十、组织与治理\n\n### 10.1 组织设计原则\n\n* 中心化容量能力\n* 去中心化容量意识\n\n容量事故几乎从来不是“某个服务”的问题，而是 **组织协作的结果**。\n\n---\n\n## 十一、小规模系统的容量策略\n\n* 优先保障高性价比路径\n* 充分利用云计费模型\n\n容量工程不是规模专属，而是一种 **工程思维方式**。\n\n## 关联内容（自动生成）\n\n- [/软件工程/性能工程.md](/软件工程/性能工程.md) 性能工程与容量保障密切相关，涉及系统性能的测量、分析和优化，是容量规划和治理的重要基础\n- [/软件工程/架构/架构治理.md](/软件工程/架构/架构治理.md) 架构治理与容量保障相互关联，架构治理关注系统架构的长期演进和治理，而容量保障是架构治理中的重要组成部分\n- [/运维/SRE.md](/运维/SRE.md) SRE实践中的容量规划、SLI/SLO设定等内容与容量保障密切相关，是实现系统容量保障的重要手段\n- [/运维/AIOps.md](/运维/AIOps.md) AIOps中的容量预测和智能决策能力是现代容量保障的重要发展方向，通过AI和ML技术提升容量管理的智能化水平\n- [/软件工程/架构/系统设计/高并发.md](/软件工程/架构/系统设计/高并发.md) 高并发系统设计与容量保障密切相关，涉及系统在高负载下的容量规划和性能保障\n- [/操作系统/linux/Linux性能优化.md](/操作系统/linux/Linux性能优化.md) 系统性能优化与容量保障密切相关，涉及CPU、内存、IO等资源的容量和性能优化\n- [/数据技术/数据处理.md](/数据技术/数据处理.md) 数据处理系统中的容量规划和性能优化与容量保障密切相关，涉及大数据场景下的容量管理\n- [/计算机网络/云计算.md](/计算机网络/云计算.md) 云计算环境下的容量管理与传统容量保障有所不同，涉及弹性伸缩和资源池化管理\n- [/软件工程/微服务/微服务.md](/软件工程/微服务/微服务.md) 微服务架构下的容量保障涉及服务拆分、资源隔离和分布式容量管理\n- [/中间件/数据库/数据库.md](/中间件/数据库/数据库.md) 数据库作为系统的关键组件，其容量规划和性能优化是整体容量保障的重要环节\n- [/软件工程/安全生产.md](/软件工程/安全生产.md) 安全生产与容量保障都关注系统的稳定性和可靠性，涉及故障预防和风险控制\n- [/软件工程/架构/系统设计/可观测性.md](/软件工程/架构/系统设计/可观测性.md) 可观测性是容量保障的基础，通过监控、日志和追踪实现对系统容量状态的感知\n- [/软件工程/软件设计/代码质量/软件测试/性能测试.md](/软件工程/软件设计/代码质量/软件测试/性能测试.md) 性能测试是容量保障的重要手段，通过压测等手段评估系统容量上限\n- [/运维/持续交付.md](/运维/持续交付.md) 持续交付流程中的容量验证和性能测试是保障系统容量的重要环节\n- [/数据技术/数据运维.md](/数据技术/数据运维.md) 数据运维中的容量规划和性能优化与系统容量保障密切相关\n- [/中间件/消息队列/消息队列.md](/中间件/消息队列/消息队列.md) 消息队列作为系统组件，其容量和性能直接影响整体系统的容量保障\n- [/计算机网络/IO模型.md](/计算机网络/IO模型.md) IO模型的选择和优化直接影响系统性能和容量，是容量保障的技术基础\n- [/编程语言/JAVA/JAVA并发编程/Disruptor.md](/编程语言/JAVA/JAVA并发编程/Disruptor.md) 高性能并发组件的设计理念与容量保障密切相关，涉及系统在高并发下的容量管理\n- [/计算机网络/网络安全/安全架构.md](/计算机网络/网络安全/安全架构.md) 安全架构设计中的性能与安全平衡与容量保障相关，安全措施可能影响系统容量\n","metadata":"tags: ['运维', '性能', '软件工程']","hasMoreCommit":false,"totalCommits":7,"commitList":[{"date":"2026-02-12T14:07:03+08:00","author":"MY","message":"doc: 整理标签","hash":"290b3e8ad18f48832ac282290238d020fc030a88"},{"date":"2025-12-31T09:57:26+08:00","author":"MY","message":"docs(capacity): 完善容量工程文档内容并添加相关图片资源","hash":"6dc367a6fcf0a8bd6fcd33b7f6b1e1db3d7e2df2"},{"date":"2024-09-02T20:06:33+08:00","author":"MY","message":"✏可用性","hash":"140f6425596cadfafd5801ad3c2f41fa3b2ce0d8"},{"date":"2022-08-04T17:04:09+08:00","author":"cjiping","message":"✏️更新 容量保障","hash":"18192c8715e18ae3cf20a813f6567400e45f415e"},{"date":"2022-07-19T14:04:43+08:00","author":"cjiping","message":"✏️更新 容量保障","hash":"8c314803cf54c9fae5bd5d1d939bb0d7e1ffb6b0"},{"date":"2022-07-18T16:02:45+08:00","author":"cjiping","message":"✏️更新 容量保障","hash":"6a11bbc932886fc5499f116a2ee6146711b8ff2b"},{"date":"2022-07-14T18:04:54+08:00","author":"cjiping","message":"➕新增 容量保障","hash":"081f7677a75e1c7c1a48e528113be65143315ff5"}],"createTime":"2022-07-14T18:04:54+08:00"}