# 分布式日志

## 传统日志收集

传统项目中，如果在生产环境中，有多台不同的服务器集群，如果生产环境需要通过日志定位项目的Bug的话，需要在每台节点上使用传统的命令方式查询，这样效率非常底下

## ELK

- elasticsearch
- logstash
- kibana

1、每台服务器集群节点安装Logstash日志收集系统插件
2、每台服务器节点将日志输入到Logstash中
3、Logstash将该日志格式化为json格式，根据每天创建不同的索引，输出到ElasticSearch中
4、浏览器使用安装Kibana查询日志信息

## 配置

- logstash配置

```conf
input {
    # 从文件读取日志信息 输送到控制台
    file {
        path => "/home/my/elasticsearch-6.4.3/logs/elasticsearch.log"
        codec => "json" ## 以JSON格式读取日志
        type => "elasticsearch"
        start_position => "beginning"
    }
}

# filter {
#
# }

output {
    # 标准输出 
    # stdout {}
    # 输出进行格式化，采用Ruby库来解析日志   
     stdout { codec => rubydebug }
	 elasticsearch {
        hosts => ["127.0.0.1:9200"]
        index => "es-%{+YYYY.MM.dd}"
    }	 
}
```

- 启动es
- 启动logstash`./logstash -f log.conf`
- 启动kibana