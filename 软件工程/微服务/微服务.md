集中式架构 -> 垂直拆分 -> 分布式服务 -> 服务治理（SOA） -> 微服务

# 微服务

## 概念

- 足够小，内聚性高
- 自治，一个服务就是一个独立的实体

## 原则

- 围绕业务建模而非技术建模
- 自动化文化
- 隐藏实现细节
- 去中心化
- 独立部署
- 隔离失败
  - 当进行远程调用时，要有机制当调用失败时能将错误隔离在一定的范围内
- 可观察
  - 一个服务应提供一定的接口来反映其运行情况

## 什么时候不适合微服务

对要构建的系统越不熟悉，对系统的各个组件划分也就越困难

所以还是先构建单体系统，再逐步对其拆分

## 好处

- 技术异构性
- 弹性，一个服务不可用不会导致级联故障
- 可扩展，一个服务可以运行多个实例
- 简化部署
- 符合组织结构
- 可组合性
- 容易替换

## 面向服务的架构(SOA)

>SOA是一种设计方法，其中包含多个服务，而服务之间通过配合最终会提供一系列功能。一个服务通常以独立的形式存在于操作系统进程中。服务之间通过网络调用，而非采用进程内调用的方式进行通信。

微服务架构可以看做是实现SOA的一种特定方法

## 其他的分解技术

- 共享库
- 模块

## 架构师的视角

软件不同于建筑，相对来说，软件的不可预测因素更多，我们应该设计出一个合理的框架，在这个框架可以慢慢演化出正确的系统，也就是生长的架构。

避免对所有事情做出过于详尽的设计，将注意力专注在大方向上

同时，架构设计就是在做取舍，要有原则及实践来指导设计

### 分区

相对来说，应该多担心区域之间发生的交互，而非区域内的事情

### 良好的服务应该具有的属性

- 监控
  - 每个服务都应该有标准的方式报告其健康状态
- 接口
- 架构的安全性
  - 应该有良好的隔离性

### 代码治理

- 提供范例来指导开发人员如何编写代码
- 提供服务代码模板来简化开发人员的工作

### 技术债务

短期的利益，长期来看是要付出代价的，应该要维护好这个债务列表

### 例外管理

一次例外是例外，多次例外就是规则了

## 系统设计

**康威定律**

>即系统设计本质上反映了企业的组织机构。系统各个模块间的接口也反映了企业各个部门之间的信息流动和合作方式

![批注 2020-03-24 092008](/assets/批注%202020-03-24%20092008.png)

![批注 2020-03-24 092048](/assets/批注%202020-03-24%20092048.png)

### 服务所有权

拥有服务的团队可以对服务做出修改，只要不影响服务的消费者

### 为什么要共享服务

多个团队共同维护一个服务

- 难以拆分
- 团队的组建是基于技术的，而不是业务
- 人员流动更自由

### 内部开源

不再采取团队结构，而是让一小部分人称为核心提交者，其他人可以提交PR

### 孤儿服务

孤儿服务指的是一段时间没有更改的服务

如果团队的组织是按照限界上下文的话，那一个团队可能拥有多个服务，这个孤儿服务在这个团队手上，当发生需求变更时，修改是很容易的。同时，采取了微服务的架构，很多服务都可以进行快速重写

### 反向的康威定律

- 系统设计会影响组织结构吗？
