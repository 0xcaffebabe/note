{"name":"服务建模","id":"软件工程-微服务-服务建模","content":"# 服务建模\n\n## 一、服务建模的第一性原理\n\n### 1.1 复杂性不可消除，只能被管理\n\n软件系统的本质不是代码，而是对**业务复杂性**的承载与约束。\n\n* 业务复杂性来源于：\n\n  * 多角色协作\n  * 状态变化\n  * 规则约束\n  * 不确定性\n* 架构设计的目标不是\"消灭复杂性\"，而是：\n\n  * **隔离复杂性**\n  * **限制复杂性传播**\n\n👉 **服务建模 = 对复杂性进行分区与封装的过程**。\n\n---\n\n### 1.2 边界是复杂系统的核心\n\n在复杂系统中，真正重要的不是模块内部，而是：\n\n* 模块与模块之间的 **边界**\n* 边界两侧的 **责任划分**\n* 边界上的 **协作协议**\n\n> 没有清晰边界的系统，复杂性会指数级增长。\n\n👉 微服务的本质不是\"服务很多\"，而是**边界清晰**。\n\n---\n\n### 1.3 架构必须允许演进\n\n* 业务认知在初期一定是不完整的\n* 早期的模型几乎必然是\"错的\"\n\n因此：\n\n> **好的服务建模不是一次性设计，而是允许被逐步修正的设计**。\n\n---\n\n## 二、服务建模的认知分层（稳定度模型）\n\n为避免\"知识混杂\"，本文将服务建模拆分为四个稳定度层级：\n\n```\n服务建模认知层级\n├─ 第一性原理（最稳定）\n│  ├─ 复杂性管理\n│  ├─ 边界优先\n│\n├─ 架构哲学\n│  ├─ 低耦合 / 高内聚\n│  ├─ 演进式设计\n│\n├─ 架构模式\n│  ├─ Bounded Context\n│  ├─ 聚合（Aggregate）\n│  ├─ 六边形 / 整洁架构\n│  ├─ 绞杀者模式\n│\n└─ 工程策略（不稳定）\n   ├─ Saga\n   ├─ 事件溯源\n   ├─ 报表方案\n```\n\n👉 阅读与实践时，应**优先掌握上层，再选择下层策略**。\n\n---\n\n## 三、什么是\"好服务\"\n\n### 3.1 好服务的本质标准\n\n#### 松耦合\n\n* 服务对外部世界的认知越少越好\n* 只依赖稳定的契约，而非实现细节\n\n#### 高内聚\n\n* 一个服务只解决**一类相关问题**\n* 所有行为围绕同一业务目标展开\n\n👉 **高内聚 = 边界正确的结果**，而非额外设计。\n\n---\n\n## 四、服务建模的三种视角（决策模型）\n\n服务建模常见有三种切入方式，但它们的稳定性不同。\n\n### 4.1 三种视角对比\n\n| 视角   | 稳定性 | 适用阶段 | 风险 |\n| ---- | --- | ---- | -- |\n| 业务能力 | 高   | 全周期  | 低  |\n| 用例   | 中   | 初期探索 | 中  |\n| 技术能力 | 低   | 特定场景 | 高  |\n\n### 4.2 核心结论\n\n* **长期稳定架构应以业务能力为核心**\n* 用例视角适合早期理解需求\n* 技术能力不应主导服务边界\n\n👉 技术应服务于业务边界，而非反之。\n\n---\n\n## 五、Bounded Context：服务建模的核心抽象\n\n### 5.1 Bounded Context 的本质\n\nBounded Context（限界上下文）是：\n\n* 一组**统一业务语义**\n* 一套**一致的业务规则**\n* 一个**概念不被外界污染的世界**\n\n👉 BC 是**认知边界**，不是部署单元。\n\n---\n\n### 5.2 Bounded Context 与 Service 的关系\n\n| 场景               | 说明      |\n| ---------------- | ------- |\n| 1 BC → 1 Service | 理想状态    |\n| 1 BC → N Service | 演进或扩展阶段 |\n| N BC → 1 Service | 早期或过渡阶段 |\n\n👉 **不要教条化\"一对一\"映射**。\n\n---\n\n## 六、业务逻辑的组织方式\n\n### 6.1 架构哲学：依赖反转\n\n* 业务逻辑不依赖外部技术\n* 外部通过适配器接入业务核心\n\n这类架构包括：\n\n* 六边形架构\n* 整洁架构\n\n👉 它们的本质都是：**保护业务核心**。\n\n---\n\n### 6.2 事务脚本 vs 领域模型\n\n| 模式   | 适用场景 | 特点        |\n| ---- | ---- | --------- |\n| 事务脚本 | 简单业务 | 过程式、低成本   |\n| 领域模型 | 复杂业务 | 状态+行为、可演进 |\n\n👉 不要在简单系统中过度设计。\n\n---\n\n## 七、聚合：一致性的边界\n\n### 7.1 聚合的目的\n\n聚合不是为了建模\"对象\"，而是为了：\n\n* **限定一致性范围**\n* **控制事务边界**\n\n聚合根是：\n\n* 唯一对外入口\n* 一致性守护者\n\n---\n\n### 7.2 聚合设计的\"张力\"\n\n* 聚合越小 → 扩展性越好 → 协调成本越高\n* 聚合越大 → 开发成本低 → 扩展受限\n\n👉 聚合设计永远是**权衡问题**。\n\n---\n\n## 八、领域事件：解耦的协议\n\n### 8.1 领域事件的本质\n\n领域事件表示：\n\n> **领域中已经发生、且不可逆的事实**\n\n* 由聚合发布\n* 被异步消费\n\n👉 事件是**跨边界协作的语言**。\n\n---\n\n## 九、从单体到服务：演进式拆分\n\n### 9.1 为什么不要过早拆分\n\n* 早期业务理解不成熟\n* 错误边界的代价极高\n\n👉 **先单体，后服务**是理性选择。\n\n---\n\n### 9.2 绞杀者模式的哲学\n\n* 新功能不再进入旧系统\n* 单体自然萎缩\n\n👉 演进优于革命。\n\n---\n\n## 十、服务拆分的多维决策模型\n\n```\n服务拆分维度\n├─ 业务维度\n│  ├─ 子域\n│  ├─ 业务能力\n│\n├─ 变化维度\n│  ├─ 变化频率\n│  ├─ 生命周期\n│\n├─ 非功能维度\n│  ├─ 性能\n│  ├─ 可靠性\n│  ├─ 安全\n│\n└─ 组织维度\n   ├─ 团队边界\n   ├─ 责任归属\n```\n\n👉 单一维度无法得出合理拆分结论。\n\n---\n\n## 十一、数据、一致性与事务\n\n### 11.1 核心原则\n\n* 避免跨服务事务\n* 接受最终一致性\n\n### 11.2 可选策略（非必选）\n\n* Saga\n* 重试\n* 补偿\n\n👉 **架构设计的最高境界是避免问题，而非解决问题**。\n\n---\n\n## 十二、组织与架构的协同\n\n### 12.1 Conway 定律视角\n\n* 架构是组织结构的映射\n* 服务边界 ≈ 团队边界\n\n### 12.2 责任模型\n\n* 一个服务 = 一个责任主体\n* 聚合根 = 决策中心\n\n👉 技术架构本质上是**社会系统设计**。\n\n---\n\n## 十三、总结\n\n* 服务建模不是技术问题，而是认知问题\n* 好的架构来自对边界的尊重\n* 演进能力比\"完美设计\"更重要\n\n## 关联内容（自动生成）\n\n- [/软件工程/微服务/微服务.md](/软件工程/微服务/微服务.md) 微服务概述文档涵盖了微服务架构的核心概念、挑战和前置条件，与服务建模密切相关\n- [/软件工程/微服务/集成.md](/软件工程/微服务/集成.md) 服务集成是服务建模后的重要环节，涉及服务间通信、跨服务业务流程等关键内容\n- [/软件工程/领域驱动设计.md](/软件工程/领域驱动设计.md) 领域驱动设计是服务建模的重要理论基础，其中的限界上下文、聚合等概念直接影响服务边界划分\n- [/软件工程/架构/系统设计/业务建模.md](/软件工程/架构/系统设计/业务建模.md) 业务建模是服务建模的前提，提供了业务领域的分析和建模方法\n- [/软件工程/架构/系统设计/架构设计.md](/软件工程/架构/系统设计/架构设计.md) 架构设计提供了服务建模的整体框架和设计原则，是服务建模的上层指导\n- [/软件工程/架构模式/分层架构.md](/软件工程/架构模式/分层架构.md) 分层架构是服务内部组织结构的重要模式，与服务建模中的内部结构设计相关\n- [/软件工程/架构/系统设计/分布式/分布式系统.md](/软件工程/架构/系统设计/分布式/分布式系统.md) 微服务本质上是分布式系统，分布式系统的设计原则和挑战对服务建模有重要影响\n- [/软件工程/架构/架构.md](/软件工程/架构/架构.md) 架构的基本概念和原理为服务建模提供了理论基础\n- [/软件工程/架构/系统设计/可观测性.md](/软件工程/架构/系统设计/可观测性.md) 服务建模需考虑可观测性设计，确保拆分后的服务可监控、可追踪\n- [/软件工程/架构/系统设计/网关.md](/软件工程/架构/系统设计/网关.md) 网关是微服务架构中的重要组件，与服务建模中的边界和服务交互设计相关\n- [/软件工程/架构/演进式架构.md](/软件工程/架构/演进式架构.md) 演进式架构理念与服务建模的演进性原则高度契合\n- [/软件工程/架构/架构治理.md](/软件工程/架构/架构治理.md) 服务建模后的治理和维护是确保架构持续有效的关键\n- [/软件工程/设计模式/设计模式.md](/软件工程/设计模式/设计模式.md) 设计模式在服务内部实现中发挥重要作用，是服务建模后实现阶段的重要参考\n- [/数据技术/数据架构.md](/数据技术/数据架构.md) 服务建模需考虑数据分布和一致性策略，与数据架构设计密切相关\n","metadata":"tags: ['分布式系统', '服务建模', '数据技术', '架构设计', '业务建模']","hasMoreCommit":false,"totalCommits":6,"commitList":[{"date":"2026-02-12T14:07:03+08:00","author":"MY","message":"doc: 整理标签","hash":"290b3e8ad18f48832ac282290238d020fc030a88"},{"date":"2026-01-09T15:04:16+08:00","author":"MY","message":"docs(微服务): 完善服务建模文档内容并新增相关图片资源","hash":"b1758654815ea6d56d4a6c7432384b30c09a8cf5"},{"date":"2024-11-25T15:59:06+08:00","author":"MY","message":"📦微服务","hash":"c8734b29d256e1b4841404e738ec87270d58d3f2"},{"date":"2024-11-25T14:06:28+08:00","author":"MY","message":"📦微服务","hash":"984b0cab1bfa9822163a0947a83e9fea875c581a"},{"date":"2020-06-18T16:38:09+08:00","author":"MY","message":"更新 微服务","hash":"e9ad88d1d8b4c922ef0b61ccef6ba19ee7994201"},{"date":"2020-02-09T16:38:48+08:00","author":"MY","message":"微服务增加服务建模","hash":"006340b827ab5d777ba44a3d40ba1318a0d98ca6"}],"createTime":"2020-02-09T16:38:48+08:00"}