{"name":"广告平台","id":"软件工程-架构-系统设计-广告平台","content":"\n# 广告平台\n\n```mermaid\nsequenceDiagram\n    participant User as 用户\n    participant App as 应用/媒体端\n    participant Engine as 广告投放引擎\n    participant CDP as 用户数据平台 (CDP)\n    participant Data as 数据与分析\n    participant AI as 智能化模块\n    participant Support as 审核与风控\n    participant Adv as 广告主端\n\n    User ->> App: 打开应用，请求广告位\n    App ->> Engine: 发送广告请求\n    Engine ->> Support: 检查广告位与素材合规性\n    Support -->> Engine: 返回审核结果\n\n    Engine ->> CDP: 查询用户画像/标签\n    CDP -->> Engine: 返回统一用户画像\n    Engine ->> Data: 查询历史行为数据/分析\n    Data -->> Engine: 返回用户行为分析结果\n    Engine ->> AI: 请求智能定向/出价优化\n    AI -->> Engine: 返回推荐广告候选\n\n    Engine ->> Adv: 拉取可投放的广告素材\n    Adv -->> Engine: 返回广告创意与出价\n\n    Engine ->> Engine: 进行实时竞价和排序 (RTB)\n    Engine -->> App: 返回最优广告\n\n    App -->> User: 展示广告\n    User ->> App: 点击广告\n    App ->> Data: 上报点击/转化事件\n    Data ->> Adv: 归因与报表统计\n    Data ->> Support: 风控检测，防作弊\n\n```\n\n## 模型\n\n### 广告需求模型\n\n广告需求模型 = 广告主意图的结构化表达 + 平台投放优化的需求强度预测\n\n```mermaid\nsequenceDiagram\n    participant Adv as 广告主\n    participant Platform as 广告平台\n    participant Model as 广告需求模型\n    participant Engine as 投放引擎\n    participant User as 用户/媒体端\n\n    Adv ->> Platform: 提交广告需求<br/>合同/计划/创意\n    Platform ->> Model: 解析需求<br/>目标、预算、定向、时间、创意\n    Model -->> Platform: 输出结构化需求对象\n\n    Platform ->> Engine: 下发广告计划\n    Engine ->> Engine: 结合需求模型进行竞价与排序<br/>eCPM=出价×CTR×质量因子\n    Engine -->> User: 返回最优广告\n\n    User ->> User: 浏览/点击/转化\n    User ->> Platform: 上报曝光/点击/转化日志\n    Platform ->> Model: 更新CTR/CVR预估\n    Model -->> Platform: 反馈优化参数\n    Platform ->> Adv: 生成投放报表与效果评估\n\n```\n\n### 广告投放模型\n\n广告需求模型：侧重于广告主的需求\n\n广告投放模型：侧重于广告平台如何投放\n\n包含：\n\n1. 流量预测与定向\n2. 点击率/转化率预估（CTR/CVR Prediction）\n3. 出价与竞价策略\n4. 投放控制\n5. 效果反馈与优化\n\n#### 计费模型\n\n定义：广告主和平台之间如何结算费用\n\n- CPC（Cost Per Click）：按点击收费\n- CPM（Cost Per Mille）：每千次曝光收费\n- CPA（Cost Per Action）：按转化（注册、下单等）收费\n- CPT（Cost Per Time）：按时间段买断广告位（比如开屏广告一天 100 万）\n- oCPX（Optimized Cost Per X）：平台通过智能投放，优化某个目标（点击、转化、留存）\n\n## 广告投放引擎\n\n### 广告投放引擎核心组件\n\n1. **广告请求接收层 (Ad Request Handler)**\n\n   * 接收用户页面或 APP 的广告请求。\n   * 验证请求合法性和必需参数。\n\n2. **用户/受众数据服务 (User Profile / Audience Service)**\n\n   * 提供用户特征、兴趣、历史行为等数据。\n   * 支撑定向投放。\n\n3. **广告库存管理 (Ad Inventory / Campaign Service)**\n\n   * 管理可投放的广告及广告预算。\n   * 包含广告投放规则、投放时间、竞价信息等。\n\n4. **匹配与竞价引擎 (Ad Matching & Bidding Engine)**\n\n   * 根据广告请求 + 用户信息 + 广告库存进行匹配。\n   * 支持实时竞价（RTB）或固定优先级投放。\n\n5. **广告排序与优化 (Ranking & Optimization)**\n\n   * 根据点击率预测 (CTR)、转化率预测 (CVR)、收益优化等对候选广告排序。\n\n6. **广告决策输出 (Ad Decision / Response)**\n\n   * 返回最终广告给前端展示。\n\n7. **监控与统计 (Analytics / Reporting Service)**\n\n   * 记录曝光、点击、转化等事件，用于优化和计费。\n\n---\n\n```mermaid\nsequenceDiagram\n    participant User as 用户端\n    participant AdReq as 广告请求接收层\n    participant Profile as 用户数据服务\n    participant Inventory as 广告库存管理\n    participant Match as 匹配与竞价引擎\n    participant Rank as 排序与优化\n    participant Response as 广告响应层\n    participant Analytics as 监控统计服务\n\n    User->>AdReq: 请求广告\n    AdReq->>Profile: 获取用户画像\n    AdReq->>Inventory: 获取可投放广告\n    Inventory->>Match: 提供候选广告\n    Profile->>Match: 提供用户信息\n    Match->>Rank: 进行排序与优化\n    Rank->>Response: 返回最终广告\n    Response->>User: 展示广告\n    Response->>Analytics: 上报曝光数据\n    User->>Analytics: 上报点击/转化事件\n```\n\n## 用户画像\n\n1. **数据采集**\n\n   * 来源：\n\n     * **第一方数据**：用户在 App/网站上的浏览、搜索、点击、购买、停留时长\n     * **第三方数据**：外部 DMP（Data Management Platform）提供的人群标签\n     * **设备数据**：手机型号、操作系统、IP/位置、应用安装情况\n   * 技术：埋点（埋 SDK/JS）、日志采集（Kafka）、CDP（客户数据平台）\n\n2. **数据清洗与归一化**\n\n   * 去重、填补缺失、异常值处理\n   * 用户 ID 统一（cookie、设备号、登录账号 → 映射到统一 UID）\n\n3. **特征构建**\n\n   * **静态特征**：性别、年龄、地域、设备型号\n   * **动态特征**：最近 7 天点击过的品类、近 30 天的消费能力、访问频次\n   * **兴趣标签**：阅读新闻类/游戏类/母婴类内容 → 打兴趣分数\n   * 技术：Flink / Spark Streaming 做实时特征更新\n\n4. **用户建模**\n\n   * **聚类**：K-means / DBSCAN，把相似用户分为一类（如“二次元群体”、“中产妈妈群体”）\n   * **Embedding 表示**：用深度学习把用户行为序列转为向量（User Embedding）\n   * **Look-alike**：找到和已转化用户相似的“潜在用户”\n\n5. **标签系统落地**\n\n   * 存储：\n\n     * 实时查询：Redis / HBase / Cassandra（毫秒级查询）\n     * 离线分析：Hive / ClickHouse\n   * 标签示例：\n\n     ```\n     用户123:\n       性别: 女\n       年龄: 25-34\n       兴趣: 美妆(0.87), 健身(0.62), 母婴(0.40)\n       设备: iPhone 14 Pro\n       最近购买: 运动鞋, 面膜\n     ```\n\n6. **持续更新**\n\n   * 用户行为每天都在变 → 系统要支持 **实时更新**（Flink/Kafka） + **离线校正**（日/周批处理）。\n\n---\n\n用户画像 = **采集多源数据 → 清洗 → 构建特征 → 建模 → 存储 → 实时更新**。\n\n## 审核与风控\n\n### 1. **广告素材与内容审核**\n\n* **目标**：保证广告创意合法、合规、不会伤害用户体验。\n* **常见审核点**：\n\n  * 违法违规内容（涉黄、涉毒、涉政）\n  * 误导性营销（虚假宣传、夸大效果）\n  * 版权合规（图片/音乐是否侵权）\n  * 品类限制（如医疗、金融需特殊资质）\n* **技术手段**：\n\n  * NLP：敏感词检测（BERT、FastText）\n  * CV（计算机视觉）：识别图片/视频内容（OCR、图像分类、Logo 检测）\n  * 人工审核：机器过滤后，再交人工复核\n\n---\n\n### 2. **用户行为风控**\n\n* **目标**：防止 **虚假流量、恶意点击、作弊安装**，保护广告主利益。\n* **检测点**：\n\n  * 点击作弊（刷点击、模拟器刷量）\n  * 安装作弊（买量渠道刷激活）\n  * 机器人流量（爬虫、脚本）\n* **技术手段**：\n\n  * 异常检测（同一 IP 短时间高频点击）\n  * 设备指纹识别（IMEI、浏览器指纹）\n  * 行为建模（正常用户行为 vs 异常模式）\n  * 图模型（检测“作弊团伙”——一群设备互相点击）\n\n---\n\n### 3. **账号与财务风险防控**\n\n* **广告主侧**：\n\n  * 恶意广告主（投放几天跑路、不付账单）\n  * 洗钱、套现行为\n* **用户侧**：\n\n  * 盗刷信用卡购买广告\n* **技术手段**：\n\n  * 信用评估模型（机器学习分类）\n  * 黑名单/白名单（已知恶意广告主、IP、设备号）\n  * 交易异常检测\n\n---\n\n### 4. **实时风控引擎**\n\n* **目标**：保证风控不是事后追溯，而是 **实时拦截**。\n* **实现**：\n\n  * **流式处理**：Kafka + Flink（实时检测点击/安装异常）\n  * **规则引擎**：Drools / 自研 DSL（业务规则配置）\n  * **低延迟数据库**：Redis / Aerospike（秒级黑名单拦截）\n\n---\n\n### 5. **合规与政策适配**\n\n* 不同国家/地区的 **法律合规**（GDPR、CCPA、广告法）\n* 特殊行业广告（金融、医疗、游戏）必须有资质证书\n* 风控模块负责 **动态更新规则**，确保投放合法\n\n## 报表指标\n\n广告主关心的指标大致分三层：\n\n1. **流量层**：曝光、点击、CTR\n2. **效果层**：转化、CVR、CPA\n3. **收益层**：ROI/ROAS、分人群/渠道效果\n\n### 1. **曝光量 (Impressions)**\n\n* 广告被展示的次数。\n* 关注点：投放是否覆盖到足够的目标人群。\n\n### 2. **点击量 (Clicks) & 点击率 (CTR)**\n\n* 点击量：广告被点击的次数。\n* CTR = 点击量 ÷ 曝光量。\n* 关注点：广告素材和定向是否有效，用户是否感兴趣。\n\n### 3. **转化量 (Conversions) & 转化率 (CVR)**\n\n* 转化：用户点击广告后完成的关键行为（注册、购买、下载）。\n* CVR = 转化量 ÷ 点击量。\n* 关注点：广告是否带来了真实的业务价值。\n\n### 4. **花费 (Cost)**\n\n* 广告主实际支出的费用。\n* 常见计费方式：\n\n  * CPM（千次曝光成本）\n  * CPC（点击成本）\n  * CPA（转化成本）\n\n### 5. **平均成本指标**\n\n* **CPC**：每次点击的平均成本 = 花费 ÷ 点击量\n* **CPA**：每次转化的平均成本 = 花费 ÷ 转化量\n* **CPM**：每千次曝光的平均成本 = 花费 ÷ (曝光量/1000)\n* 广告主通常会盯着 **CPA**，因为它和 ROI 最相关。\n\n### 6. **ROI / ROAS**\n\n* ROI（投资回报率）：(转化产生的收入 - 广告花费) ÷ 广告花费\n* ROAS（广告支出回报率）：收入 ÷ 广告花费\n* 广告主最核心的指标，直接决定是否继续投放。\n\n### 7. **人群和渠道维度指标**\n\n* 分地域、性别、年龄、设备、媒体渠道来拆分曝光/点击/转化。\n* 关注点：哪些人群最值钱，哪些渠道最有效。\n\n### 8. **频次 (Frequency)**\n\n* 平均每个用户看到广告的次数。\n* 太高 = 烦扰用户，太低 = 转化不足。\n","metadata":"","hasMoreCommit":false,"totalCommits":3,"commitList":[{"date":"2025-09-10T18:18:41+08:00","author":"MY","message":"docs(架构): 更新广告投放系统架构图","hash":"2adc2a0177f730bf36e7e40a5ff754daf6a8c7c6"},{"date":"2025-09-10T15:24:01+08:00","author":"MY","message":"docs: remove unnecessary section break in ad-engine documentation","hash":"a0f11756d731d062a5159c3cff04b9679f832eb3"},{"date":"2025-09-09T18:13:21+08:00","author":"MY","message":"docs(summary): add reference to advertising platform design","hash":"eeb1b884246add640695e44e835f91e93ea6be14"}],"createTime":"2025-09-09T18:13:21+08:00"}