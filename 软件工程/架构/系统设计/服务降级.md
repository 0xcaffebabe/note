# 服务降级

为了保证整体系统可用性，可以牺牲一部分功能依旧提供**有损服务**

## 降级处理

### 兜底数据

默认值: 设置安全的默认值，不会引起数据问题，比如库存为0

静态值:请求的页面或api无法返回数据，提供一套静态数据展示，比如加载失败提示重试，或默认菜单

缓存: 缓存无法更新便使用旧的缓存

## 降级原则

距离用户越近 造成损失越小 避免滚雪球效应

## 降级类型

- 限流降级
  - 当流量洪峰到达的时候，对于丢弃的用户可以提供友好的提示
- 超时降级
  - 对调用的数据设置超时时间，当调用失败，对服务降级
- 重试/自动处理
  - 当达到重试次数后，增加访问标记，服务降级，异步探测服务是否恢复(熔断器半开)
  - 注意幂等性
- 数据组装降级
  - 多库/多维度组装JSON/XML时，如果有一些不重要的数据无法获取或数据出错，可以忽略继续
- 爬虫降级
  - 分析机器人行为 引到到静态页或缓存页
- 读降级
  - 多级缓存架构下，后端缓存或db不可用，可以使用前端缓存或兜底数据
- 写降级
  - 高并发场景下，写入操作无法及时到达或抗压，可以异步消费数据/cache更新/log等方式
- 前端降级
  - js 埋点
  - 接入层降级 nginx
  - 应用层降级 hystrix sentinel
- 片段降级
  - 忽略js文件加载
- 静态化降级
  - 缓存静态化html 作为兜底数据