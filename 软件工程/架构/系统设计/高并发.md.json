{"name":"高并发","id":"软件工程-架构-系统设计-高并发","content":"# 高并发系统设计\n\n## 一、高并发的本质：系统性矛盾与工程妥协\n\n### 1. 高并发并不是“快”\n\n高并发问题的本质，并非单点性能不足，而是：\n\n* **有限资源** 与 **无限请求** 之间的矛盾\n* **强一致性** 与 **系统吞吐 / 延迟** 之间的冲突\n* **实时计算** 与 **可预测稳定性** 之间的权衡\n\n因此，高并发系统设计是一门：\n\n> 在资源受限前提下，对请求进行**调度、延迟、削峰、分摊与妥协**的工程学。\n\n---\n\n### 2. 高并发设计的三大核心手段\n\n所有高并发技术手段，最终都可归结为三类：\n\n1. **时间换空间**：缓存、预计算、异步化\n2. **空间换并行**：拆分、分片、扩容\n3. **一致性换可用性**：最终一致、读写分离、延迟容忍\n\n---\n\n## 二、高并发系统能力模型（核心抽象）\n\n高并发系统并非“堆技术”，而是构建一组稳定能力。\n\n```\n高并发系统能力模型\n├─ 吞吐放大能力\n│  ├─ 横向扩展（拆分 / 扩容）\n│  ├─ 负载均衡\n│  └─ 批量化处理\n├─ 峰值削减能力\n│  ├─ 缓存体系\n│  ├─ 异步化 / MQ\n│  └─ 预计算（重写轻读）\n├─ 等待与调度能力\n│  ├─ 排队系统\n│  ├─ 限流（令牌桶 / 漏桶）\n│  └─ 优先级与配额\n├─ 一致性妥协能力\n│  ├─ 读写分离\n│  ├─ 最终一致\n│  └─ 延迟容忍\n├─ 稳定性与治理能力\n│  ├─ 熔断 / 降级\n│  ├─ 可观测性（监控 / APM）\n│  └─ 弹性扩缩容\n```\n\n后续章节将围绕该能力模型展开。\n\n---\n\n## 三、吞吐放大能力：让系统“接得住”\n\n### 1. 系统拆分（空间换并行）\n\n**设计原则**：避免所有请求竞争同一资源。\n\n**抽象模型**：\n\n* 将单体系统拆分为多个**低耦合子系统**\n* 每个子系统拥有独立资源边界（数据库、线程池、缓存）\n\n**拆分维度**：\n\n* 业务维度（领域边界）\n* 功能维度（职责单一）\n* 资源维度（冷热分离、轻重分离）\n\n> 拆分不是一次性行为，而是伴随业务复杂度增长的持续过程。\n\n---\n\n### 2. 负载均衡（请求分摊机制）\n\n**设计原则**：任何可横向扩展的能力，必须配合负载均衡。\n\n**抽象层级**：\n\n* 链路级：DNS\n* 网络级：四层负载均衡（LVS）\n* 应用级：七层负载均衡（Nginx / Gateway）\n* 客户端级：客户端感知与服务发现\n\n**负载均衡算法本质分类**：\n\n* 任务均分（轮询 / 随机）\n* 压力感知（最少连接 / 响应时间）\n* 状态绑定（一致性哈希）\n\n---\n\n### 3. 批量化处理\n\n**设计原则**：减少单位请求的系统调用与 IO 次数。\n\n* 批量写入\n* 合并小操作\n* 管道化处理\n\n代价：延迟上升、实时性下降。\n\n---\n\n## 四、峰值削减能力：让系统“慢慢消化”\n\n### 1. 缓存体系（时间换空间）\n\n**抽象模型**：\n\n* 多级缓存（本地 → 分布式 → CDN）\n\n**解决问题**：\n\n* 将热点请求挡在慢资源（数据库）之前\n\n**系统性风险**：\n\n* 缓存雪崩\n* 缓存击穿\n* 缓存穿透\n\n缓存设计本质是**一致性与性能的权衡**。\n\n---\n\n### 2. 异步化与消息队列\n\n**设计原则**：\n\n* 请求与处理解耦\n* 峰值写入转化为平稳消费\n\n**抽象能力**：\n\n* 削峰填谷\n* 解耦系统\n* 延迟容忍\n\n代价：\n\n* 系统复杂度上升\n* 需要处理重复、乱序、幂等\n\n---\n\n### 3. 预计算（重写轻读）\n\n**设计原则**：\n\n* 把“实时复杂计算”前移到写路径\n\n适用于：\n\n* 读远多于写\n* 计算成本远高于存储成本的场景\n\n---\n\n## 五、等待与调度能力：承认资源有限\n\n### 1. 排队系统\n\n* 显式排队（队列、等待页）\n* 隐式排队（线程池、连接池）\n\n排队是对“资源有限”的正面承认。\n\n---\n\n### 2. 限流与配额\n\n**核心目标**：\n\n* 防止系统被瞬时流量压垮\n\n**典型模型**：\n\n* 令牌桶\n* 漏桶\n\n限流策略本质是**服务质量管理（QoS）**。\n\n---\n\n## 六、一致性妥协能力：读写分离与最终一致\n\n### 1. 读写分离\n\n**设计动机**：\n\n* 读多写少场景下，缓解主库压力\n\n**核心问题**：\n\n* 复制延迟\n\n**工程应对**：\n\n* 核心路径读主\n* 非核心路径容忍旧数据\n\n---\n\n### 2. 最终一致性\n\n高并发系统往往主动放弃强一致，换取：\n\n* 更高吞吐\n* 更好可用性\n\n---\n\n## 七、稳定性与治理能力：系统长期可用的前提\n\n### 1. 可观测性\n\n* 指标监控（资源 / 延迟 / 错误率）\n* 链路追踪\n* 业务监控\n\n> 没有可观测性，就没有可治理性。\n\n---\n\n### 2. 熔断与降级\n\n**设计原则**：\n\n* 局部失败不可扩散\n\n降级不是失败，而是**系统自我保护机制**。\n\n---\n\n### 3. 弹性扩缩容\n\n* 通过监控数据触发\n* 本质是资源与负载的动态匹配\n\n---\n\n## 八、高并发系统的演进路径\n\n1. **早期阶段**：单体 + 缓存 + 性能优化\n2. **成长阶段**：系统拆分 + 异步化\n3. **规模阶段**：分片 + 读写分离 + 治理体系\n4. **成熟阶段**：稳定性优先、最终一致\n\n> 高并发设计没有\"最优解\"，只有\"阶段最优解\"。\n\n---\n\n## 结语：从技术堆叠到系统认知\n\n高并发系统设计的核心能力：\n\n* 是否理解系统瓶颈出现在哪里\n* 是否清楚每一次性能提升背后的代价\n* 是否具备在一致性、延迟、成本之间做选择的能力\n\n## 关联内容（自动生成）\n\n- [/软件工程/架构/系统设计/缓存.md](/软件工程/架构/系统设计/缓存.md) 缓存是高并发系统设计中的核心技术手段，用于解决有限资源与无限请求之间的矛盾，通过时间换空间策略提升系统性能\n- [/软件工程/架构/系统设计/可用性.md](/软件工程/架构/系统设计/可用性.md) 高可用性是高并发系统的重要组成部分，涉及熔断、降级等系统保护机制，确保系统在高负载下的稳定运行\n- [/软件工程/架构/系统设计/扩展性.md](/软件工程/架构/系统设计/扩展性.md) 扩展性是高并发系统设计的关键能力之一，通过系统拆分、负载均衡等手段实现系统的横向扩展\n- [/软件工程/架构/系统设计/流量控制.md](/软件工程/架构/系统设计/流量控制.md) 流量控制是高并发系统中的重要环节，包含限流、排队等调度能力，防止系统被瞬时流量压垮\n- [/软件工程/架构/系统设计/分布式/分布式系统.md](/软件工程/架构/系统设计/分布式/分布式系统.md) 分布式系统是解决高并发问题的重要架构模式，通过空间换并行的策略提升系统整体处理能力\n- [/软件工程/架构/系统设计/可观测性.md](/软件工程/架构/系统设计/可观测性.md) 可观测性是高并发系统治理能力的重要组成部分，提供监控、链路追踪等手段帮助理解和优化系统性能\n- [/软件工程/架构/系统设计/网关.md](/软件工程/架构/系统设计/网关.md) 网关作为系统的入口，在高并发场景下承担着负载均衡、限流、熔断等关键职责\n- [/软件工程/架构/系统设计/伸缩性.md](/软件工程/架构/系统设计/伸缩性.md) 伸缩性与高并发系统设计紧密相关，涉及系统如何根据负载情况动态调整资源分配\n- [/中间件/web中间件/Nginx.md](/中间件/web中间件/Nginx.md) Nginx作为常用的负载均衡和反向代理工具，在高并发系统架构中发挥重要作用\n- [/中间件/数据库/数据库优化.md](/中间件/数据库/数据库优化.md) 数据库优化是高并发系统设计中的关键环节，涉及分库分表、读写分离等策略\n- [/软件工程/性能工程/性能优化.md](/软件工程/性能工程/性能优化.md) 性能优化是高并发系统设计的基础，提供了系统性优化策略和方法论\n- [/中间件/消息队列/消息队列.md](/中间件/消息队列/消息队列.md) 消息队列是高并发系统中实现异步化和削峰填谷的重要组件\n- [/操作系统/linux/Linux性能优化.md](/操作系统/linux/Linux性能优化.md) 系统层面的性能优化是高并发系统设计的基础，涉及资源管理和调度优化\n- [/软件工程/架构/系统设计/混沌工程.md](/软件工程/架构/系统设计/混沌工程.md) 混沌工程通过主动注入故障来验证高并发系统的稳定性和韧性\n- [/软件工程/微服务/服务治理/服务治理.md](/软件工程/微服务/服务治理/服务治理.md) 微服务架构下的服务治理机制对于构建高并发系统至关重要\n","metadata":"tags: ['计算机系统', '并发编程', '性能', '分布式系统']\nbooks: [\n\t{name: '深入分析Java Web技术内幕'}\n]","hasMoreCommit":true,"totalCommits":22,"commitList":[{"date":"2026-02-12T14:07:03+08:00","author":"MY","message":"doc: 整理标签","hash":"290b3e8ad18f48832ac282290238d020fc030a88"},{"date":"2026-01-21T17:39:58+08:00","author":"MY","message":"docs(system-design): 更新高并发系统设计文档并添加相关图片资源","hash":"cb8300b799c28e3ffd58dd7ac3af5b717c61c6dc"},{"date":"2025-11-27T19:59:51+08:00","author":"MY","message":"docs: 调整多个文档中的链接格式与内容排版 - 统一去除部分链接的 Markdown 文件后缀（.md） - 修正不一致的列表项格式和缩进问题 - 删除冗余或错误的文件引用路径 - 提升文档可读性与内部跳转准确性","hash":"b81b0f366a2079be0ad09074488f23c13cb51615"},{"date":"2024-11-22T10:11:46+08:00","author":"MY","message":"📦伸缩性","hash":"200aa0a73291a296032cf358327b73c387f0662f"},{"date":"2024-11-21T17:01:26+08:00","author":"MY","message":"📦高并发","hash":"819b8838c0173819d23b03b67f4f6e9aa22123f0"},{"date":"2023-01-16T14:42:20+08:00","author":"cjiping","message":"📦数据库","hash":"28000b081b4f987f0343c41be793307aedb6addf"},{"date":"2022-08-11T21:50:32+08:00","author":"MY","message":"✏️高并发&可用性","hash":"7ab1e83653b1b3901139699204604ab974fabf57"},{"date":"2022-05-06T21:43:14+08:00","author":"MY","message":"✏️更新 架构","hash":"925779837e7929344533f39572e8aa1c71a0363f"},{"date":"2022-05-05T21:27:28+08:00","author":"MY","message":"✏️更新 架构","hash":"71d10631ca3ab266514f747d12e434e26140bb30"},{"date":"2021-09-26T23:18:28+08:00","author":"My","message":"✏️更新 高并发","hash":"3769bb6aa7ced480df2c186efec33c73e135ca33"}],"createTime":"2020-03-16T21:05:42+08:00"}