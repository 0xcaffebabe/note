# 表述

## 分层

上层使用下层定义的各种服务，下层对上层隐藏下下层的细节

层次并不能封装所有东西，有时会带来级联修改，过多的层次也会影响性能

### 三个基本层次

- 表现层
- 领域层
- 数据源层

## 组织领域逻辑

- 编写业务逻辑

### 事务脚本

优点

- 易于理解
- 能与简单数据源层很好合作
- 事务边界容易划分

缺点

- 业务复杂导致代码冗余复杂

#### 领域模型

- 使用面向对象的方法

开销来源于使用复杂以及数据源的复杂，还要面对将领域模型映射到数据库的问题

### 表模块

- 围绕表组织领域逻辑

### 服务层

- 将领域层再拆为两层，服务层提供简单的API接口

## 映射到关系数据库

### 架构模式

- 活动记录
  - 类似于JAVA Bean
- 数据映射器
  - ORM

### 行为

如何保证对领域对象的修改能及时存储到数据库

- 标志映射
  - 保证相同的对象只被加载一次
- 延迟加载

### 读取数据

### 结构映射模式

#### 关系的映射

- 外键映射一对多
- 关联表映射多对多

#### 继承

- 单表继承
  - 多个层次共享同一张表

![](https://chuhang123.github.io/images/97.png)

- 具体表继承
  - 一个层次一张表

![](https://chuhang123.github.io/images/100.png)

- 类表继承
  - 一个类一张表

![](https://chuhang123.github.io/images/98.png)

### 建立映射

将数据库设计看做一种持久化对象数据的方法

- 双向映射
  - 将对象-数据库以及数据库-对象两种映射分开设计

### 元数据

- 通过元数据的描述自动生成代码

### 数据库连接

- 使用连接池管理连接
- 将连接与事务绑定在一起



