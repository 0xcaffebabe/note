# 代码重构

在不改变代码外在行为的前提下，对代码进行修改，以改进程序的内部结构

- 如果你要给程序添加一个特性，但发现代码因缺乏良好的结构而不易于进行更改，那就先重构那个程序，使其比较容易添加该特性，然后再添加该特性。
- 重构前，先检查自己是否有一套可靠的测试代码。这些测试必须有自我检验能力。
- 重构技术就是以微小的步伐修改程序。 如果你犯下错误，很容易便可发现它。

## 重构原则

### 为何重构

- 改进软件的设计
- 使代码更容易理解
- 提高编程速度

### 何时重构

- 预备性重构：添加新功能的时候
- 帮助理解的重构：为了理解系统或者代码所做的工作
- 捡垃圾式重构：偶然发现一处坏代码，重构它
- 修复错误的时候
- 代码审查的时候

### 何时不该重构

- 不会被用到的代码
- 重构的代价比重写的代价还高的代码

### 如何保证重构的正确性

测试是保证代码正确性的强有力保证

- 自动化
- 测试不通过真的会失败
- 频繁运行测试
- 注意边界条件
- 使用测试来重现bug

## 代码的坏味道

- 奇怪的命名
- 重复代码
- 过长的函数
- 过长的参数列表
- 全局数据
- 可变数据
- 发散式变化
  - 一个修改会影响到许多地方
- 霰弹式修改
  - 一个变化需要修改许多地方
- 过度依赖外部模块
- 类中重复的数据
- 基本类型偏执
  - 总觉得基本类型效率更高，不愿使用对象
- 大量重复的switch/if
- 复杂的循环语句
- 冗余的元素
  - 一个简单的函数、一个简单的操作
- 过度设计的通用性
  - 过度考虑了对象/函数的用途
- 临时字段
- 过长的对象调用
- 没有必要的中间对象
- 两个模块耦合过紧
  - 考虑将它们移动到新模块
- 过大的类
- 过度相似的类
- 纯数据类
  - 数据和行为没有在一起
- 继承父类，但不提供父类的接口

## 重构技巧

### 代码的坏味道

- 同一段重复代码可以抽取到函数里
- 函数过长，可以对一些子逻辑进行封装，抽取到函数里
- 类过大，可能要具体分析，将代码拆分到不同的类中
- 参数列表过程过程，可使用参数对象代替
- 