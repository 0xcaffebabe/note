{"name":"单元测试","id":"软件工程-软件设计-代码质量-软件测试-单元测试","content":"# 单元测试\n\n> 单元测试不是为了证明代码正确，而是为了**控制变化带来的系统性风险**。\n\n---\n\n## 一、单元测试的第一性原理\n\n### 1. 软件系统的三个不变事实\n\n1. **变化不可避免**：需求变化、人员流动、环境演进是常态\n2. **人必然会犯错**：复杂系统中不存在零缺陷工程\n3. **复杂度只增不减**：系统一旦上线，复杂度随时间单调上升\n\n单元测试的存在目的，并非“验证正确性”，而是：\n\n> **在变化发生时，限制错误传播的范围与成本。**\n\n---\n\n## 二、单元测试在软件工程中的系统位置\n\n### 1. 风险控制视角\n\n单元测试是软件系统的**最小风险防火墙**：\n\n* 限定爆炸半径\n* 提供快速失败与回归保护\n* 将风险前移到开发阶段\n\n### 2. 架构治理视角\n\n单元测试通过“可测性”反向约束架构设计：\n\n* 强制低耦合\n* 强制显式依赖\n* 强制单一职责\n\n> **不可测试的代码，本质上是架构失控的信号。**\n\n---\n\n## 三、单元测试的能力分层模型\n\n```\n┌──────────────────────┐\n│ 风险控制层           │  爆炸半径 / 回归信心\n├──────────────────────┤\n│ 架构约束层           │  解耦 / 接缝 / 可替换\n├──────────────────────┤\n│ 工程实践层           │  Mock / 覆盖率 / 工具\n└──────────────────────┘\n```\n\n所有测试实践，都应能在该模型中找到其存在理由。\n\n---\n\n## 四、单元测试的核心原则体系\n\n### 1. AIR 原则（工程稳定性）\n\n* **Automation**：测试必须可自动执行\n* **Independent**：测试之间互不依赖\n* **Repeatable**：在任何环境中结果一致\n\n### 2. FIRST 原则（反馈效率）\n\n* **Fast**：支撑高频执行\n* **Independent**：失败可定位\n* **Repeatable**：去环境依赖\n* **Self-validating**：无需人工判断\n* **Timely**：测试与代码同步产生\n\n> 原则不是规范，而是**工程决策的约束条件**。\n\n---\n\n## 五、单元测试的边界与粒度\n\n### 1. 什么是“单元”\n\n单元并非语法层面的方法或类，而是：\n\n> **一个职责闭合、行为可预测、依赖可替换的最小行为单元**\n\n### 2. 粒度选择原则\n\n* 行为级而非实现级\n* 一个测试只验证一个概念\n* 核心路径优先覆盖\n\n---\n\n## 六、单元测试与集成测试的本质差异\n\n| 维度   | 单元测试  | 集成测试  |\n| ---- | ----- | ----- |\n| 关注点  | 行为正确性 | 协作正确性 |\n| 依赖   | 被隔离   | 真实存在  |\n| 稳定性  | 高     | 低     |\n| 反馈速度 | 快     | 慢     |\n\n> 单元测试解决**局部正确性**，集成测试验证**系统协作关系**。\n\n---\n\n## 七、单元测试的复杂性来源\n\n1. **输入复杂性**：一切影响执行路径的因素\n2. **输出复杂性**：所有被修改的状态与副作用\n3. **依赖复杂性**：外部系统、时间、随机性\n\n应对复杂性的唯一方式是：\n\n> **控制变量，而不是增加断言。**\n\n---\n\n## 八、测试代码的工程规范\n\n### 1. 测试即文档\n\n* 构造（Given）\n* 执行（When）\n* 验证（Then）\n\n```java\nassertUserExists(\"cxk\");\n```\n\n好的测试 API 是业务语言的直接表达。\n\n### 2. 断言策略\n\n* 断言最少化\n* 行为级断言优先\n* 避免实现细节绑定\n\n### 3. 命名原则\n\n* 测试名表达行为\n* 细节放入注释\n\n---\n\n## 九、可测性：架构质量的外显指标\n\n### 1. 不可测的根因\n\n* 隐式依赖\n* 强耦合\n* 副作用泛滥\n\n### 2. 可测性改造策略\n\n* **对象接缝**：继承替换行为\n* **接口接缝**：依赖抽象\n* **新生策略**：新增可测路径\n* **包装策略**：隔离历史代码\n\n> 重构不是为了测试，测试是为了暴露重构需求。\n\n---\n\n## 十、覆盖率的工程语境\n\n### 1. 覆盖率的本质\n\n覆盖率是**风险可见性指标**，而非质量指标。\n\n### 2. 决策导向的覆盖策略\n\n| 场景   | 推荐覆盖    |\n| ---- | ------- |\n| 核心业务 | 分支 / 条件 |\n| 工具代码 | 行覆盖     |\n| 遗留系统 | 新增路径    |\n\n---\n\n## 十一、测试数据构造策略\n\n* 手动：小规模、精确控制\n* 半自动：工具辅助\n* 自动生成：复杂对象构造\n\n工具示例：\n\n* java-faker\n* easy-random\n\n---\n\n## 十二、不同层级代码的测试策略\n\n### 1. 数据访问层\n\n* 回滚事务\n* 内存数据库隔离\n\n### 2. 服务层\n\n* Mock 所有外部依赖\n* 聚焦业务规则\n\n### 3. 工具类\n\n* 正常 + 边界路径全覆盖\n* 高优先级保障\n\n---\n\n## 十三、组织与文化视角\n\n### 1. 单测失败的真实原因\n\n* 交付压力\n* 架构债务\n* 评价体系缺失\n\n### 2. 单元测试的真正价值\n\n> 单元测试不是程序员的负担，而是团队对未来不确定性的集体保险。\n\n---\n\n## 结语\n\n单元测试不是一种技术能力，而是一种**系统性工程思维**。\n\n它要求我们：\n\n* 接受变化\n* 正视复杂\n* 用结构化手段对抗熵增\n\n这，才是单元测试长期存在的根本原因。\n\n## 关联内容（自动生成）\n\n- [/软件工程/软件设计/代码质量/软件测试/软件测试.md](/软件工程/软件设计/代码质量/软件测试/软件测试.md) 软件测试是单元测试的上层概念，定义了整个测试体系的分类和原则，单元测试是其中的重要组成部分\n- [/软件工程/软件设计/代码质量/软件测试/自动化测试.md](/软件工程/软件设计/代码质量/软件测试/自动化测试.md) 自动化测试与单元测试密切相关，单元测试是自动化测试的基础和核心组成部分\n- [/软件工程/软件设计/代码质量/整洁代码.md](/软件工程/软件设计/代码质量/整洁代码.md) 整洁代码与单元测试相互促进，可测试性是整洁代码的重要特征，单元测试是保证代码整洁性的安全网\n- [/软件工程/软件设计/代码质量/代码重构.md](/软件工程/软件设计/代码质量/代码重构.md) 单元测试是重构的安全网，确保在不改变外部行为的前提下调整内部结构，是重构实践的重要基础\n- [/软件工程/DevOps.md](/软件工程/DevOps.md) 单元测试是DevOps流水线中的重要环节，为持续集成和持续部署提供质量保障\n- [/软件工程/架构模式/分层架构.md](/软件工程/架构模式/分层架构.md) 分层架构提升了代码的可测试性，各层可以采用不同的测试策略，单元测试在其中扮演重要角色\n- [/软件工程/架构/演进式架构.md](/软件工程/架构/演进式架构.md) 演进式架构强调代码的可测试性，单元测试是支持架构演进的重要手段\n- [/软件工程/软件设计/代码质量/编码规范.md](/软件工程/软件设计/代码质量/编码规范.md) 编码规范中包含对测试代码编写的要求，单元测试代码也需要遵循规范\n- [/软件工程/软件设计/代码质量/代码审查.md](/软件工程/软件设计/代码质量/代码审查.md) 单元测试是代码审查的重要内容之一，审查代码时需同时审查其测试覆盖率和质量\n- [/运维/持续集成.md](/运维/持续集成.md) 持续集成流程中会自动运行单元测试，保证代码变更不会引入新的问题\n- [/编程语言/JAVA/高级/JDBC.md](/编程语言/JAVA/高级/JDBC.md) 数据访问层的单元测试有其特殊性，通常使用内存数据库如H2进行数据访问层的测试\n- [/个人成长/职场/职业素养.md](/个人成长/职场/职业素养.md) 单元测试体现了工程师的专业素养，是保证代码质量的重要实践\n- [/软件工程/微服务/服务治理/服务治理.md](/软件工程/微服务/服务治理/服务治理.md) 在微服务架构中，单元测试仍然重要，是保证服务内部逻辑正确的基础\n- [/软件工程/架构/系统设计/高并发.md](/软件工程/架构/系统设计/高并发.md) 高并发系统中的核心逻辑需要通过单元测试进行充分验证，确保在各种场景下的正确性\n- [/软件工程/理论/敏捷软件开发.md](/软件工程/理论/敏捷软件开发.md) 敏捷开发强调TDD（测试驱动开发），单元测试是敏捷实践的重要组成部分\n","metadata":"tags: ['软件工程', '运维']","hasMoreCommit":false,"totalCommits":7,"commitList":[{"date":"2026-02-12T14:07:03+08:00","author":"MY","message":"doc: 整理标签","hash":"290b3e8ad18f48832ac282290238d020fc030a88"},{"date":"2025-12-18T11:21:53+08:00","author":"MY","message":"feat(doc): 完善单元测试文档内容与结构","hash":"b3aff4a0bc95c2a6f8eee0a06f90a4cbad16935c"},{"date":"2023-01-17T17:58:45+08:00","author":"cjiping","message":"✏️测试","hash":"df30734725ab56af03671093b20d5c519abc3054"},{"date":"2022-06-20T14:44:47+08:00","author":"cjiping","message":"✏️更新 单元测试","hash":"1718927f3311d11f1d3c02f1ecbe51053d9deb2e"},{"date":"2022-02-07T23:21:12+08:00","author":"MY","message":"✏️更新 测试相关","hash":"a4c55ec4f2b1f33b0ef46f36951ec0ca67a71f76"},{"date":"2022-01-11T20:57:46+08:00","author":"MY","message":"✏️更新 单元测试","hash":"f0fc8fed9506e7dc4a944590769ad68a52b161f2"},{"date":"2022-01-11T16:25:03+08:00","author":"cjiping","message":"📦整理 单元测试","hash":"2504e9513b311030215e418550cbaafca6e71186"}],"createTime":"2022-01-11T16:25:03+08:00"}